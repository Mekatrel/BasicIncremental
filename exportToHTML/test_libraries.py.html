<html>
<head>
<title>test_libraries.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #cc7832;}
.s3 { color: #6a8759;}
.s4 { color: #629755; font-style: italic;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_libraries.py</font>
</center></td></tr></table>
<pre><span class="s0"># ------------------------------------------------------------------</span>
<span class="s0"># Copyright (c) 2020 PyInstaller Development Team.</span>
<span class="s0">#</span>
<span class="s0"># This file is distributed under the terms of the GNU General Public</span>
<span class="s0"># License (version 2.0 or later).</span>
<span class="s0">#</span>
<span class="s0"># The full license is available in LICENSE.GPL.txt, distributed with</span>
<span class="s0"># this software.</span>
<span class="s0">#</span>
<span class="s0"># SPDX-License-Identifier: GPL-2.0-or-later</span>
<span class="s0"># ------------------------------------------------------------------</span>
<span class="s2">import </span><span class="s1">pytest</span>
<span class="s2">from </span><span class="s1">pathlib </span><span class="s2">import </span><span class="s1">Path</span>
<span class="s2">from </span><span class="s1">PyInstaller.compat </span><span class="s2">import </span><span class="s1">is_darwin</span><span class="s2">, </span><span class="s1">is_linux</span><span class="s2">, </span><span class="s1">is_py39</span><span class="s2">, </span><span class="s1">is_win</span>
<span class="s2">from </span><span class="s1">PyInstaller.utils.hooks </span><span class="s2">import </span><span class="s1">is_module_satisfies</span><span class="s2">, </span><span class="s1">can_import_module</span>
<span class="s2">from </span><span class="s1">PyInstaller.utils.tests </span><span class="s2">import </span><span class="s1">importorskip</span><span class="s2">, </span><span class="s1">requires</span><span class="s2">, </span><span class="s1">xfail</span>


<span class="s1">@importorskip(</span><span class="s3">'jinxed'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_jinxed(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">''' 
        import jinxed 
        jinxed.setupterm('xterm') 
        assert jinxed._terminal.TERM.terminfo is jinxed.terminfo.xterm 
        '''</span>
    <span class="s1">)</span>


<span class="s2">def </span><span class="s1">tensorflow_onedir_only(test):</span>
    <span class="s2">def </span><span class="s1">wrapped(pyi_builder):</span>
        <span class="s2">if </span><span class="s1">pyi_builder._mode != </span><span class="s3">'onedir'</span><span class="s1">:</span>
            <span class="s1">pytest.skip(</span><span class="s3">'Tensorflow tests support only onedir mode '</span>
                        <span class="s3">'due to potential distribution size.'</span><span class="s1">)</span>
        <span class="s1">test(pyi_builder)</span>

    <span class="s2">return </span><span class="s1">wrapped</span>


<span class="s1">@importorskip(</span><span class="s3">'tensorflow'</span><span class="s1">)</span>
<span class="s1">@tensorflow_onedir_only</span>
<span class="s2">def </span><span class="s1">test_tensorflow(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        from tensorflow import * 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'tensorflow'</span><span class="s1">)</span>
<span class="s1">@tensorflow_onedir_only</span>
<span class="s2">def </span><span class="s1">test_tensorflow_layer(pyi_builder):</span>
    <span class="s1">pyi_builder.test_script(</span><span class="s3">'pyi_lib_tensorflow_layer.py'</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'tensorflow'</span><span class="s1">)</span>
<span class="s1">@tensorflow_onedir_only</span>
<span class="s2">def </span><span class="s1">test_tensorflow_mnist(pyi_builder):</span>
    <span class="s1">pyi_builder.test_script(</span><span class="s3">'pyi_lib_tensorflow_mnist.py'</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'trimesh'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_trimesh(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import trimesh 
        &quot;&quot;&quot;</span>
    <span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'apscheduler'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_apscheduler(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import apscheduler 
        import pytz 
        import asyncio 
        import random 
        import datetime as dt 
        from apscheduler.schedulers.asyncio import AsyncIOScheduler 
        from apscheduler.triggers.interval import IntervalTrigger 
        loop = asyncio.get_event_loop() 
        async def test_function(data=0): 
            print(dt.datetime.now(), random.randint(0, 100)) 
        test_scheduler = AsyncIOScheduler() 
        test_scheduler.add_job( 
            test_function, 
            id=&quot;TestJob&quot;, 
            trigger=IntervalTrigger( 
                seconds=1, 
                start_date=dt.datetime.now(tz=pytz.UTC) 
            ) 
        ) 
        test_scheduler.start() 
        loop.run_until_complete(asyncio.sleep(5)) 
    &quot;&quot;&quot;</span>
    <span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'boto'</span><span class="s1">)</span>
<span class="s1">@xfail(reason=</span><span class="s3">'boto does not fully support Python 3'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_boto(pyi_builder):</span>
    <span class="s1">pyi_builder.test_script(</span><span class="s3">'pyi_lib_boto.py'</span><span class="s1">)</span>


<span class="s1">@xfail(reason=</span><span class="s3">'Issue #1844.'</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">'boto3'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_boto3(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import boto3 
        session = boto3.Session(region_name='us-west-2') 
 
        # verify all clients 
        for service in session.get_available_services(): 
            session.client(service) 
 
        # verify all resources 
        for resource in session.get_available_resources(): 
            session.resource(resource) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@xfail(reason=</span><span class="s3">'Issue #1844.'</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">'botocore'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_botocore(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import botocore 
        from botocore.session import Session 
        session = Session() 
        # verify all services 
        for service in session.get_available_services(): 
            session.create_client(service, region_name='us-west-2') 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@xfail(is_darwin</span><span class="s2">, </span><span class="s1">reason=</span><span class="s3">'Issue #1895.'</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">'enchant'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_enchant(pyi_builder):</span>
    <span class="s1">pyi_builder.test_script(</span><span class="s3">'pyi_lib_enchant.py'</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'zmq'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_zmq(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import zmq 
        print(zmq.__version__) 
        print(zmq.zmq_version()) 
        # This is a problematic module and might cause some issues. 
        import zmq.utils.strtypes 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pylint'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pylint(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        # The following more obvious test doesn't work:: 
        # 
        #   import pylint 
        #   pylint.run_pylint() 
        # 
        # because pylint will exit with 32, since a valid command 
        # line wasn't given. Instead, provide a valid command line below. 
 
        from pylint.lint import Run 
        Run(['-h']) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'markdown'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_markdown(pyi_builder):</span>
    <span class="s0"># Markdown uses __import__ed extensions. Make sure these work by</span>
    <span class="s0"># trying to use the 'toc' extension, using both short and long format.</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import markdown 
        print(markdown.markdown('testing', 
            extensions=['toc'])) 
        print(markdown.markdown('testing', 
            extensions=['markdown.extensions.toc'])) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'lxml'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_lxml_isoschematron(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        # The import of this module triggers the loading of some 
        # required XML files. 
        from lxml import isoschematron 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'openpyxl'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_openpyxl(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        # Test the hook to openpyxl 
        from openpyxl import __version__ 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pyodbc'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pyodbc(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        # pyodbc is a binary Python module. On Windows when installed with easy_install 
        # it is installed as zipped Python egg. This binary module is extracted 
        # to PYTHON_EGG_CACHE directory. PyInstaller should find the binary there and 
        # include it with frozen executable. 
        import pyodbc 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pyttsx'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pyttsx(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        # Basic code example from pyttsx tutorial. 
        # http://packages.python.org/pyttsx/engine.html#examples 
        import pyttsx 
        engine = pyttsx.init() 
        engine.say('Sally sells seashells by the seashore.') 
        engine.say('The quick brown fox jumped over the lazy dog.') 
        engine.runAndWait() 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pyttsx3'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pyttsx3(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pyttsx3 
        engine = pyttsx3.init() 
    &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pycparser'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pycparser(pyi_builder):</span>
    <span class="s1">pyi_builder.test_script(</span><span class="s3">'pyi_lib_pycparser.py'</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'Crypto'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pycrypto(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import binascii 
        from Crypto.Cipher import AES 
        BLOCK_SIZE = 16 
        print('AES null encryption, block size', BLOCK_SIZE) 
        # Just for testing functionality after all 
        print('HEX', binascii.hexlify( 
            AES.new(b&quot;</span><span class="s2">\\</span><span class="s3">0&quot; * BLOCK_SIZE, AES.MODE_ECB).encrypt(b&quot;</span><span class="s2">\\</span><span class="s3">0&quot; * BLOCK_SIZE))) 
        from Crypto.PublicKey import ECC 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'Cryptodome'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_cryptodome(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        from Cryptodome import Cipher 
        from Cryptodome.PublicKey import ECC 
        print('Cryptodome Cipher Module:', Cipher) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'h5py'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_h5py(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import h5py 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'unidecode'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_unidecode(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from unidecode import unidecode 
 
        # Unidecode should not skip non-ASCII chars if mappings for them exist. 
        assert unidecode(u&quot;kožušček&quot;) == &quot;kozuscek&quot; 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pinyin'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pinyin(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pinyin 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'uvloop'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.darwin</span>
<span class="s1">@pytest.mark.linux</span>
<span class="s2">def </span><span class="s1">test_uvloop(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;import uvloop&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'web3'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_web3(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;import web3&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'phonenumbers'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_phonenumbers(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import phonenumbers 
 
        number = '+17034820623' 
        parsed_number = phonenumbers.parse(number) 
 
        assert(parsed_number.country_code == 1) 
        assert(parsed_number.national_number == 7034820623) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pendulum'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pendulum(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pendulum 
 
        print(pendulum.now().isoformat()) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'humanize'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_humanize(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import humanize 
        from datetime import timedelta 
 
        print(humanize.naturaldelta(timedelta(seconds=125))) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'argon2'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_argon2(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from argon2 import PasswordHasher 
 
        ph = PasswordHasher() 
        hash = ph.hash(&quot;s3kr3tp4ssw0rd&quot;) 
        ph.verify(hash, &quot;s3kr3tp4ssw0rd&quot;) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pytest'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pytest_runner(pyi_builder):</span>
    <span class="s4">&quot;&quot;&quot; 
    Check if pytest runner builds correctly. 
    &quot;&quot;&quot;</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import pytest 
        import sys 
        sys.exit(pytest.main(['--help'])) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'eel'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_eel(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;import eel&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'sentry_sdk'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_sentry(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span>
        <span class="s3">&quot;&quot;&quot; 
        import sentry_sdk 
        sentry_sdk.init() 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'iminuit'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_iminuit(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from iminuit import Minuit 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'av'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_av(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import av 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'passlib'</span><span class="s1">)</span>
<span class="s1">@xfail(is_linux </span><span class="s2">and </span><span class="s1">is_py39 </span><span class="s2">and not </span><span class="s1">is_module_satisfies(</span><span class="s3">'passlib &gt; 1.7.4'</span><span class="s1">)</span><span class="s2">,</span>
       <span class="s1">reason=</span><span class="s3">'Passlib does not account for crypt() behavior change that '</span>
              <span class="s3">'was introduced in 3.9.x (python #39289).'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_passlib(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import passlib.apache 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'publicsuffix2'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_publicsuffix2(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import publicsuffix2 
        publicsuffix2.PublicSuffixList() 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pydivert'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pydivert(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pydivert 
        pydivert.WinDivert.check_filter(&quot;inbound&quot;) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.slow</span>
<span class="s1">@importorskip(</span><span class="s3">'skimage'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">is_module_satisfies(</span><span class="s3">'scikit_image &gt;= 0.16'</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'The test supports only scikit-image &gt;= 0.16.'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'submodule'</span><span class="s2">, </span><span class="s1">[</span>
    <span class="s3">'color'</span><span class="s2">, </span><span class="s3">'data'</span><span class="s2">, </span><span class="s3">'draw'</span><span class="s2">, </span><span class="s3">'exposure'</span><span class="s2">, </span><span class="s3">'feature'</span><span class="s2">, </span><span class="s3">'filters'</span><span class="s2">, </span><span class="s3">'future'</span><span class="s2">,</span>
    <span class="s3">'graph'</span><span class="s2">, </span><span class="s3">'io'</span><span class="s2">, </span><span class="s3">'measure'</span><span class="s2">, </span><span class="s3">'metrics'</span><span class="s2">, </span><span class="s3">'morphology'</span><span class="s2">, </span><span class="s3">'registration'</span><span class="s2">,</span>
    <span class="s3">'restoration'</span><span class="s2">, </span><span class="s3">'segmentation'</span><span class="s2">, </span><span class="s3">'transform'</span><span class="s2">, </span><span class="s3">'util'</span><span class="s2">, </span><span class="s3">'viewer'</span>
<span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_skimage(pyi_builder</span><span class="s2">, </span><span class="s1">submodule):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import skimage.{0} 
        &quot;&quot;&quot;</span><span class="s1">.format(submodule))</span>


<span class="s1">@pytest.mark.slow</span>
<span class="s1">@importorskip(</span><span class="s3">'sklearn'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">is_module_satisfies(</span><span class="s3">'scikit_learn &gt;= 0.21'</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'The test supports only scikit-learn &gt;= 0.21.'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'submodule'</span><span class="s2">, </span><span class="s1">[</span>
    <span class="s3">'calibration'</span><span class="s2">, </span><span class="s3">'cluster'</span><span class="s2">, </span><span class="s3">'covariance'</span><span class="s2">, </span><span class="s3">'cross_decomposition'</span><span class="s2">,</span>
    <span class="s3">'datasets'</span><span class="s2">, </span><span class="s3">'decomposition'</span><span class="s2">, </span><span class="s3">'dummy'</span><span class="s2">, </span><span class="s3">'ensemble'</span><span class="s2">, </span><span class="s3">'exceptions'</span><span class="s2">,</span>
    <span class="s3">'experimental'</span><span class="s2">, </span><span class="s3">'externals'</span><span class="s2">, </span><span class="s3">'feature_extraction'</span><span class="s2">,</span>
    <span class="s3">'feature_selection'</span><span class="s2">, </span><span class="s3">'gaussian_process'</span><span class="s2">, </span><span class="s3">'inspection'</span><span class="s2">,</span>
    <span class="s3">'isotonic'</span><span class="s2">, </span><span class="s3">'kernel_approximation'</span><span class="s2">, </span><span class="s3">'kernel_ridge'</span><span class="s2">,</span>
    <span class="s3">'linear_model'</span><span class="s2">, </span><span class="s3">'manifold'</span><span class="s2">, </span><span class="s3">'metrics'</span><span class="s2">, </span><span class="s3">'mixture'</span><span class="s2">,</span>
    <span class="s3">'model_selection'</span><span class="s2">, </span><span class="s3">'multiclass'</span><span class="s2">, </span><span class="s3">'multioutput'</span><span class="s2">,</span>
    <span class="s3">'naive_bayes'</span><span class="s2">, </span><span class="s3">'neighbors'</span><span class="s2">, </span><span class="s3">'neural_network'</span><span class="s2">, </span><span class="s3">'pipeline'</span><span class="s2">,</span>
    <span class="s3">'preprocessing'</span><span class="s2">, </span><span class="s3">'random_projection'</span><span class="s2">, </span><span class="s3">'semi_supervised'</span><span class="s2">,</span>
    <span class="s3">'svm'</span><span class="s2">, </span><span class="s3">'tree'</span><span class="s2">, </span><span class="s3">'discriminant_analysis'</span><span class="s2">, </span><span class="s3">'impute'</span><span class="s2">, </span><span class="s3">'compose'</span>
<span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_sklearn(pyi_builder</span><span class="s2">, </span><span class="s1">submodule):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import sklearn.{0} 
        &quot;&quot;&quot;</span><span class="s1">.format(submodule))</span>


<span class="s1">@importorskip(</span><span class="s3">'statsmodels'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">is_module_satisfies(</span><span class="s3">'statsmodels &gt;= 0.12'</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'This has only been tested with statsmodels &gt;= 0.12.'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_statsmodels(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import statsmodels.api as sm 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'win32ctypes'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">is_win</span><span class="s2">, </span><span class="s1">reason=</span><span class="s3">'pywin32-ctypes is supported only on Windows'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.parametrize(</span><span class="s3">'submodule'</span><span class="s2">, </span><span class="s1">[</span><span class="s3">'win32api'</span><span class="s2">, </span><span class="s3">'win32cred'</span><span class="s2">, </span><span class="s3">'pywintypes'</span><span class="s1">])</span>
<span class="s2">def </span><span class="s1">test_pywin32ctypes(pyi_builder</span><span class="s2">, </span><span class="s1">submodule):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from win32ctypes.pywin32 import {0} 
        &quot;&quot;&quot;</span><span class="s1">.format(submodule))</span>


<span class="s1">@importorskip(</span><span class="s3">'pyproj'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">is_module_satisfies(</span><span class="s3">'pyproj &gt;= 2.1.3'</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'The test supports only pyproj &gt;= 2.1.3.'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pyproj(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pyproj 
        tf = pyproj.Transformer.from_crs( 
            7789, 
            8401 
        ) 
        result = tf.transform( 
            xx=3496737.2679, 
            yy=743254.4507, 
            zz=5264462.9620, 
            tt=2019.0 
        ) 
        print(result) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pydantic'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pydantic(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pydantic 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s2">def </span><span class="s1">torch_onedir_only(test):</span>
    <span class="s2">def </span><span class="s1">wrapped(pyi_builder):</span>
        <span class="s2">if </span><span class="s1">pyi_builder._mode != </span><span class="s3">'onedir'</span><span class="s1">:</span>
            <span class="s1">pytest.skip(</span><span class="s3">'PyTorch tests support only onedir mode '</span>
                        <span class="s3">'due to potential distribution size.'</span><span class="s1">)</span>
        <span class="s1">test(pyi_builder)</span>

    <span class="s2">return </span><span class="s1">wrapped</span>


<span class="s1">@importorskip(</span><span class="s3">'torchvision'</span><span class="s1">)</span>
<span class="s1">@torch_onedir_only</span>
<span class="s2">def </span><span class="s1">test_torchvision_nms(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import torch 
        import torchvision 
        # boxes: Nx4 tensor (x1, y1, x2, y2) 
        boxes = torch.tensor([ 
            [0.0, 0.0, 1.0, 1.0], 
            [0.45, 0.0, 1.0, 1.0], 
        ]) 
        # scores: Nx1 tensor 
        scores = torch.tensor([ 
            1.0, 
            1.1 
        ]) 
        keep = torchvision.ops.nms(boxes, scores, 0.5) 
        # The boxes have IoU of 0.55, and the second one has a slightly 
        # higher score, so we expect it to be kept while the first one 
        # is discarded. 
        assert keep == 1 
    &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'googleapiclient'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_googleapiclient(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from googleapiclient.discovery import build 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'plotly'</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">'pandas'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_plotly(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pandas as pd 
        import plotly.express as px 
 
        data = [(1, 1), (2, 1), (3, 5), (4, -3)] 
        df = pd.DataFrame.from_records(data, columns=['col_1', 'col_2']) 
        fig = px.scatter(df, x='col_1', y='col_2') 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.timeout(</span><span class="s5">600</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">'dash'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_dash(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import dash 
        import dash_core_components as dcc 
        import dash_html_components as html 
        from dash.dependencies import Input, Output 
 
        app = dash.Dash(__name__) 
        app.layout = html.Div( 
            [ 
                dcc.Input(id='input_text', type='text', placeholder='input type text'), 
                html.Div(id='out-all-types'), 
            ] 
        ) 
 
        @app.callback( 
            Output('out-all-types', 'children'), 
            [Input('input_text', 'value')], 
        ) 
        def cb_render(val): 
            return val 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'dash_table'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_dash_table(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import dash 
        import dash_table 
 
        app = dash.Dash(__name__) 
        app.layout = dash_table.DataTable( 
            id='table', 
            columns=[{'name': 'a', 'id': 'a'}, {'name': 'b', 'id': 'b'}], 
            data=[{'a': 1, 'b': 2}, {'a': 3, 'b': 4}], 
        ) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'dash_bootstrap_components'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_dash_bootstrap_components(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import dash 
        import dash_bootstrap_components as dbc 
        import dash_html_components as html 
 
        app = dash.Dash(external_stylesheets=[dbc.themes.BOOTSTRAP]) 
        alert = dbc.Alert([html.H4('Well done!', className='alert-heading')]) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'blspy'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_blspy(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import blspy 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'flirpy'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_flirpy(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from flirpy.camera.lepton import Lepton 
 
        print(Lepton.find_video_device()) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'office365'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_office365(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from office365.runtime.auth.providers.saml_token_provider import SamlTokenProvider 
 
        SamlTokenProvider._prepare_request_from_template('FederatedSAML.xml', {}) 
        SamlTokenProvider._prepare_request_from_template('RST2.xml', {}) 
        SamlTokenProvider._prepare_request_from_template('SAML.xml', {}) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'thinc'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_thinc(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from thinc.backends import numpy_ops 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'srsly'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_srsly(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import srsly 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'spacy'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_spacy(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import spacy 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'shotgun_api3'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_shotgun_api3(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import shotgun_api3 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'msoffcrypto'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_msoffcrypto(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import msoffcrypto 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'mariadb'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_mariadb(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import mariadb 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'dash_uploader'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_dash_uploader(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import dash_uploader 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'cloudscraper'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_cloudscraper(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import cloudscraper 
        scraper = cloudscraper.create_scraper() 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'mnemonic'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_mnemonic(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import mnemonic 
        mnemonic.Mnemonic(&quot;english&quot;) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pynput'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pynput(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pynput 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pystray'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pystray(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pystray 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'rtree'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_rtree(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import rtree 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'pingouin'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pingouin(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pingouin 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'timezonefinder'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_timezonefinder(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from timezonefinder import TimezoneFinder 
        TimezoneFinder() 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">'uvicorn'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_uvicorn(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from uvicorn import lifespan, loops 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;langdetect&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_langdetect(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import langdetect 
        print(langdetect.detect(&quot;this is a test&quot;)) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;swagger_spec_validator&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_swagger_spec_validator(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from swagger_spec_validator.common import read_resource_file 
        read_resource_file(&quot;schemas/v1.2/resourceListing.json&quot;) 
        read_resource_file(&quot;schemas/v2.0/schema.json&quot;) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@requires(</span><span class="s3">'pythonnet &lt; 3.dev'</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">is_win</span><span class="s2">, </span><span class="s1">reason=</span><span class="s3">'pythonnet 2 does not support .Net Core, so its only supported by Windows'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pythonnet2(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import clr 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@requires(</span><span class="s3">'pythonnet &gt;= 3.dev'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pythonnet3(pyi_builder):</span>
    <span class="s1">runtime_cfg_path = str((Path(__file__) / </span><span class="s3">'../data/netcore5_runtime_config.json'</span><span class="s1">).resolve(strict=</span><span class="s2">True</span><span class="s1">).as_posix())</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">f&quot;&quot;&quot;</span>
        <span class="s3">from pathlib import Path</span>
        <span class="s3">from clr_loader import get_coreclr</span>
        <span class="s3">from pythonnet import set_runtime</span>
        <span class="s3">set_runtime(get_coreclr('</span><span class="s2">{</span><span class="s1">runtime_cfg_path</span><span class="s2">}</span><span class="s3">'))</span>

        <span class="s3">import clr</span>
        <span class="s3">&quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s2">if </span><span class="s1">is_win:</span>
    <span class="s0"># This is a hack to prevent monkeypatch from interfering with PyQt5's additional PATH entries. See:</span>
    <span class="s0"># https://github.com/pyinstaller/pyinstaller/commit/b66c9021129e9e875ddd138a298ce542483dd6c9</span>
    <span class="s2">try</span><span class="s1">:</span>
        <span class="s2">import </span><span class="s1">PyQt5  </span><span class="s0"># noqa: F401</span>
    <span class="s2">except </span><span class="s1">ImportError:</span>
        <span class="s2">pass</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;qtmodern&quot;</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">&quot;PyQt5&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_qtmodern(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import sys 
        from PyQt5 import QtWidgets 
        import qtmodern.styles 
        import qtmodern.windows 
 
        app = QtWidgets.QApplication(sys.argv) 
        window = QtWidgets.QWidget() 
        qtmodern.styles.dark(app) 
        modern_window = qtmodern.windows.ModernWindow(window) 
        modern_window.show() 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;platformdirs&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_platformdirs(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import platformdirs 
        platformdirs.user_data_dir(&quot;FooApp&quot;, &quot;Mr Foo&quot;) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;websockets&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_websockets(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;import websockets&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;tableauhyperapi&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_tableauhyperapi(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import tableauhyperapi 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pymssql&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pymssql(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pymssql 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;branca&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_branca(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import branca 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;folium&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_folium(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import folium 
        m = folium.Map(location=[0, 0], zoom_start=5) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;metpy&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_metpy(pyi_builder):</span>
    <span class="s0"># Import metpy.plots, which triggers search for colortables data.</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import metpy.plots 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pyvjoy&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pyvjoy(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pyvjoy 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;adbutils&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_adbutils(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from adbutils._utils import get_adb_exe; get_adb_exe() 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pymediainfo&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pymediainfo(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from pymediainfo import MediaInfo 
        MediaInfo._get_library()  # Trigger search for shared library. 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;sacremoses&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_sacremoses(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import sacremoses 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pypeteer&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pypeteer(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pypeteer 
        print(pypeteer.version) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;tzdata&quot;</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(</span><span class="s2">not </span><span class="s1">is_py39 </span><span class="s2">and not </span><span class="s1">can_import_module(</span><span class="s3">'importlib_resources'</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'importlib_resources is required on python &lt; 3.9.'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_tzdata(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import tzdata.zoneinfo  # hiddenimport 
 
        try: 
            import importlib.resources as importlib_resources 
        except ImportError: 
            import importlib_resources 
 
        # This emulates time-zone data retrieval from tzdata, as peformed by 
        # zoneinfo / backports.zoneinfo 
        zone_name = &quot;Europe/Ljubljana&quot; 
 
        components = zone_name.split(&quot;/&quot;) 
        package_name = &quot;.&quot;.join([&quot;tzdata.zoneinfo&quot;] + components[:-1]) 
        resource_name = components[-1] 
 
        with importlib_resources.open_binary(package_name, resource_name) as fp: 
            data = fp.read() 
 
        print(data) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;backports.zoneinfo&quot;</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(is_win </span><span class="s2">and not </span><span class="s1">can_import_module(</span><span class="s3">'tzdata'</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'On Windows, backports.zoneinfo requires tzdata.'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_backports_zoneinfo(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from backports import zoneinfo 
        tz = zoneinfo.ZoneInfo(&quot;Europe/Ljubljana&quot;) 
        print(tz) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;zoneinfo&quot;</span><span class="s1">)</span>
<span class="s1">@pytest.mark.skipif(is_win </span><span class="s2">and not </span><span class="s1">can_import_module(</span><span class="s3">'tzdata'</span><span class="s1">)</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'On Windows, zoneinfo requires tzdata.'</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_zoneinfo(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import zoneinfo 
        tz = zoneinfo.ZoneInfo(&quot;Europe/Ljubljana&quot;) 
        print(tz) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;panel&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_panel(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import panel 
 
        # Load the Ace extension to trigger lazy-loading of model 
        panel.extension(&quot;ace&quot;) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pyviz_comms&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pyviz_comms(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pyviz_comms 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pyphen&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pyphen(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import pyphen 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pandas&quot;</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">&quot;plotly&quot;</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">&quot;kaleido&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_kaleido(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import plotly.express as px 
        fig = px.scatter(px.data.iris(), x=&quot;sepal_length&quot;, y=&quot;sepal_width&quot;, color=&quot;species&quot;) 
        fig.write_image(&quot;figure.png&quot;, engine=&quot;kaleido&quot;) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.skipif(is_win</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'On Windows, Cairo dependencies cannot be installed using Chocolatey.'</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">&quot;cairocffi&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_cairocffi(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import cairocffi 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@pytest.mark.skipif(is_win</span><span class="s2">,</span>
                    <span class="s1">reason=</span><span class="s3">'On Windows, Cairo dependencies cannot be installed using Chocolatey.'</span><span class="s1">)</span>
<span class="s1">@importorskip(</span><span class="s3">&quot;cairosvg&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_cairosvg(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import cairosvg 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;ffpyplayer&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_ffpyplayer(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import ffpyplayer.player 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;cv2&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_cv2(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import cv2 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;twisted&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_twisted_default_reactor(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from twisted.internet import reactor 
        assert callable(reactor.listenTCP) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;twisted&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_twisted_custom_reactor(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import sys 
        if sys.platform.startswith(&quot;win&quot;) and sys.version_info &gt;= (3,7): 
            import asyncio 
            asyncio.set_event_loop_policy(asyncio.WindowsSelectorEventLoopPolicy()) 
        from twisted.internet import asyncioreactor 
        asyncioreactor.install() 
        from twisted.internet import reactor 
        assert callable(reactor.listenTCP) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pygraphviz&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pygraphviz_bundled_programs(pyi_builder):</span>
    <span class="s0"># Test that the frozen application is using collected graphviz executables instead of system-installed ones.</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        import sys 
        import os 
        import pygraphviz 
 
        bundle_dir = os.path.normpath(sys._MEIPASS) 
        dot_path = os.path.normpath(pygraphviz.AGraph()._get_prog('dot')) 
 
        assert os.path.commonprefix([dot_path, bundle_dir]) == bundle_dir, </span><span class="s2">\ 
            </span><span class="s3">f&quot;Invalid program path: {dot_path}!&quot; 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;pypsexec&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_pypsexec(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from pypsexec.paexec import paexec_out_stream 
        next(paexec_out_stream()) 
        &quot;&quot;&quot;</span><span class="s1">)</span>


<span class="s1">@importorskip(</span><span class="s3">&quot;mimesis&quot;</span><span class="s1">)</span>
<span class="s2">def </span><span class="s1">test_mimesis(pyi_builder):</span>
    <span class="s1">pyi_builder.test_source(</span><span class="s3">&quot;&quot;&quot; 
        from mimesis import Address 
        Address().address() 
        &quot;&quot;&quot;</span><span class="s1">)</span>
</pre>
</body>
</html>