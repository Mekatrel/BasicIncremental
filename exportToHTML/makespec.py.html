<html>
<head>
<title>makespec.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
makespec.py</font>
</center></td></tr></table>
<pre><span class="s0">#-----------------------------------------------------------------------------</span>
<span class="s0"># Copyright (c) 2005-2021, PyInstaller Development Team.</span>
<span class="s0">#</span>
<span class="s0"># Distributed under the terms of the GNU General Public License (version 2</span>
<span class="s0"># or later) with exception for distributing the bootloader.</span>
<span class="s0">#</span>
<span class="s0"># The full license is in the file COPYING.txt, distributed with this software.</span>
<span class="s0">#</span>
<span class="s0"># SPDX-License-Identifier: (GPL-2.0-or-later WITH Bootloader-exception)</span>
<span class="s0">#-----------------------------------------------------------------------------</span>
<span class="s2">&quot;&quot;&quot; 
Automatically build spec files containing a description of the project. 
&quot;&quot;&quot;</span>

<span class="s3">import </span><span class="s1">argparse</span>
<span class="s3">import </span><span class="s1">os</span>
<span class="s3">import </span><span class="s1">sys</span>

<span class="s3">from </span><span class="s1">PyInstaller </span><span class="s3">import </span><span class="s1">DEFAULT_SPECPATH</span><span class="s3">, </span><span class="s1">HOMEPATH</span>
<span class="s3">from </span><span class="s1">PyInstaller </span><span class="s3">import </span><span class="s1">log </span><span class="s3">as </span><span class="s1">logging</span>
<span class="s3">from </span><span class="s1">PyInstaller.building.templates </span><span class="s3">import </span><span class="s1">(</span>
    <span class="s1">bundleexetmplt</span><span class="s3">, </span><span class="s1">bundletmplt</span><span class="s3">, </span><span class="s1">cipher_absent_template</span><span class="s3">, </span><span class="s1">cipher_init_template</span><span class="s3">, </span><span class="s1">onedirtmplt</span><span class="s3">, </span><span class="s1">onefiletmplt</span><span class="s3">, </span><span class="s1">splashtmpl</span>
<span class="s1">)</span>
<span class="s3">from </span><span class="s1">PyInstaller.compat </span><span class="s3">import </span><span class="s1">expand_path</span><span class="s3">, </span><span class="s1">is_darwin</span><span class="s3">, </span><span class="s1">is_win</span>

<span class="s1">logger = logging.getLogger(__name__)</span>
<span class="s1">add_command_sep = os.pathsep</span>

<span class="s0"># This list gives valid choices for the ``--debug`` command-line option, except for the ``all`` choice.</span>
<span class="s1">DEBUG_ARGUMENT_CHOICES = [</span><span class="s4">'imports'</span><span class="s3">, </span><span class="s4">'bootloader'</span><span class="s3">, </span><span class="s4">'noarchive'</span><span class="s1">]</span>
<span class="s0"># This is the ``all`` choice.</span>
<span class="s1">DEBUG_ALL_CHOICE = [</span><span class="s4">'all'</span><span class="s1">]</span>


<span class="s3">def </span><span class="s1">quote_win_filepath(path):</span>
    <span class="s0"># quote all \ with another \ after using normpath to clean up the path</span>
    <span class="s3">return </span><span class="s1">os.path.normpath(path).replace(</span><span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s3">, </span><span class="s4">'</span><span class="s3">\\\\</span><span class="s4">'</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">make_path_spec_relative(filename</span><span class="s3">, </span><span class="s1">spec_dir):</span>
    <span class="s2">&quot;&quot;&quot; 
    Make the filename relative to the directory containing .spec file if filename is relative and not absolute. 
    Otherwise keep filename untouched. 
    &quot;&quot;&quot;</span>
    <span class="s3">if </span><span class="s1">os.path.isabs(filename):</span>
        <span class="s3">return </span><span class="s1">filename</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">filename = os.path.abspath(filename)</span>
        <span class="s0"># Make it relative.</span>
        <span class="s1">filename = os.path.relpath(filename</span><span class="s3">, </span><span class="s1">start=spec_dir)</span>
        <span class="s3">return </span><span class="s1">filename</span>


<span class="s0"># Support for trying to avoid hard-coded paths in the .spec files. Eg, all files rooted in the Installer directory tree</span>
<span class="s0"># will be written using &quot;HOMEPATH&quot;, thus allowing this spec file to be used with any Installer installation. Same thing</span>
<span class="s0"># could be done for other paths too.</span>
<span class="s1">path_conversions = ((HOMEPATH</span><span class="s3">, </span><span class="s4">&quot;HOMEPATH&quot;</span><span class="s1">)</span><span class="s3">,</span><span class="s1">)</span>


<span class="s3">def </span><span class="s1">add_data_or_binary(string):</span>
    <span class="s3">try</span><span class="s1">:</span>
        <span class="s1">src</span><span class="s3">, </span><span class="s1">dest = string.split(add_command_sep)</span>
    <span class="s3">except </span><span class="s1">ValueError </span><span class="s3">as </span><span class="s1">e:</span>
        <span class="s0"># Split into SRC and DEST failed, wrong syntax</span>
        <span class="s3">raise </span><span class="s1">argparse.ArgumentError(</span><span class="s4">&quot;Wrong syntax, should be SRC{}DEST&quot;</span><span class="s1">.format(add_command_sep)) </span><span class="s3">from </span><span class="s1">e</span>
    <span class="s3">if not </span><span class="s1">src </span><span class="s3">or not </span><span class="s1">dest:</span>
        <span class="s0"># Syntax was correct, but one or both of SRC and DEST was not given</span>
        <span class="s3">raise </span><span class="s1">argparse.ArgumentError(</span><span class="s4">&quot;You have to specify both SRC and DEST&quot;</span><span class="s1">)</span>
    <span class="s0"># Return tuple containing SRC and SRC</span>
    <span class="s3">return </span><span class="s1">src</span><span class="s3">, </span><span class="s1">dest</span>


<span class="s3">def </span><span class="s1">make_variable_path(filename</span><span class="s3">, </span><span class="s1">conversions=path_conversions):</span>
    <span class="s3">if not </span><span class="s1">os.path.isabs(filename):</span>
        <span class="s0"># os.path.commonpath can not compare relative and absolute paths, and if filename is not absolut, none of the</span>
        <span class="s0"># paths in conversions will match anyway.</span>
        <span class="s3">return None, </span><span class="s1">filename</span>
    <span class="s3">for </span><span class="s1">(from_path</span><span class="s3">, </span><span class="s1">to_name) </span><span class="s3">in </span><span class="s1">conversions:</span>
        <span class="s3">assert </span><span class="s1">os.path.abspath(from_path) == from_path</span><span class="s3">, </span><span class="s1">(</span><span class="s4">&quot;path '%s' should already be absolute&quot; </span><span class="s1">% from_path)</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">common_path = os.path.commonpath([filename</span><span class="s3">, </span><span class="s1">from_path])</span>
        <span class="s3">except </span><span class="s1">ValueError:</span>
            <span class="s0"># Per https://docs.python.org/3/library/os.path.html#os.path.commonpath, this raises ValueError in several</span>
            <span class="s0"># cases which prevent computing a common path.</span>
            <span class="s1">common_path = </span><span class="s3">None</span>
        <span class="s3">if </span><span class="s1">common_path == from_path:</span>
            <span class="s1">rest = filename[len(from_path):]</span>
            <span class="s3">if </span><span class="s1">rest.startswith((</span><span class="s4">'</span><span class="s3">\\</span><span class="s4">'</span><span class="s3">, </span><span class="s4">'/'</span><span class="s1">)):</span>
                <span class="s1">rest = rest[</span><span class="s5">1</span><span class="s1">:]</span>
            <span class="s3">return </span><span class="s1">to_name</span><span class="s3">, </span><span class="s1">rest</span>
    <span class="s3">return None, </span><span class="s1">filename</span>


<span class="s0"># An object used in place of a &quot;path string&quot;, which knows how to repr() itself using variable names instead of</span>
<span class="s0"># hard-coded paths.</span>
<span class="s3">class </span><span class="s1">Path:</span>
    <span class="s3">def </span><span class="s1">__init__(self</span><span class="s3">, </span><span class="s1">*parts):</span>
        <span class="s1">self.path = os.path.join(*parts)</span>
        <span class="s1">self.variable_prefix = self.filename_suffix = </span><span class="s3">None</span>

    <span class="s3">def </span><span class="s1">__repr__(self):</span>
        <span class="s3">if </span><span class="s1">self.filename_suffix </span><span class="s3">is None</span><span class="s1">:</span>
            <span class="s1">self.variable_prefix</span><span class="s3">, </span><span class="s1">self.filename_suffix = make_variable_path(self.path)</span>
        <span class="s3">if </span><span class="s1">self.variable_prefix </span><span class="s3">is None</span><span class="s1">:</span>
            <span class="s3">return </span><span class="s1">repr(self.path)</span>
        <span class="s3">return </span><span class="s4">&quot;os.path.join(&quot; </span><span class="s1">+ self.variable_prefix + </span><span class="s4">&quot;,&quot; </span><span class="s1">+ repr(self.filename_suffix) + </span><span class="s4">&quot;)&quot;</span>


<span class="s0"># An object used to construct extra preamble for the spec file, in order to accommodate extra collect_*() calls from the</span>
<span class="s0"># command-line</span>
<span class="s3">class </span><span class="s1">Preamble:</span>
    <span class="s3">def </span><span class="s1">__init__(</span>
        <span class="s1">self</span><span class="s3">, </span><span class="s1">datas</span><span class="s3">, </span><span class="s1">binaries</span><span class="s3">, </span><span class="s1">hiddenimports</span><span class="s3">, </span><span class="s1">collect_data</span><span class="s3">, </span><span class="s1">collect_binaries</span><span class="s3">, </span><span class="s1">collect_submodules</span><span class="s3">, </span><span class="s1">collect_all</span><span class="s3">,</span>
        <span class="s1">copy_metadata</span><span class="s3">, </span><span class="s1">recursive_copy_metadata</span>
    <span class="s1">):</span>
        <span class="s0"># Initialize with literal values - will be switched to preamble variable name later, if necessary</span>
        <span class="s1">self.binaries = binaries </span><span class="s3">or </span><span class="s1">[]</span>
        <span class="s1">self.hiddenimports = hiddenimports </span><span class="s3">or </span><span class="s1">[]</span>
        <span class="s1">self.datas = datas </span><span class="s3">or </span><span class="s1">[]</span>
        <span class="s0"># Preamble content</span>
        <span class="s1">self.content = []</span>

        <span class="s0"># Import statements</span>
        <span class="s3">if </span><span class="s1">collect_data:</span>
            <span class="s1">self._add_hookutil_import(</span><span class="s4">'collect_data_files'</span><span class="s1">)</span>
        <span class="s3">if </span><span class="s1">collect_binaries:</span>
            <span class="s1">self._add_hookutil_import(</span><span class="s4">'collect_dynamic_libs'</span><span class="s1">)</span>
        <span class="s3">if </span><span class="s1">collect_submodules:</span>
            <span class="s1">self._add_hookutil_import(</span><span class="s4">'collect_submodules'</span><span class="s1">)</span>
        <span class="s3">if </span><span class="s1">collect_all:</span>
            <span class="s1">self._add_hookutil_import(</span><span class="s4">'collect_all'</span><span class="s1">)</span>
        <span class="s3">if </span><span class="s1">copy_metadata </span><span class="s3">or </span><span class="s1">recursive_copy_metadata:</span>
            <span class="s1">self._add_hookutil_import(</span><span class="s4">'copy_metadata'</span><span class="s1">)</span>
        <span class="s3">if </span><span class="s1">self.content:</span>
            <span class="s1">self.content += [</span><span class="s4">''</span><span class="s1">]  </span><span class="s0"># empty line to separate the section</span>
        <span class="s0"># Variables</span>
        <span class="s3">if </span><span class="s1">collect_data </span><span class="s3">or </span><span class="s1">copy_metadata </span><span class="s3">or </span><span class="s1">collect_all </span><span class="s3">or </span><span class="s1">recursive_copy_metadata:</span>
            <span class="s1">self._add_var(</span><span class="s4">'datas'</span><span class="s3">, </span><span class="s1">self.datas)</span>
            <span class="s1">self.datas = </span><span class="s4">'datas'  </span><span class="s0"># switch to variable</span>
        <span class="s3">if </span><span class="s1">collect_binaries </span><span class="s3">or </span><span class="s1">collect_all:</span>
            <span class="s1">self._add_var(</span><span class="s4">'binaries'</span><span class="s3">, </span><span class="s1">self.binaries)</span>
            <span class="s1">self.binaries = </span><span class="s4">'binaries'  </span><span class="s0"># switch to variable</span>
        <span class="s3">if </span><span class="s1">collect_submodules </span><span class="s3">or </span><span class="s1">collect_all:</span>
            <span class="s1">self._add_var(</span><span class="s4">'hiddenimports'</span><span class="s3">, </span><span class="s1">self.hiddenimports)</span>
            <span class="s1">self.hiddenimports = </span><span class="s4">'hiddenimports'  </span><span class="s0"># switch to variable</span>
        <span class="s0"># Content - collect_data_files</span>
        <span class="s3">for </span><span class="s1">entry </span><span class="s3">in </span><span class="s1">collect_data:</span>
            <span class="s1">self._add_collect_data(entry)</span>
        <span class="s0"># Content - copy_metadata</span>
        <span class="s3">for </span><span class="s1">entry </span><span class="s3">in </span><span class="s1">copy_metadata:</span>
            <span class="s1">self._add_copy_metadata(entry)</span>
        <span class="s0"># Content - copy_metadata(..., recursive=True)</span>
        <span class="s3">for </span><span class="s1">entry </span><span class="s3">in </span><span class="s1">recursive_copy_metadata:</span>
            <span class="s1">self._add_recursive_copy_metadata(entry)</span>
        <span class="s0"># Content - collect_binaries</span>
        <span class="s3">for </span><span class="s1">entry </span><span class="s3">in </span><span class="s1">collect_binaries:</span>
            <span class="s1">self._add_collect_binaries(entry)</span>
        <span class="s0"># Content - collect_submodules</span>
        <span class="s3">for </span><span class="s1">entry </span><span class="s3">in </span><span class="s1">collect_submodules:</span>
            <span class="s1">self._add_collect_submodules(entry)</span>
        <span class="s0"># Content - collect_all</span>
        <span class="s3">for </span><span class="s1">entry </span><span class="s3">in </span><span class="s1">collect_all:</span>
            <span class="s1">self._add_collect_all(entry)</span>
        <span class="s0"># Merge</span>
        <span class="s3">if </span><span class="s1">self.content </span><span class="s3">and </span><span class="s1">self.content[-</span><span class="s5">1</span><span class="s1">] != </span><span class="s4">''</span><span class="s1">:</span>
            <span class="s1">self.content += [</span><span class="s4">''</span><span class="s1">]  </span><span class="s0"># empty line</span>
        <span class="s1">self.content = </span><span class="s4">'</span><span class="s3">\n</span><span class="s4">'</span><span class="s1">.join(self.content)</span>

    <span class="s3">def </span><span class="s1">_add_hookutil_import(self</span><span class="s3">, </span><span class="s1">name):</span>
        <span class="s1">self.content += [</span><span class="s4">'from PyInstaller.utils.hooks import {0}'</span><span class="s1">.format(name)]</span>

    <span class="s3">def </span><span class="s1">_add_var(self</span><span class="s3">, </span><span class="s1">name</span><span class="s3">, </span><span class="s1">initial_value):</span>
        <span class="s1">self.content += [</span><span class="s4">'{0} = {1}'</span><span class="s1">.format(name</span><span class="s3">, </span><span class="s1">initial_value)]</span>

    <span class="s3">def </span><span class="s1">_add_collect_data(self</span><span class="s3">, </span><span class="s1">name):</span>
        <span class="s1">self.content += [</span><span class="s4">'datas += collect_data_files(</span><span class="s3">\'</span><span class="s4">{0}</span><span class="s3">\'</span><span class="s4">)'</span><span class="s1">.format(name)]</span>

    <span class="s3">def </span><span class="s1">_add_copy_metadata(self</span><span class="s3">, </span><span class="s1">name):</span>
        <span class="s1">self.content += [</span><span class="s4">'datas += copy_metadata(</span><span class="s3">\'</span><span class="s4">{0}</span><span class="s3">\'</span><span class="s4">)'</span><span class="s1">.format(name)]</span>

    <span class="s3">def </span><span class="s1">_add_recursive_copy_metadata(self</span><span class="s3">, </span><span class="s1">name):</span>
        <span class="s1">self.content += [</span><span class="s4">'datas += copy_metadata(</span><span class="s3">\'</span><span class="s4">{0}</span><span class="s3">\'</span><span class="s4">, recursive=True)'</span><span class="s1">.format(name)]</span>

    <span class="s3">def </span><span class="s1">_add_collect_binaries(self</span><span class="s3">, </span><span class="s1">name):</span>
        <span class="s1">self.content += [</span><span class="s4">'binaries += collect_dynamic_libs(</span><span class="s3">\'</span><span class="s4">{0}</span><span class="s3">\'</span><span class="s4">)'</span><span class="s1">.format(name)]</span>

    <span class="s3">def </span><span class="s1">_add_collect_submodules(self</span><span class="s3">, </span><span class="s1">name):</span>
        <span class="s1">self.content += [</span><span class="s4">'hiddenimports += collect_submodules(</span><span class="s3">\'</span><span class="s4">{0}</span><span class="s3">\'</span><span class="s4">)'</span><span class="s1">.format(name)]</span>

    <span class="s3">def </span><span class="s1">_add_collect_all(self</span><span class="s3">, </span><span class="s1">name):</span>
        <span class="s1">self.content += [</span>
            <span class="s4">'tmp_ret = collect_all(</span><span class="s3">\'</span><span class="s4">{0}</span><span class="s3">\'</span><span class="s4">)'</span><span class="s1">.format(name)</span><span class="s3">,</span>
            <span class="s4">'datas += tmp_ret[0]; binaries += tmp_ret[1]; hiddenimports += tmp_ret[2]'</span>
        <span class="s1">]</span>


<span class="s3">def </span><span class="s1">__add_options(parser):</span>
    <span class="s2">&quot;&quot;&quot; 
    Add the `Makespec` options to a option-parser instance or a option group. 
    &quot;&quot;&quot;</span>
    <span class="s1">g = parser.add_argument_group(</span><span class="s4">'What to generate'</span><span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-D&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--onedir&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;onefile&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_false&quot;</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">False,</span>
        <span class="s1">help=</span><span class="s4">&quot;Create a one-folder bundle containing an executable (default)&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-F&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--onefile&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;onefile&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">False,</span>
        <span class="s1">help=</span><span class="s4">&quot;Create a one-file bundled executable.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--specpath&quot;</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;DIR&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Folder to store the generated spec file (default: current directory)&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-n&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--name&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Name to assign to the bundled app and spec file (default: first script's basename)&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g = parser.add_argument_group(</span><span class="s4">'What to bundle, where to search'</span><span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--add-data'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">'append'</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">type=add_data_or_binary</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">'&lt;SRC;DEST or SRC:DEST&gt;'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'datas'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Additional non-binary files or folders to be added to the executable. The path separator  is platform '</span>
        <span class="s4">'specific, ``os.pathsep`` (which is ``;`` on Windows and ``:`` on most unix systems) is used. This option '</span>
        <span class="s4">'can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--add-binary'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">'append'</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">type=add_data_or_binary</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">'&lt;SRC;DEST or SRC:DEST&gt;'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;binaries&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Additional binary files to be added to the executable. See the ``--add-data`` option for more details. '</span>
        <span class="s4">'This option can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-p&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--paths&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;pathex&quot;</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;DIR&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;A path to search for imports (like using PYTHONPATH). Multiple paths are allowed, separated by ``%s``, &quot;</span>
        <span class="s4">&quot;or use this option multiple times. Equivalent to supplying the ``pathex`` argument in the spec file.&quot; </span><span class="s1">%</span>
        <span class="s1">repr(os.pathsep)</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--hidden-import'</span><span class="s3">,</span>
        <span class="s4">'--hiddenimport'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">'append'</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;MODULENAME&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'hiddenimports'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Name an import not visible in the code of the script(s). This option can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--collect-submodules'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;MODULENAME&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'collect_submodules'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Collect all submodules from the specified package or module. This option can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--collect-data'</span><span class="s3">,</span>
        <span class="s4">'--collect-datas'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;MODULENAME&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'collect_data'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Collect all data from the specified package or module. This option can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--collect-binaries'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;MODULENAME&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'collect_binaries'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Collect all binaries from the specified package or module. This option can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--collect-all'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;MODULENAME&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'collect_all'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Collect all submodules, data files, and binaries from the specified package or module. This option can '</span>
        <span class="s4">'be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--copy-metadata'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;PACKAGENAME&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'copy_metadata'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Copy metadata for the specified package. This option can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--recursive-copy-metadata'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;PACKAGENAME&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'recursive_copy_metadata'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Copy metadata for the specified package and all its dependencies. This option can be used multiple '</span>
        <span class="s4">'times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--additional-hooks-dir&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;hookspath&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;An additional path to search for hooks. This option can be used multiple times.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--runtime-hook'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">'append'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'runtime_hooks'</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Path to a custom runtime hook file. A runtime hook is code that is bundled with the executable and is '</span>
        <span class="s4">'executed before any other code or module to set up special features of the runtime environment. This option '</span>
        <span class="s4">'can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--exclude-module'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'excludes'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">'append'</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Optional module or package (the Python name, not the path name) that will be ignored (as though it was '</span>
        <span class="s4">'not found). This option can be used multiple times.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--key'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'key'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'The key used to encrypt Python bytecode.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--splash'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'splash'</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;IMAGE_FILE&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;(EXPERIMENTAL) Add an splash screen with the image IMAGE_FILE to the application. The splash screen can &quot;</span>
        <span class="s4">&quot;display progress updates while unpacking.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g = parser.add_argument_group(</span><span class="s4">'How to generate'</span><span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-d&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--debug&quot;</span><span class="s3">,</span>
        <span class="s0"># If this option is not specified, then its default value is an empty list (no debug options selected).</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s0"># Note that ``nargs`` is omitted. This produces a single item not stored in a list, as opposed to a list</span>
        <span class="s0"># containing one item, as per `nargs &lt;https://docs.python.org/3/library/argparse.html#nargs&gt;`_.</span>
        <span class="s1">nargs=</span><span class="s3">None,</span>
        <span class="s0"># The options specified must come from this list.</span>
        <span class="s1">choices=DEBUG_ALL_CHOICE + DEBUG_ARGUMENT_CHOICES</span><span class="s3">,</span>
        <span class="s0"># Append choice, rather than storing them (which would overwrite any previous selections).</span>
        <span class="s1">action=</span><span class="s4">'append'</span><span class="s3">,</span>
        <span class="s0"># Allow newlines in the help text; see the ``_SmartFormatter`` in ``__main__.py``.</span>
        <span class="s1">help=(</span>
            <span class="s4">&quot;R|Provide assistance with debugging a frozen</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;application. This argument may be provided multiple</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;times to select several of the following options.</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;- all: All three of the following options.</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;- imports: specify the -v option to the underlying</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  Python interpreter, causing it to print a message</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  each time a module is initialized, showing the</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  place (filename or built-in module) from which it</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  is loaded. See</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  https://docs.python.org/3/using/cmdline.html#id4.</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;- bootloader: tell the bootloader to issue progress</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  messages while initializing and starting the</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  bundled app. Used to diagnose problems with</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  missing imports.</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;- noarchive: instead of storing all frozen Python</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  source files as an archive inside the resulting</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  executable, store them as files in the resulting</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;  output directory.</span><span class="s3">\n</span><span class="s4">&quot;</span>
            <span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot;</span>
        <span class="s1">)</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--python-option'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'python_options'</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">'PYTHON_OPTION'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">'append'</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">'Specify a command-line option to pass to the Python interpreter at runtime. Currently supports '</span>
        <span class="s4">'&quot;v&quot; (equivalent to &quot;--debug imports&quot;), &quot;u&quot;, and &quot;W &lt;warning control&gt;&quot;.'</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-s&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--strip&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Apply a symbol-table strip to the executable and shared libs (not recommended for Windows)&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--noupx&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">False,</span>
        <span class="s1">help=</span><span class="s4">&quot;Do not use UPX even if it is available (works differently between Windows and *nix)&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--upx-exclude&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;upx_exclude&quot;</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;FILE&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Prevent a binary from being compressed when using upx. This is typically used if upx corrupts certain &quot;</span>
        <span class="s4">&quot;binaries during compression. FILE is the filename of the binary without path. This option can be used &quot;</span>
        <span class="s4">&quot;multiple times.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g = parser.add_argument_group(</span><span class="s4">'Windows and Mac OS X specific options'</span><span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-c&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--console&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--nowindowed&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;console&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">True,</span>
        <span class="s1">help=</span><span class="s4">&quot;Open a console window for standard i/o (default). On Windows this option has no effect if the first &quot;</span>
        <span class="s4">&quot;script is a '.pyw' file.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-w&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--windowed&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--noconsole&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;console&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_false&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Windows and Mac OS X: do not provide a console window for standard i/o. On Mac OS this also triggers &quot;</span>
        <span class="s4">&quot;building a Mac OS .app bundle. On Windows this option is automatically set if the first script is a '.pyw' &quot;</span>
        <span class="s4">&quot;file. This option is ignored on *NIX systems.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-i&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--icon&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;icon_file&quot;</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">'&lt;FILE.ico or FILE.exe,ID or FILE.icns or &quot;NONE&quot;&gt;'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;FILE.ico: apply the icon to a Windows executable. FILE.exe,ID: extract the icon with ID from an exe. &quot;</span>
        <span class="s4">&quot;FILE.icns: apply the icon to the .app bundle on Mac OS. Use </span><span class="s3">\&quot;</span><span class="s4">NONE</span><span class="s3">\&quot; </span><span class="s4">to not apply any icon, thereby making &quot;</span>
        <span class="s4">&quot;the OS to show some default (default: apply PyInstaller's icon)&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--disable-windowed-traceback&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;disable_windowed_traceback&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">False,</span>
        <span class="s1">help=</span><span class="s4">&quot;Disable traceback dump of unhandled exception in windowed (noconsole) mode (Windows and macOS only), &quot;</span>
        <span class="s4">&quot;and instead display a message that this feature is disabled.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g = parser.add_argument_group(</span><span class="s4">'Windows specific options'</span><span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--version-file&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;version_file&quot;</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;FILE&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Add a version resource from FILE to the exe.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-m&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--manifest&quot;</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;&lt;FILE or XML&gt;&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Add manifest FILE or XML to the exe.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--no-embed-manifest&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;embed_manifest&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_false&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Generate an external .exe.manifest file instead of embedding the manifest into the exe. Applicable only &quot;</span>
        <span class="s4">&quot;to onedir mode; in onefile mode, the manifest is always embedded, regardless of this option.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;-r&quot;</span><span class="s3">,</span>
        <span class="s4">&quot;--resource&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;resources&quot;</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;RESOURCE&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;append&quot;</span><span class="s3">,</span>
        <span class="s1">default=[]</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Add or update a resource to a Windows executable. The RESOURCE is one to four items, &quot;</span>
        <span class="s4">&quot;FILE[,TYPE[,NAME[,LANGUAGE]]]. FILE can be a data file or an exe/dll. For data files, at least TYPE and NAME &quot;</span>
        <span class="s4">&quot;must be specified. LANGUAGE defaults to 0 or may be specified as wildcard * to update all resources of the &quot;</span>
        <span class="s4">&quot;given TYPE and NAME. For exe/dll files, all resources from FILE will be added/updated to the final executable &quot;</span>
        <span class="s4">&quot;if TYPE, NAME and LANGUAGE are omitted or specified as wildcard *. This option can be used multiple times.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--uac-admin'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'uac_admin'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">False,</span>
        <span class="s1">help=</span><span class="s4">&quot;Using this option creates a Manifest that will request elevation upon application start.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--uac-uiaccess'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'uac_uiaccess'</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">False,</span>
        <span class="s1">help=</span><span class="s4">&quot;Using this option allows an elevated application to work with Remote Desktop.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g = parser.add_argument_group(</span><span class="s4">'Windows Side-by-side Assembly searching options (advanced)'</span><span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--win-private-assemblies&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;win_private_assemblies&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Any Shared Assemblies bundled into the application will be changed into Private Assemblies. This means &quot;</span>
        <span class="s4">&quot;the exact versions of these assemblies will always be used, and any newer versions installed on user machines &quot;</span>
        <span class="s4">&quot;at the system level will be ignored.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--win-no-prefer-redirects&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;win_no_prefer_redirects&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;While searching for Shared or Private Assemblies to bundle into the application, PyInstaller will &quot;</span>
        <span class="s4">&quot;prefer not to follow policies that redirect to newer versions, and will try to bundle the exact versions of &quot;</span>
        <span class="s4">&quot;the assembly.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g = parser.add_argument_group(</span><span class="s4">'Mac OS specific options'</span><span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">'--osx-bundle-identifier'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'bundle_identifier'</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Mac OS .app bundle identifier is used as the default unique program name for code signing purposes. &quot;</span>
        <span class="s4">&quot;The usual form is a hierarchical name in reverse DNS notation. For example: com.mycompany.department.appname &quot;</span>
        <span class="s4">&quot;(default: first script's basename)&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g.add_argument(</span>
        <span class="s4">'--target-architecture'</span><span class="s3">,</span>
        <span class="s4">'--target-arch'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'target_arch'</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">'ARCH'</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">None,</span>
        <span class="s1">help=</span><span class="s4">&quot;Target architecture (macOS only; valid values: x86_64, arm64, universal2). Enables switching between &quot;</span>
        <span class="s4">&quot;universal2 and single-arch version of frozen application (provided python installation supports the target &quot;</span>
        <span class="s4">&quot;architecture). If not target architecture is not specified, the current running architecture is targeted.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g.add_argument(</span>
        <span class="s4">'--codesign-identity'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'codesign_identity'</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">'IDENTITY'</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">None,</span>
        <span class="s1">help=</span><span class="s4">&quot;Code signing identity (macOS only). Use the provided identity to sign collected binaries and generated &quot;</span>
        <span class="s4">&quot;executable. If signing identity is not provided, ad-hoc signing is performed instead.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g.add_argument(</span>
        <span class="s4">'--osx-entitlements-file'</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">'entitlements_file'</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">'FILENAME'</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">None,</span>
        <span class="s1">help=</span><span class="s4">&quot;Entitlements file to use when code-signing the collected binaries (macOS only).&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>

    <span class="s1">g = parser.add_argument_group(</span><span class="s4">'Rarely used special options'</span><span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--runtime-tmpdir&quot;</span><span class="s3">,</span>
        <span class="s1">dest=</span><span class="s4">&quot;runtime_tmpdir&quot;</span><span class="s3">,</span>
        <span class="s1">metavar=</span><span class="s4">&quot;PATH&quot;</span><span class="s3">,</span>
        <span class="s1">help=</span><span class="s4">&quot;Where to extract libraries and support files in `onefile`-mode. If this option is given, the bootloader &quot;</span>
        <span class="s4">&quot;will ignore any temp-folder location defined by the run-time OS. The ``_MEIxxxxxx``-folder will be created &quot;</span>
        <span class="s4">&quot;here. Please use this option only if you know what you are doing.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>
    <span class="s1">g.add_argument(</span>
        <span class="s4">&quot;--bootloader-ignore-signals&quot;</span><span class="s3">,</span>
        <span class="s1">action=</span><span class="s4">&quot;store_true&quot;</span><span class="s3">,</span>
        <span class="s1">default=</span><span class="s3">False,</span>
        <span class="s1">help=</span><span class="s4">&quot;Tell the bootloader to ignore signals rather than forwarding them to the child process. Useful in &quot;</span>
        <span class="s4">&quot;situations where for example a supervisor process signals both the bootloader and the child (e.g., via a &quot;</span>
        <span class="s4">&quot;process group) to avoid signalling the child twice.&quot;</span><span class="s3">,</span>
    <span class="s1">)</span>


<span class="s3">def </span><span class="s1">main(</span>
    <span class="s1">scripts</span><span class="s3">,</span>
    <span class="s1">name=</span><span class="s3">None,</span>
    <span class="s1">onefile=</span><span class="s3">False,</span>
    <span class="s1">console=</span><span class="s3">True,</span>
    <span class="s1">debug=[]</span><span class="s3">,</span>
    <span class="s1">python_options=[]</span><span class="s3">,</span>
    <span class="s1">strip=</span><span class="s3">False,</span>
    <span class="s1">noupx=</span><span class="s3">False,</span>
    <span class="s1">upx_exclude=</span><span class="s3">None,</span>
    <span class="s1">runtime_tmpdir=</span><span class="s3">None,</span>
    <span class="s1">pathex=[]</span><span class="s3">,</span>
    <span class="s1">version_file=</span><span class="s3">None,</span>
    <span class="s1">specpath=</span><span class="s3">None,</span>
    <span class="s1">bootloader_ignore_signals=</span><span class="s3">False,</span>
    <span class="s1">disable_windowed_traceback=</span><span class="s3">False,</span>
    <span class="s1">datas=[]</span><span class="s3">,</span>
    <span class="s1">binaries=[]</span><span class="s3">,</span>
    <span class="s1">icon_file=</span><span class="s3">None,</span>
    <span class="s1">manifest=</span><span class="s3">None,</span>
    <span class="s1">embed_manifest=</span><span class="s3">True,</span>
    <span class="s1">resources=[]</span><span class="s3">,</span>
    <span class="s1">bundle_identifier=</span><span class="s3">None,</span>
    <span class="s1">hiddenimports=[]</span><span class="s3">,</span>
    <span class="s1">hookspath=[]</span><span class="s3">,</span>
    <span class="s1">key=</span><span class="s3">None,</span>
    <span class="s1">runtime_hooks=[]</span><span class="s3">,</span>
    <span class="s1">excludes=[]</span><span class="s3">,</span>
    <span class="s1">uac_admin=</span><span class="s3">False,</span>
    <span class="s1">uac_uiaccess=</span><span class="s3">False,</span>
    <span class="s1">win_no_prefer_redirects=</span><span class="s3">False,</span>
    <span class="s1">win_private_assemblies=</span><span class="s3">False,</span>
    <span class="s1">collect_submodules=[]</span><span class="s3">,</span>
    <span class="s1">collect_binaries=[]</span><span class="s3">,</span>
    <span class="s1">collect_data=[]</span><span class="s3">,</span>
    <span class="s1">collect_all=[]</span><span class="s3">,</span>
    <span class="s1">copy_metadata=[]</span><span class="s3">,</span>
    <span class="s1">splash=</span><span class="s3">None,</span>
    <span class="s1">recursive_copy_metadata=[]</span><span class="s3">,</span>
    <span class="s1">target_arch=</span><span class="s3">None,</span>
    <span class="s1">codesign_identity=</span><span class="s3">None,</span>
    <span class="s1">entitlements_file=</span><span class="s3">None,</span>
    <span class="s1">**_kwargs</span>
<span class="s1">):</span>
    <span class="s0"># If appname is not specified - use the basename of the main script as name.</span>
    <span class="s3">if </span><span class="s1">name </span><span class="s3">is None</span><span class="s1">:</span>
        <span class="s1">name = os.path.splitext(os.path.basename(scripts[</span><span class="s5">0</span><span class="s1">]))[</span><span class="s5">0</span><span class="s1">]</span>

    <span class="s0"># If specpath not specified - use default value - current working directory.</span>
    <span class="s3">if </span><span class="s1">specpath </span><span class="s3">is None</span><span class="s1">:</span>
        <span class="s1">specpath = DEFAULT_SPECPATH</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s0"># Expand tilde to user's home directory.</span>
        <span class="s1">specpath = expand_path(specpath)</span>
    <span class="s0"># If cwd is the root directory of PyInstaller, generate the .spec file in ./appname/ subdirectory.</span>
    <span class="s3">if </span><span class="s1">specpath == HOMEPATH:</span>
        <span class="s1">specpath = os.path.join(HOMEPATH</span><span class="s3">, </span><span class="s1">name)</span>
    <span class="s0"># Create directory tree if missing.</span>
    <span class="s3">if not </span><span class="s1">os.path.exists(specpath):</span>
        <span class="s1">os.makedirs(specpath)</span>

    <span class="s0"># Handle additional EXE options.</span>
    <span class="s1">exe_options = </span><span class="s4">''</span>
    <span class="s3">if </span><span class="s1">version_file:</span>
        <span class="s1">exe_options = </span><span class="s4">&quot;%s, version='%s'&quot; </span><span class="s1">% (exe_options</span><span class="s3">, </span><span class="s1">quote_win_filepath(version_file))</span>
    <span class="s3">if </span><span class="s1">uac_admin:</span>
        <span class="s1">exe_options = </span><span class="s4">&quot;%s, uac_admin=%s&quot; </span><span class="s1">% (exe_options</span><span class="s3">, </span><span class="s4">'True'</span><span class="s1">)</span>
    <span class="s3">if </span><span class="s1">uac_uiaccess:</span>
        <span class="s1">exe_options = </span><span class="s4">&quot;%s, uac_uiaccess=%s&quot; </span><span class="s1">% (exe_options</span><span class="s3">, </span><span class="s4">'True'</span><span class="s1">)</span>
    <span class="s3">if </span><span class="s1">icon_file:</span>
        <span class="s0"># Icon file for Windows.</span>
        <span class="s0"># On Windows, the default icon is embedded in the bootloader executable.</span>
        <span class="s1">exe_options = </span><span class="s4">&quot;%s, icon='%s'&quot; </span><span class="s1">% (exe_options</span><span class="s3">, </span><span class="s1">quote_win_filepath(icon_file))</span>
        <span class="s0"># Icon file for Mac OS.</span>
        <span class="s0"># We need to encapsulate it into apostrofes.</span>
        <span class="s1">icon_file = </span><span class="s4">&quot;'%s'&quot; </span><span class="s1">% icon_file</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s0"># On Mac OS, the default icon has to be copied into the .app bundle.</span>
        <span class="s0"># The the text value 'None' means - use default icon.</span>
        <span class="s1">icon_file = </span><span class="s4">'None'</span>

    <span class="s3">if </span><span class="s1">bundle_identifier:</span>
        <span class="s0"># We need to encapsulate it into apostrofes.</span>
        <span class="s1">bundle_identifier = </span><span class="s4">&quot;'%s'&quot; </span><span class="s1">% bundle_identifier</span>

    <span class="s3">if </span><span class="s1">manifest:</span>
        <span class="s3">if </span><span class="s4">&quot;&lt;&quot; </span><span class="s3">in </span><span class="s1">manifest:</span>
            <span class="s0"># Assume XML string</span>
            <span class="s1">exe_options = </span><span class="s4">&quot;%s, manifest='%s'&quot; </span><span class="s1">% (exe_options</span><span class="s3">, </span><span class="s1">manifest.replace(</span><span class="s4">&quot;'&quot;</span><span class="s3">, </span><span class="s4">&quot;</span><span class="s3">\\</span><span class="s4">'&quot;</span><span class="s1">))</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s0"># Assume filename</span>
            <span class="s1">exe_options = </span><span class="s4">&quot;%s, manifest='%s'&quot; </span><span class="s1">% (exe_options</span><span class="s3">, </span><span class="s1">quote_win_filepath(manifest))</span>
    <span class="s3">if not </span><span class="s1">embed_manifest:</span>
        <span class="s1">exe_options = </span><span class="s4">&quot;%s, embed_manifest=%s&quot; </span><span class="s1">% (exe_options</span><span class="s3">, </span><span class="s4">'False'</span><span class="s1">)</span>
    <span class="s3">if </span><span class="s1">resources:</span>
        <span class="s1">resources = list(map(quote_win_filepath</span><span class="s3">, </span><span class="s1">resources))</span>
        <span class="s1">exe_options = </span><span class="s4">&quot;%s, resources=%s&quot; </span><span class="s1">% (exe_options</span><span class="s3">, </span><span class="s1">repr(resources))</span>

    <span class="s1">hiddenimports = hiddenimports </span><span class="s3">or </span><span class="s1">[]</span>
    <span class="s1">upx_exclude = upx_exclude </span><span class="s3">or </span><span class="s1">[]</span>

    <span class="s0"># If file extension of the first script is '.pyw', force --windowed option.</span>
    <span class="s3">if </span><span class="s1">is_win </span><span class="s3">and </span><span class="s1">os.path.splitext(scripts[</span><span class="s5">0</span><span class="s1">])[-</span><span class="s5">1</span><span class="s1">] == </span><span class="s4">'.pyw'</span><span class="s1">:</span>
        <span class="s1">console = </span><span class="s3">False</span>

    <span class="s0"># If script paths are relative, make them relative to the directory containing .spec file.</span>
    <span class="s1">scripts = [make_path_spec_relative(x</span><span class="s3">, </span><span class="s1">specpath) </span><span class="s3">for </span><span class="s1">x </span><span class="s3">in </span><span class="s1">scripts]</span>
    <span class="s0"># With absolute paths replace prefix with variable HOMEPATH.</span>
    <span class="s1">scripts = list(map(Path</span><span class="s3">, </span><span class="s1">scripts))</span>

    <span class="s3">if </span><span class="s1">key:</span>
        <span class="s0"># Try to import tinyaes as we need it for bytecode obfuscation.</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s3">import </span><span class="s1">tinyaes  </span><span class="s0"># noqa: F401 (test import)</span>
        <span class="s3">except </span><span class="s1">ImportError:</span>
            <span class="s1">logger.error(</span>
                <span class="s4">'We need tinyaes to use byte-code obfuscation but we could not find it. You can install it '</span>
                <span class="s4">'with pip by running:</span><span class="s3">\n  </span><span class="s4">pip install tinyaes'</span>
            <span class="s1">)</span>
            <span class="s1">sys.exit(</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">cipher_init = cipher_init_template % {</span><span class="s4">'key'</span><span class="s1">: key}</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">cipher_init = cipher_absent_template</span>

    <span class="s0"># Translate the default of ``debug=None`` to an empty list.</span>
    <span class="s3">if </span><span class="s1">debug </span><span class="s3">is None</span><span class="s1">:</span>
        <span class="s1">debug = []</span>
    <span class="s0"># Translate the ``all`` option.</span>
    <span class="s3">if </span><span class="s1">DEBUG_ALL_CHOICE[</span><span class="s5">0</span><span class="s1">] </span><span class="s3">in </span><span class="s1">debug:</span>
        <span class="s1">debug = DEBUG_ARGUMENT_CHOICES</span>

    <span class="s0"># Create preamble (for collect_*() calls)</span>
    <span class="s1">preamble = Preamble(</span>
        <span class="s1">datas</span><span class="s3">, </span><span class="s1">binaries</span><span class="s3">, </span><span class="s1">hiddenimports</span><span class="s3">, </span><span class="s1">collect_data</span><span class="s3">, </span><span class="s1">collect_binaries</span><span class="s3">, </span><span class="s1">collect_submodules</span><span class="s3">, </span><span class="s1">collect_all</span><span class="s3">, </span><span class="s1">copy_metadata</span><span class="s3">,</span>
        <span class="s1">recursive_copy_metadata</span>
    <span class="s1">)</span>

    <span class="s3">if </span><span class="s1">splash:</span>
        <span class="s1">splash_init = splashtmpl % {</span><span class="s4">'splash_image'</span><span class="s1">: splash}</span>
        <span class="s1">splash_binaries = </span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot; </span><span class="s1">+ </span><span class="s4">&quot; &quot; </span><span class="s1">* (</span><span class="s5">10 </span><span class="s3">if </span><span class="s1">onefile </span><span class="s3">else </span><span class="s5">15</span><span class="s1">) + </span><span class="s4">&quot;splash.binaries,&quot;</span>
        <span class="s1">splash_target = </span><span class="s4">&quot;</span><span class="s3">\n</span><span class="s4">&quot; </span><span class="s1">+ </span><span class="s4">&quot; &quot; </span><span class="s1">* </span><span class="s5">10 </span><span class="s1">+ </span><span class="s4">&quot;splash,&quot;</span>
    <span class="s3">else</span><span class="s1">:</span>
        <span class="s1">splash_init = splash_binaries = splash_target = </span><span class="s4">&quot;&quot;</span>

    <span class="s0"># Create OPTIONs array</span>
    <span class="s3">if </span><span class="s4">'imports' </span><span class="s3">in </span><span class="s1">debug </span><span class="s3">and </span><span class="s4">'v' </span><span class="s3">not in </span><span class="s1">python_options:</span>
        <span class="s1">python_options.append(</span><span class="s4">'v'</span><span class="s1">)</span>
    <span class="s1">python_options_array = [(opt</span><span class="s3">, None, </span><span class="s4">'OPTION'</span><span class="s1">) </span><span class="s3">for </span><span class="s1">opt </span><span class="s3">in </span><span class="s1">python_options]</span>

    <span class="s1">d = {</span>
        <span class="s4">'scripts'</span><span class="s1">: scripts</span><span class="s3">,</span>
        <span class="s4">'pathex'</span><span class="s1">: pathex </span><span class="s3">or </span><span class="s1">[]</span><span class="s3">,</span>
        <span class="s4">'binaries'</span><span class="s1">: preamble.binaries</span><span class="s3">,</span>
        <span class="s4">'datas'</span><span class="s1">: preamble.datas</span><span class="s3">,</span>
        <span class="s4">'hiddenimports'</span><span class="s1">: preamble.hiddenimports</span><span class="s3">,</span>
        <span class="s4">'preamble'</span><span class="s1">: preamble.content</span><span class="s3">,</span>
        <span class="s4">'name'</span><span class="s1">: name</span><span class="s3">,</span>
        <span class="s4">'noarchive'</span><span class="s1">: </span><span class="s4">'noarchive' </span><span class="s3">in </span><span class="s1">debug</span><span class="s3">,</span>
        <span class="s4">'options'</span><span class="s1">: python_options_array</span><span class="s3">,</span>
        <span class="s4">'debug_bootloader'</span><span class="s1">: </span><span class="s4">'bootloader' </span><span class="s3">in </span><span class="s1">debug</span><span class="s3">,</span>
        <span class="s4">'bootloader_ignore_signals'</span><span class="s1">: bootloader_ignore_signals</span><span class="s3">,</span>
        <span class="s4">'strip'</span><span class="s1">: strip</span><span class="s3">,</span>
        <span class="s4">'upx'</span><span class="s1">: </span><span class="s3">not </span><span class="s1">noupx</span><span class="s3">,</span>
        <span class="s4">'upx_exclude'</span><span class="s1">: upx_exclude</span><span class="s3">,</span>
        <span class="s4">'runtime_tmpdir'</span><span class="s1">: runtime_tmpdir</span><span class="s3">,</span>
        <span class="s4">'exe_options'</span><span class="s1">: exe_options</span><span class="s3">,</span>
        <span class="s4">'cipher_init'</span><span class="s1">: cipher_init</span><span class="s3">,</span>
        <span class="s0"># Directory with additional custom import hooks.</span>
        <span class="s4">'hookspath'</span><span class="s1">: hookspath</span><span class="s3">,</span>
        <span class="s0"># List with custom runtime hook files.</span>
        <span class="s4">'runtime_hooks'</span><span class="s1">: runtime_hooks </span><span class="s3">or </span><span class="s1">[]</span><span class="s3">,</span>
        <span class="s0"># List of modules/pakages to ignore.</span>
        <span class="s4">'excludes'</span><span class="s1">: excludes </span><span class="s3">or </span><span class="s1">[]</span><span class="s3">,</span>
        <span class="s0"># only Windows and Mac OS distinguish windowed and console apps</span>
        <span class="s4">'console'</span><span class="s1">: console</span><span class="s3">,</span>
        <span class="s4">'disable_windowed_traceback'</span><span class="s1">: disable_windowed_traceback</span><span class="s3">,</span>
        <span class="s0"># Icon filename. Only Mac OS uses this item.</span>
        <span class="s4">'icon'</span><span class="s1">: icon_file</span><span class="s3">,</span>
        <span class="s0"># .app bundle identifier. Only OSX uses this item.</span>
        <span class="s4">'bundle_identifier'</span><span class="s1">: bundle_identifier</span><span class="s3">,</span>
        <span class="s0"># Target architecture (macOS only)</span>
        <span class="s4">'target_arch'</span><span class="s1">: target_arch</span><span class="s3">,</span>
        <span class="s0"># Code signing identity (macOS only)</span>
        <span class="s4">'codesign_identity'</span><span class="s1">: codesign_identity</span><span class="s3">,</span>
        <span class="s0"># Entitlements file (macOS only)</span>
        <span class="s4">'entitlements_file'</span><span class="s1">: entitlements_file</span><span class="s3">,</span>
        <span class="s0"># Windows assembly searching options</span>
        <span class="s4">'win_no_prefer_redirects'</span><span class="s1">: win_no_prefer_redirects</span><span class="s3">,</span>
        <span class="s4">'win_private_assemblies'</span><span class="s1">: win_private_assemblies</span><span class="s3">,</span>
        <span class="s0"># splash screen</span>
        <span class="s4">'splash_init'</span><span class="s1">: splash_init</span><span class="s3">,</span>
        <span class="s4">'splash_target'</span><span class="s1">: splash_target</span><span class="s3">,</span>
        <span class="s4">'splash_binaries'</span><span class="s1">: splash_binaries</span><span class="s3">,</span>
    <span class="s1">}</span>

    <span class="s0"># Write down .spec file to filesystem.</span>
    <span class="s1">specfnm = os.path.join(specpath</span><span class="s3">, </span><span class="s1">name + </span><span class="s4">'.spec'</span><span class="s1">)</span>
    <span class="s3">with </span><span class="s1">open(specfnm</span><span class="s3">, </span><span class="s4">'w'</span><span class="s3">, </span><span class="s1">encoding=</span><span class="s4">'utf-8'</span><span class="s1">) </span><span class="s3">as </span><span class="s1">specfile:</span>
        <span class="s3">if </span><span class="s1">onefile:</span>
            <span class="s1">specfile.write(onefiletmplt % d)</span>
            <span class="s0"># For Mac OS create .app bundle.</span>
            <span class="s3">if </span><span class="s1">is_darwin </span><span class="s3">and not </span><span class="s1">console:</span>
                <span class="s1">specfile.write(bundleexetmplt % d)</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">specfile.write(onedirtmplt % d)</span>
            <span class="s0"># For Mac OS create .app bundle.</span>
            <span class="s3">if </span><span class="s1">is_darwin </span><span class="s3">and not </span><span class="s1">console:</span>
                <span class="s1">specfile.write(bundletmplt % d)</span>

    <span class="s3">return </span><span class="s1">specfnm</span>
</pre>
</body>
</html>