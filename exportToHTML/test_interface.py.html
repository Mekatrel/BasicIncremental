<html>
<head>
<title>test_interface.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #808080;}
.s1 { color: #a9b7c6;}
.s2 { color: #629755; font-style: italic;}
.s3 { color: #cc7832;}
.s4 { color: #6a8759;}
.s5 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
test_interface.py</font>
</center></td></tr></table>
<pre><span class="s0">##############################################################################</span>
<span class="s0">#</span>
<span class="s0"># Copyright (c) 2001, 2002 Zope Foundation and Contributors.</span>
<span class="s0"># All Rights Reserved.</span>
<span class="s0">#</span>
<span class="s0"># This software is subject to the provisions of the Zope Public License,</span>
<span class="s0"># Version 2.1 (ZPL).  A copy of the ZPL should accompany this distribution.</span>
<span class="s0"># THIS SOFTWARE IS PROVIDED &quot;AS IS&quot; AND ANY AND ALL EXPRESS OR IMPLIED</span>
<span class="s0"># WARRANTIES ARE DISCLAIMED, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<span class="s0"># WARRANTIES OF TITLE, MERCHANTABILITY, AGAINST INFRINGEMENT, AND FITNESS</span>
<span class="s0"># FOR A PARTICULAR PURPOSE.</span>
<span class="s0">#</span>
<span class="s0">##############################################################################</span>
<span class="s2">&quot;&quot;&quot;Test Interface implementation 
&quot;&quot;&quot;</span>
<span class="s0"># Things we let slide because it's a test</span>
<span class="s0"># pylint:disable=protected-access,blacklisted-name,attribute-defined-outside-init</span>
<span class="s0"># pylint:disable=too-many-public-methods,too-many-lines,abstract-method</span>
<span class="s0"># pylint:disable=redefined-builtin,signature-differs,arguments-differ</span>
<span class="s0"># Things you get inheriting from Interface</span>
<span class="s0"># pylint:disable=inherit-non-class,no-self-argument,no-method-argument</span>
<span class="s0"># Things you get using methods of an Interface 'subclass'</span>
<span class="s0"># pylint:disable=no-value-for-parameter</span>
<span class="s3">import </span><span class="s1">unittest</span>

<span class="s3">from </span><span class="s1">zope.interface._compat </span><span class="s3">import </span><span class="s1">_skip_under_py3k</span>
<span class="s3">from </span><span class="s1">zope.interface.tests </span><span class="s3">import </span><span class="s1">MissingSomeAttrs</span>
<span class="s3">from </span><span class="s1">zope.interface.tests </span><span class="s3">import </span><span class="s1">OptimizationTestMixin</span>
<span class="s3">from </span><span class="s1">zope.interface.tests </span><span class="s3">import </span><span class="s1">CleanUp</span>

<span class="s1">_marker = object()</span>


<span class="s3">class </span><span class="s1">Test_invariant(unittest.TestCase):</span>

    <span class="s3">def </span><span class="s1">test_w_single(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">invariant</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">TAGGED_DATA</span>

        <span class="s3">def </span><span class="s1">_check(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s3">class </span><span class="s1">Foo(object):</span>
            <span class="s1">invariant(_check)</span>

        <span class="s1">self.assertEqual(getattr(Foo</span><span class="s3">, </span><span class="s1">TAGGED_DATA</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">{</span><span class="s4">'invariants'</span><span class="s1">: [_check]})</span>

    <span class="s3">def </span><span class="s1">test_w_multiple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">invariant</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">TAGGED_DATA</span>

        <span class="s3">def </span><span class="s1">_check(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s3">def </span><span class="s1">_another_check(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s3">class </span><span class="s1">Foo(object):</span>
            <span class="s1">invariant(_check)</span>
            <span class="s1">invariant(_another_check)</span>

        <span class="s1">self.assertEqual(getattr(Foo</span><span class="s3">, </span><span class="s1">TAGGED_DATA</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">{</span><span class="s4">'invariants'</span><span class="s1">: [_check</span><span class="s3">, </span><span class="s1">_another_check]})</span>


<span class="s3">class </span><span class="s1">Test_taggedValue(unittest.TestCase):</span>

    <span class="s3">def </span><span class="s1">test_w_single(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">taggedValue</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">TAGGED_DATA</span>

        <span class="s3">class </span><span class="s1">Foo(object):</span>
            <span class="s1">taggedValue(</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'baz'</span><span class="s1">])</span>

        <span class="s1">self.assertEqual(getattr(Foo</span><span class="s3">, </span><span class="s1">TAGGED_DATA</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">{</span><span class="s4">'bar'</span><span class="s1">: [</span><span class="s4">'baz'</span><span class="s1">]})</span>

    <span class="s3">def </span><span class="s1">test_w_multiple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">taggedValue</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">TAGGED_DATA</span>

        <span class="s3">class </span><span class="s1">Foo(object):</span>
            <span class="s1">taggedValue(</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'baz'</span><span class="s1">])</span>
            <span class="s1">taggedValue(</span><span class="s4">'qux'</span><span class="s3">, </span><span class="s4">'spam'</span><span class="s1">)</span>

        <span class="s1">self.assertEqual(getattr(Foo</span><span class="s3">, </span><span class="s1">TAGGED_DATA</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">{</span><span class="s4">'bar'</span><span class="s1">: [</span><span class="s4">'baz'</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'qux'</span><span class="s1">: </span><span class="s4">'spam'</span><span class="s1">})</span>

    <span class="s3">def </span><span class="s1">test_w_multiple_overwriting(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">taggedValue</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">TAGGED_DATA</span>

        <span class="s3">class </span><span class="s1">Foo(object):</span>
            <span class="s1">taggedValue(</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'baz'</span><span class="s1">])</span>
            <span class="s1">taggedValue(</span><span class="s4">'qux'</span><span class="s3">, </span><span class="s4">'spam'</span><span class="s1">)</span>
            <span class="s1">taggedValue(</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s4">'frob'</span><span class="s1">)</span>

        <span class="s1">self.assertEqual(getattr(Foo</span><span class="s3">, </span><span class="s1">TAGGED_DATA</span><span class="s3">, None</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">{</span><span class="s4">'bar'</span><span class="s1">: </span><span class="s4">'frob'</span><span class="s3">, </span><span class="s4">'qux'</span><span class="s1">: </span><span class="s4">'spam'</span><span class="s1">})</span>


<span class="s3">class </span><span class="s1">ElementTests(unittest.TestCase):</span>

    <span class="s1">DEFAULT_NAME = </span><span class="s4">'AnElement'</span>

    <span class="s3">def </span><span class="s1">_getTargetClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Element</span>
        <span class="s3">return </span><span class="s1">Element</span>

    <span class="s3">def </span><span class="s1">_makeOne(self</span><span class="s3">, </span><span class="s1">name=</span><span class="s3">None</span><span class="s1">):</span>
        <span class="s3">if </span><span class="s1">name </span><span class="s3">is None</span><span class="s1">:</span>
            <span class="s1">name = self.DEFAULT_NAME</span>
        <span class="s3">return </span><span class="s1">self._getTargetClass()(name)</span>

    <span class="s3">def </span><span class="s1">test_ctor_defaults(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">self.assertEqual(element.__name__</span><span class="s3">, </span><span class="s1">self.DEFAULT_NAME)</span>
        <span class="s1">self.assertEqual(element.getName()</span><span class="s3">, </span><span class="s1">self.DEFAULT_NAME)</span>
        <span class="s1">self.assertEqual(element.__doc__</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(element.getDoc()</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(element.getTaggedValueTags())</span><span class="s3">, </span><span class="s1">[])</span>

    <span class="s3">def </span><span class="s1">test_ctor_no_doc_space_in_name(self):</span>
        <span class="s1">element = self._makeOne(</span><span class="s4">'An Element'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(element.__name__</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(element.__doc__</span><span class="s3">, </span><span class="s4">'An Element'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getTaggedValue_miss(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">self.assertRaises(KeyError</span><span class="s3">, </span><span class="s1">element.getTaggedValue</span><span class="s3">, </span><span class="s4">'nonesuch'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getDirectTaggedValueTags(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">self.assertEqual([]</span><span class="s3">, </span><span class="s1">list(element.getDirectTaggedValueTags()))</span>

        <span class="s1">element.setTaggedValue(</span><span class="s4">'foo'</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual([</span><span class="s4">'foo'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">list(element.getDirectTaggedValueTags()))</span>

    <span class="s3">def </span><span class="s1">test_queryTaggedValue_miss(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">self.assertEqual(element.queryTaggedValue(</span><span class="s4">'nonesuch'</span><span class="s1">)</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_queryTaggedValue_miss_w_default(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">self.assertEqual(element.queryTaggedValue(</span><span class="s4">'nonesuch'</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getDirectTaggedValue_miss(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">self.assertRaises(KeyError</span><span class="s3">, </span><span class="s1">element.getDirectTaggedValue</span><span class="s3">, </span><span class="s4">'nonesuch'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_queryDirectTaggedValue_miss(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">self.assertEqual(element.queryDirectTaggedValue(</span><span class="s4">'nonesuch'</span><span class="s1">)</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_queryDirectTaggedValue_miss_w_default(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">self.assertEqual(element.queryDirectTaggedValue(</span><span class="s4">'nonesuch'</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_setTaggedValue(self):</span>
        <span class="s1">element = self._makeOne()</span>
        <span class="s1">element.setTaggedValue(</span><span class="s4">'foo'</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(element.getTaggedValueTags())</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(element.getTaggedValue(</span><span class="s4">'foo'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(element.queryTaggedValue(</span><span class="s4">'foo'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_verifies(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interfaces </span><span class="s3">import </span><span class="s1">IElement</span>
        <span class="s3">from </span><span class="s1">zope.interface.verify </span><span class="s3">import </span><span class="s1">verifyObject</span>

        <span class="s1">element = self._makeOne()</span>
        <span class="s1">verifyObject(IElement</span><span class="s3">, </span><span class="s1">element)</span>


<span class="s3">class </span><span class="s1">GenericSpecificationBaseTests(unittest.TestCase):</span>
    <span class="s0"># Tests that work with both implementations</span>
    <span class="s3">def </span><span class="s1">_getFallbackClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">SpecificationBasePy </span><span class="s0"># pylint:disable=no-name-in-module</span>
        <span class="s3">return </span><span class="s1">SpecificationBasePy</span>

    <span class="s1">_getTargetClass = _getFallbackClass</span>

    <span class="s3">def </span><span class="s1">_makeOne(self):</span>
        <span class="s3">return </span><span class="s1">self._getTargetClass()()</span>

    <span class="s3">def </span><span class="s1">test_providedBy_miss(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interface</span>
        <span class="s3">from </span><span class="s1">zope.interface.declarations </span><span class="s3">import </span><span class="s1">_empty</span>
        <span class="s1">sb = self._makeOne()</span>
        <span class="s3">def </span><span class="s1">_providedBy(obj):</span>
            <span class="s3">return </span><span class="s1">_empty</span>
        <span class="s3">with </span><span class="s1">_Monkey(interface</span><span class="s3">, </span><span class="s1">providedBy=_providedBy):</span>
            <span class="s1">self.assertFalse(sb.providedBy(object()))</span>

    <span class="s3">def </span><span class="s1">test_implementedBy_miss(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interface</span>
        <span class="s3">from </span><span class="s1">zope.interface.declarations </span><span class="s3">import </span><span class="s1">_empty</span>
        <span class="s1">sb = self._makeOne()</span>
        <span class="s3">def </span><span class="s1">_implementedBy(obj):</span>
            <span class="s3">return </span><span class="s1">_empty</span>
        <span class="s3">with </span><span class="s1">_Monkey(interface</span><span class="s3">, </span><span class="s1">implementedBy=_implementedBy):</span>
            <span class="s1">self.assertFalse(sb.implementedBy(object()))</span>


<span class="s3">class </span><span class="s1">SpecificationBaseTests(GenericSpecificationBaseTests</span><span class="s3">,</span>
                             <span class="s1">OptimizationTestMixin):</span>
    <span class="s0"># Tests that use the C implementation</span>

    <span class="s3">def </span><span class="s1">_getTargetClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">SpecificationBase</span>
        <span class="s3">return </span><span class="s1">SpecificationBase</span>

<span class="s3">class </span><span class="s1">SpecificationBasePyTests(GenericSpecificationBaseTests):</span>
    <span class="s0"># Tests that only work with the Python implementation</span>

    <span class="s3">def </span><span class="s1">test___call___miss(self):</span>
        <span class="s1">sb = self._makeOne()</span>
        <span class="s1">sb._implied = {}  </span><span class="s0"># not defined by SpecificationBasePy</span>
        <span class="s1">self.assertFalse(sb.isOrExtends(object()))</span>

    <span class="s3">def </span><span class="s1">test___call___hit(self):</span>
        <span class="s1">sb = self._makeOne()</span>
        <span class="s1">testing = object()</span>
        <span class="s1">sb._implied = {testing: {}}  </span><span class="s0"># not defined by SpecificationBasePy</span>
        <span class="s1">self.assertTrue(sb(testing))</span>

    <span class="s3">def </span><span class="s1">test_isOrExtends_miss(self):</span>
        <span class="s1">sb = self._makeOne()</span>
        <span class="s1">sb._implied = {}  </span><span class="s0"># not defined by SpecificationBasePy</span>
        <span class="s1">self.assertFalse(sb.isOrExtends(object()))</span>

    <span class="s3">def </span><span class="s1">test_isOrExtends_hit(self):</span>
        <span class="s1">sb = self._makeOne()</span>
        <span class="s1">testing = object()</span>
        <span class="s1">sb._implied = {testing: {}}  </span><span class="s0"># not defined by SpecificationBasePy</span>
        <span class="s1">self.assertTrue(sb(testing))</span>

    <span class="s3">def </span><span class="s1">test_implementedBy_hit(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interface</span>
        <span class="s1">sb = self._makeOne()</span>
        <span class="s3">class </span><span class="s1">_Decl(object):</span>
            <span class="s1">_implied = {sb: {}</span><span class="s3">,</span><span class="s1">}</span>
        <span class="s3">def </span><span class="s1">_implementedBy(obj):</span>
            <span class="s3">return </span><span class="s1">_Decl()</span>
        <span class="s3">with </span><span class="s1">_Monkey(interface</span><span class="s3">, </span><span class="s1">implementedBy=_implementedBy):</span>
            <span class="s1">self.assertTrue(sb.implementedBy(object()))</span>

    <span class="s3">def </span><span class="s1">test_providedBy_hit(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interface</span>
        <span class="s1">sb = self._makeOne()</span>
        <span class="s3">class </span><span class="s1">_Decl(object):</span>
            <span class="s1">_implied = {sb: {}</span><span class="s3">,</span><span class="s1">}</span>
        <span class="s3">def </span><span class="s1">_providedBy(obj):</span>
            <span class="s3">return </span><span class="s1">_Decl()</span>
        <span class="s3">with </span><span class="s1">_Monkey(interface</span><span class="s3">, </span><span class="s1">providedBy=_providedBy):</span>
            <span class="s1">self.assertTrue(sb.providedBy(object()))</span>


<span class="s3">class </span><span class="s1">NameAndModuleComparisonTestsMixin(CleanUp):</span>

    <span class="s3">def </span><span class="s1">_makeOneToCompare(self):</span>
        <span class="s3">return </span><span class="s1">self._makeOne(</span><span class="s4">'a'</span><span class="s3">, </span><span class="s4">'b'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">__check_NotImplemented_comparison(self</span><span class="s3">, </span><span class="s1">name):</span>
        <span class="s0"># Without the correct attributes of __name__ and __module__,</span>
        <span class="s0"># comparison switches to the reverse direction.</span>

        <span class="s3">import </span><span class="s1">operator</span>
        <span class="s1">ib = self._makeOneToCompare()</span>
        <span class="s1">op = getattr(operator</span><span class="s3">, </span><span class="s1">name)</span>
        <span class="s1">meth = getattr(ib</span><span class="s3">, </span><span class="s4">'__%s__' </span><span class="s1">% name)</span>

        <span class="s0"># If either the __name__ or __module__ attribute</span>
        <span class="s0"># is missing from the other object, then we return</span>
        <span class="s0"># NotImplemented.</span>
        <span class="s3">class </span><span class="s1">RaisesErrorOnMissing(object):</span>
            <span class="s1">Exc = AttributeError</span>
            <span class="s3">def </span><span class="s1">__getattribute__(self</span><span class="s3">, </span><span class="s1">name):</span>
                <span class="s3">try</span><span class="s1">:</span>
                    <span class="s3">return </span><span class="s1">object.__getattribute__(self</span><span class="s3">, </span><span class="s1">name)</span>
                <span class="s3">except </span><span class="s1">AttributeError:</span>
                    <span class="s1">exc = RaisesErrorOnMissing.Exc</span>
                    <span class="s3">raise </span><span class="s1">exc(name)</span>

        <span class="s3">class </span><span class="s1">RaisesErrorOnModule(RaisesErrorOnMissing):</span>
            <span class="s3">def </span><span class="s1">__init__(self):</span>
                <span class="s1">self.__name__ = </span><span class="s4">'foo'</span>
            <span class="s1">@property</span>
            <span class="s3">def </span><span class="s1">__module__(self):</span>
                <span class="s3">raise </span><span class="s1">AttributeError</span>

        <span class="s3">class </span><span class="s1">RaisesErrorOnName(RaisesErrorOnMissing):</span>
            <span class="s3">def </span><span class="s1">__init__(self):</span>
                <span class="s1">self.__module__ = </span><span class="s4">'foo'</span>

        <span class="s1">self.assertEqual(RaisesErrorOnModule().__name__</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(RaisesErrorOnName().__module__</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">)</span>
        <span class="s3">with </span><span class="s1">self.assertRaises(AttributeError):</span>
            <span class="s1">getattr(RaisesErrorOnModule()</span><span class="s3">, </span><span class="s4">'__module__'</span><span class="s1">)</span>
        <span class="s3">with </span><span class="s1">self.assertRaises(AttributeError):</span>
            <span class="s1">getattr(RaisesErrorOnName()</span><span class="s3">, </span><span class="s4">'__name__'</span><span class="s1">)</span>

        <span class="s3">for </span><span class="s1">cls </span><span class="s3">in </span><span class="s1">RaisesErrorOnModule</span><span class="s3">, </span><span class="s1">RaisesErrorOnName:</span>
            <span class="s1">self.assertIs(meth(cls())</span><span class="s3">, </span><span class="s1">NotImplemented)</span>

        <span class="s0"># If the other object has a comparison function, returning</span>
        <span class="s0"># NotImplemented means Python calls it.</span>

        <span class="s3">class </span><span class="s1">AllowsAnyComparison(RaisesErrorOnMissing):</span>
            <span class="s3">def </span><span class="s1">__eq__(self</span><span class="s3">, </span><span class="s1">other):</span>
                <span class="s3">return True</span>
            <span class="s1">__lt__ = __eq__</span>
            <span class="s1">__le__ = __eq__</span>
            <span class="s1">__gt__ = __eq__</span>
            <span class="s1">__ge__ = __eq__</span>
            <span class="s1">__ne__ = __eq__</span>

        <span class="s1">self.assertTrue(op(ib</span><span class="s3">, </span><span class="s1">AllowsAnyComparison()))</span>
        <span class="s1">self.assertIs(meth(AllowsAnyComparison())</span><span class="s3">, </span><span class="s1">NotImplemented)</span>

        <span class="s0"># If it doesn't have the comparison, Python raises a TypeError.</span>
        <span class="s3">class </span><span class="s1">AllowsNoComparison(object):</span>
            <span class="s1">__eq__ = </span><span class="s3">None</span>
            <span class="s1">__lt__ = __eq__</span>
            <span class="s1">__le__ = __eq__</span>
            <span class="s1">__gt__ = __eq__</span>
            <span class="s1">__ge__ = __eq__</span>
            <span class="s1">__ne__ = __eq__</span>

        <span class="s1">self.assertIs(meth(AllowsNoComparison())</span><span class="s3">, </span><span class="s1">NotImplemented)</span>
        <span class="s3">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">op(ib</span><span class="s3">, </span><span class="s1">AllowsNoComparison())</span>

        <span class="s0"># Errors besides AttributeError are passed</span>
        <span class="s3">class </span><span class="s1">MyException(Exception):</span>
            <span class="s3">pass</span>

        <span class="s1">RaisesErrorOnMissing.Exc = MyException</span>

        <span class="s3">with </span><span class="s1">self.assertRaises(MyException):</span>
            <span class="s1">getattr(RaisesErrorOnModule()</span><span class="s3">, </span><span class="s4">'__module__'</span><span class="s1">)</span>
        <span class="s3">with </span><span class="s1">self.assertRaises(MyException):</span>
            <span class="s1">getattr(RaisesErrorOnName()</span><span class="s3">, </span><span class="s4">'__name__'</span><span class="s1">)</span>

        <span class="s3">for </span><span class="s1">cls </span><span class="s3">in </span><span class="s1">RaisesErrorOnModule</span><span class="s3">, </span><span class="s1">RaisesErrorOnName:</span>
            <span class="s3">with </span><span class="s1">self.assertRaises(MyException):</span>
                <span class="s1">op(ib</span><span class="s3">, </span><span class="s1">cls())</span>
            <span class="s3">with </span><span class="s1">self.assertRaises(MyException):</span>
                <span class="s1">meth(cls())</span>

    <span class="s3">def </span><span class="s1">test__lt__NotImplemented(self):</span>
        <span class="s1">self.__check_NotImplemented_comparison(</span><span class="s4">'lt'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test__le__NotImplemented(self):</span>
        <span class="s1">self.__check_NotImplemented_comparison(</span><span class="s4">'le'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test__gt__NotImplemented(self):</span>
        <span class="s1">self.__check_NotImplemented_comparison(</span><span class="s4">'gt'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test__ge__NotImplemented(self):</span>
        <span class="s1">self.__check_NotImplemented_comparison(</span><span class="s4">'ge'</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">InterfaceBaseTestsMixin(NameAndModuleComparisonTestsMixin):</span>
    <span class="s0"># Tests for both C and Python implementation</span>

    <span class="s3">def </span><span class="s1">_getTargetClass(self):</span>
        <span class="s3">raise </span><span class="s1">NotImplementedError</span>

    <span class="s3">def </span><span class="s1">_getFallbackClass(self):</span>
        <span class="s0"># pylint:disable=no-name-in-module</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">InterfaceBasePy</span>
        <span class="s3">return </span><span class="s1">InterfaceBasePy</span>

    <span class="s3">def </span><span class="s1">_makeOne(self</span><span class="s3">, </span><span class="s1">object_should_provide=</span><span class="s3">False, </span><span class="s1">name=</span><span class="s3">None, </span><span class="s1">module=</span><span class="s3">None</span><span class="s1">):</span>
        <span class="s3">class </span><span class="s1">IB(self._getTargetClass()):</span>
            <span class="s3">def </span><span class="s1">_call_conform(self</span><span class="s3">, </span><span class="s1">conform):</span>
                <span class="s3">return </span><span class="s1">conform(self)</span>
            <span class="s3">def </span><span class="s1">providedBy(self</span><span class="s3">, </span><span class="s1">obj):</span>
                <span class="s3">return </span><span class="s1">object_should_provide</span>
        <span class="s3">return </span><span class="s1">IB(name</span><span class="s3">, </span><span class="s1">module)</span>

    <span class="s3">def </span><span class="s1">test___call___w___conform___returning_value(self):</span>
        <span class="s1">ib = self._makeOne(</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">conformed = object()</span>
        <span class="s3">class </span><span class="s1">_Adapted(object):</span>
            <span class="s3">def </span><span class="s1">__conform__(self</span><span class="s3">, </span><span class="s1">iface):</span>
                <span class="s3">return </span><span class="s1">conformed</span>
        <span class="s1">self.assertIs(ib(_Adapted())</span><span class="s3">, </span><span class="s1">conformed)</span>

    <span class="s3">def </span><span class="s1">test___call___wo___conform___ob_no_provides_w_alternate(self):</span>
        <span class="s1">ib = self._makeOne(</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">__traceback_info__ = ib</span><span class="s3">, </span><span class="s1">self._getTargetClass()</span>
        <span class="s1">adapted = object()</span>
        <span class="s1">alternate = object()</span>
        <span class="s1">self.assertIs(ib(adapted</span><span class="s3">, </span><span class="s1">alternate)</span><span class="s3">, </span><span class="s1">alternate)</span>

    <span class="s3">def </span><span class="s1">test___call___w___conform___ob_no_provides_wo_alternate(self):</span>
        <span class="s1">ib = self._makeOne(</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s3">with </span><span class="s1">self.assertRaises(TypeError) </span><span class="s3">as </span><span class="s1">exc:</span>
            <span class="s1">ib(object())</span>

        <span class="s1">self.assertIn(</span><span class="s4">'Could not adapt'</span><span class="s3">, </span><span class="s1">str(exc.exception))</span>

    <span class="s3">def </span><span class="s1">test___call___w_no_conform_catches_only_AttributeError(self):</span>
        <span class="s1">MissingSomeAttrs.test_raises(self</span><span class="s3">, </span><span class="s1">self._makeOne()</span><span class="s3">, </span><span class="s1">expected_missing=</span><span class="s4">'__conform__'</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">InterfaceBaseTests(InterfaceBaseTestsMixin</span><span class="s3">,</span>
                         <span class="s1">OptimizationTestMixin</span><span class="s3">,</span>
                         <span class="s1">unittest.TestCase):</span>
    <span class="s0"># Tests that work with the C implementation</span>
    <span class="s3">def </span><span class="s1">_getTargetClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">InterfaceBase</span>
        <span class="s3">return </span><span class="s1">InterfaceBase</span>


<span class="s3">class </span><span class="s1">InterfaceBasePyTests(InterfaceBaseTestsMixin</span><span class="s3">, </span><span class="s1">unittest.TestCase):</span>
    <span class="s0"># Tests that only work with the Python implementation</span>

    <span class="s1">_getTargetClass = InterfaceBaseTestsMixin._getFallbackClass</span>

    <span class="s3">def </span><span class="s1">test___call___w___conform___miss_ob_provides(self):</span>
        <span class="s1">ib = self._makeOne(</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s3">class </span><span class="s1">_Adapted(object):</span>
            <span class="s3">def </span><span class="s1">__conform__(self</span><span class="s3">, </span><span class="s1">iface):</span>
                <span class="s3">return None</span>
        <span class="s1">adapted = _Adapted()</span>
        <span class="s1">self.assertIs(ib(adapted)</span><span class="s3">, </span><span class="s1">adapted)</span>

    <span class="s3">def </span><span class="s1">test___adapt___ob_provides(self):</span>
        <span class="s1">ib = self._makeOne(</span><span class="s3">True</span><span class="s1">)</span>
        <span class="s1">adapted = object()</span>
        <span class="s1">self.assertIs(ib.__adapt__(adapted)</span><span class="s3">, </span><span class="s1">adapted)</span>

    <span class="s3">def </span><span class="s1">test___adapt___ob_no_provides_uses_hooks(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interface</span>
        <span class="s1">ib = self._makeOne(</span><span class="s3">False</span><span class="s1">)</span>
        <span class="s1">adapted = object()</span>
        <span class="s1">_missed = []</span>
        <span class="s3">def </span><span class="s1">_hook_miss(iface</span><span class="s3">, </span><span class="s1">obj):</span>
            <span class="s1">_missed.append((iface</span><span class="s3">, </span><span class="s1">obj))</span>
        <span class="s3">def </span><span class="s1">_hook_hit(iface</span><span class="s3">, </span><span class="s1">obj):</span>
            <span class="s3">return </span><span class="s1">obj</span>
        <span class="s3">with </span><span class="s1">_Monkey(interface</span><span class="s3">, </span><span class="s1">adapter_hooks=[_hook_miss</span><span class="s3">, </span><span class="s1">_hook_hit]):</span>
            <span class="s1">self.assertIs(ib.__adapt__(adapted)</span><span class="s3">, </span><span class="s1">adapted)</span>
            <span class="s1">self.assertEqual(_missed</span><span class="s3">, </span><span class="s1">[(ib</span><span class="s3">, </span><span class="s1">adapted)])</span>

<span class="s3">class </span><span class="s1">SpecificationTests(unittest.TestCase):</span>

    <span class="s3">def </span><span class="s1">_getTargetClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Specification</span>
        <span class="s3">return </span><span class="s1">Specification</span>

    <span class="s3">def </span><span class="s1">_makeOne(self</span><span class="s3">, </span><span class="s1">bases=_marker):</span>
        <span class="s3">if </span><span class="s1">bases </span><span class="s3">is </span><span class="s1">_marker:</span>
            <span class="s3">return </span><span class="s1">self._getTargetClass()()</span>
        <span class="s3">return </span><span class="s1">self._getTargetClass()(bases)</span>

    <span class="s3">def </span><span class="s1">test_ctor(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">self.assertEqual(spec.__bases__</span><span class="s3">, </span><span class="s1">())</span>
        <span class="s1">self.assertEqual(len(spec._implied)</span><span class="s3">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(spec </span><span class="s3">in </span><span class="s1">spec._implied)</span>
        <span class="s1">self.assertTrue(Interface </span><span class="s3">in </span><span class="s1">spec._implied)</span>
        <span class="s1">self.assertEqual(len(spec.dependents)</span><span class="s3">, </span><span class="s5">0</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_subscribe_first_time(self):</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">dep = DummyDependent()</span>
        <span class="s1">spec.subscribe(dep)</span>
        <span class="s1">self.assertEqual(len(spec.dependents)</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(spec.dependents[dep]</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_subscribe_again(self):</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">dep = DummyDependent()</span>
        <span class="s1">spec.subscribe(dep)</span>
        <span class="s1">spec.subscribe(dep)</span>
        <span class="s1">self.assertEqual(spec.dependents[dep]</span><span class="s3">, </span><span class="s5">2</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_unsubscribe_miss(self):</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">dep = DummyDependent()</span>
        <span class="s1">self.assertRaises(KeyError</span><span class="s3">, </span><span class="s1">spec.unsubscribe</span><span class="s3">, </span><span class="s1">dep)</span>

    <span class="s3">def </span><span class="s1">test_unsubscribe(self):</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">dep = DummyDependent()</span>
        <span class="s1">spec.subscribe(dep)</span>
        <span class="s1">spec.subscribe(dep)</span>
        <span class="s1">spec.unsubscribe(dep)</span>
        <span class="s1">self.assertEqual(spec.dependents[dep]</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">spec.unsubscribe(dep)</span>
        <span class="s1">self.assertFalse(dep </span><span class="s3">in </span><span class="s1">spec.dependents)</span>

    <span class="s3">def </span><span class="s1">test___setBases_subscribes_bases_and_notifies_dependents(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">dep = DummyDependent()</span>
        <span class="s1">spec.subscribe(dep)</span>
        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s3">pass</span>
        <span class="s3">class </span><span class="s1">J(Interface):</span>
            <span class="s3">pass</span>
        <span class="s1">spec.__bases__ = (I</span><span class="s3">,</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(dep._changed</span><span class="s3">, </span><span class="s1">[spec])</span>
        <span class="s1">self.assertEqual(I.dependents[spec]</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">spec.__bases__ = (J</span><span class="s3">,</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(I.dependents.get(spec)</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(J.dependents[spec]</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_changed_clears_volatiles_and_implied(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s3">pass</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">spec._v_attrs = </span><span class="s4">'Foo'</span>
        <span class="s1">spec._implied[I] = ()</span>
        <span class="s1">spec.changed(spec)</span>
        <span class="s1">self.assertIsNone(spec._v_attrs)</span>
        <span class="s1">self.assertFalse(I </span><span class="s3">in </span><span class="s1">spec._implied)</span>

    <span class="s3">def </span><span class="s1">test_interfaces_skips_already_seen(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">class </span><span class="s1">IFoo(Interface):</span>
            <span class="s3">pass</span>
        <span class="s1">spec = self._makeOne([IFoo</span><span class="s3">, </span><span class="s1">IFoo])</span>
        <span class="s1">self.assertEqual(list(spec.interfaces())</span><span class="s3">, </span><span class="s1">[IFoo])</span>

    <span class="s3">def </span><span class="s1">test_extends_strict_wo_self(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">class </span><span class="s1">IFoo(Interface):</span>
            <span class="s3">pass</span>
        <span class="s1">spec = self._makeOne(IFoo)</span>
        <span class="s1">self.assertFalse(spec.extends(IFoo</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_extends_strict_w_self(self):</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">self.assertFalse(spec.extends(spec</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">True</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_extends_non_strict_w_self(self):</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">self.assertTrue(spec.extends(spec</span><span class="s3">, </span><span class="s1">strict=</span><span class="s3">False</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_get_hit_w__v_attrs(self):</span>
        <span class="s1">spec = self._makeOne()</span>
        <span class="s1">foo = object()</span>
        <span class="s1">spec._v_attrs = {</span><span class="s4">'foo'</span><span class="s1">: foo}</span>
        <span class="s1">self.assertTrue(spec.get(</span><span class="s4">'foo'</span><span class="s1">) </span><span class="s3">is </span><span class="s1">foo)</span>

    <span class="s3">def </span><span class="s1">test_get_hit_from_base_wo__v_attrs(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">class </span><span class="s1">IFoo(Interface):</span>
            <span class="s1">foo = Attribute(</span><span class="s4">'foo'</span><span class="s1">)</span>
        <span class="s3">class </span><span class="s1">IBar(Interface):</span>
            <span class="s1">bar = Attribute(</span><span class="s4">'bar'</span><span class="s1">)</span>
        <span class="s1">spec = self._makeOne([IFoo</span><span class="s3">, </span><span class="s1">IBar])</span>
        <span class="s1">self.assertTrue(spec.get(</span><span class="s4">'foo'</span><span class="s1">) </span><span class="s3">is </span><span class="s1">IFoo.get(</span><span class="s4">'foo'</span><span class="s1">))</span>
        <span class="s1">self.assertTrue(spec.get(</span><span class="s4">'bar'</span><span class="s1">) </span><span class="s3">is </span><span class="s1">IBar.get(</span><span class="s4">'bar'</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_multiple_inheritance_no_interfaces(self):</span>
        <span class="s0"># If we extend an object that implements interfaces,</span>
        <span class="s0"># plus one that doesn't, we do not interject `Interface`</span>
        <span class="s0"># early in the resolution order. It stays at the end,</span>
        <span class="s0"># like it should.</span>
        <span class="s0"># See https://github.com/zopefoundation/zope.interface/issues/8</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface.declarations </span><span class="s3">import </span><span class="s1">implementer</span>
        <span class="s3">from </span><span class="s1">zope.interface.declarations </span><span class="s3">import </span><span class="s1">implementedBy</span>

        <span class="s3">class </span><span class="s1">IDefaultViewName(Interface):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">Context(object):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">RDBModel(Context):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">IOther(Interface):</span>
            <span class="s3">pass</span>

        <span class="s1">@implementer(IOther)</span>
        <span class="s3">class </span><span class="s1">OtherBase(object):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">Model(OtherBase</span><span class="s3">, </span><span class="s1">Context):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertEqual(</span>
            <span class="s1">implementedBy(Model).__sro__</span><span class="s3">,</span>
            <span class="s1">(</span>
                <span class="s1">implementedBy(Model)</span><span class="s3">,</span>
                <span class="s1">implementedBy(OtherBase)</span><span class="s3">,</span>
                <span class="s1">IOther</span><span class="s3">,</span>
                <span class="s1">implementedBy(Context)</span><span class="s3">,</span>
                <span class="s1">implementedBy(object)</span><span class="s3">,</span>
                <span class="s1">Interface</span><span class="s3">, </span><span class="s0"># This used to be wrong, it used to be 2 too high.</span>
            <span class="s1">)</span>
        <span class="s1">)</span>


<span class="s3">class </span><span class="s1">InterfaceClassTests(unittest.TestCase):</span>

    <span class="s3">def </span><span class="s1">_getTargetClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">InterfaceClass</span>
        <span class="s3">return </span><span class="s1">InterfaceClass</span>

    <span class="s3">def </span><span class="s1">_makeOne(self</span><span class="s3">, </span><span class="s1">name=</span><span class="s4">'ITest'</span><span class="s3">, </span><span class="s1">bases=()</span><span class="s3">, </span><span class="s1">attrs=</span><span class="s3">None, </span><span class="s1">__doc__=</span><span class="s3">None,</span>
                 <span class="s1">__module__=</span><span class="s3">None</span><span class="s1">):</span>
        <span class="s3">return </span><span class="s1">self._getTargetClass()(name</span><span class="s3">, </span><span class="s1">bases</span><span class="s3">, </span><span class="s1">attrs</span><span class="s3">, </span><span class="s1">__doc__</span><span class="s3">, </span><span class="s1">__module__)</span>

    <span class="s3">def </span><span class="s1">test_ctor_defaults(self):</span>
        <span class="s1">klass = self._getTargetClass()</span>
        <span class="s1">inst = klass(</span><span class="s4">'ITesting'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__name__</span><span class="s3">, </span><span class="s4">'ITesting'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__doc__</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__bases__</span><span class="s3">, </span><span class="s1">())</span>
        <span class="s1">self.assertEqual(inst.getBases()</span><span class="s3">, </span><span class="s1">())</span>

    <span class="s3">def </span><span class="s1">test_ctor_bad_bases(self):</span>
        <span class="s1">klass = self._getTargetClass()</span>
        <span class="s1">self.assertRaises(TypeError</span><span class="s3">, </span><span class="s1">klass</span><span class="s3">, </span><span class="s4">'ITesting'</span><span class="s3">, </span><span class="s1">(object()</span><span class="s3">,</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_ctor_w_attrs_attrib_methods(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                 <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                <span class="s1">}</span>
        <span class="s1">klass = self._getTargetClass()</span>
        <span class="s1">inst = klass(</span><span class="s4">'ITesting'</span><span class="s3">, </span><span class="s1">attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(inst.__name__</span><span class="s3">, </span><span class="s4">'ITesting'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__doc__</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__bases__</span><span class="s3">, </span><span class="s1">())</span>
        <span class="s1">self.assertEqual(inst.names()</span><span class="s3">, </span><span class="s1">ATTRS.keys())</span>

    <span class="s3">def </span><span class="s1">test_ctor_attrs_w___locals__(self):</span>
        <span class="s1">ATTRS = {</span><span class="s4">'__locals__'</span><span class="s1">: {}}</span>
        <span class="s1">klass = self._getTargetClass()</span>
        <span class="s1">inst = klass(</span><span class="s4">'ITesting'</span><span class="s3">, </span><span class="s1">attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(inst.__name__</span><span class="s3">, </span><span class="s4">'ITesting'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__doc__</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__bases__</span><span class="s3">, </span><span class="s1">())</span>
        <span class="s1">self.assertEqual(list(inst.names())</span><span class="s3">, </span><span class="s1">[])</span>

    <span class="s3">def </span><span class="s1">test_ctor_attrs_w___annotations__(self):</span>
        <span class="s1">ATTRS = {</span><span class="s4">'__annotations__'</span><span class="s1">: {}}</span>
        <span class="s1">klass = self._getTargetClass()</span>
        <span class="s1">inst = klass(</span><span class="s4">'ITesting'</span><span class="s3">, </span><span class="s1">attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(inst.__name__</span><span class="s3">, </span><span class="s4">'ITesting'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__doc__</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__bases__</span><span class="s3">, </span><span class="s1">())</span>
        <span class="s1">self.assertEqual(list(inst.names())</span><span class="s3">, </span><span class="s1">[])</span>

    <span class="s3">def </span><span class="s1">test_ctor_attrs_w__decorator_non_return(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">_decorator_non_return</span>
        <span class="s1">ATTRS = {</span><span class="s4">'dropme'</span><span class="s1">: _decorator_non_return}</span>
        <span class="s1">klass = self._getTargetClass()</span>
        <span class="s1">inst = klass(</span><span class="s4">'ITesting'</span><span class="s3">, </span><span class="s1">attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(inst.__name__</span><span class="s3">, </span><span class="s4">'ITesting'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__doc__</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__bases__</span><span class="s3">, </span><span class="s1">())</span>
        <span class="s1">self.assertEqual(list(inst.names())</span><span class="s3">, </span><span class="s1">[])</span>

    <span class="s3">def </span><span class="s1">test_ctor_attrs_w_invalid_attr_type(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">InvalidInterface</span>
        <span class="s1">ATTRS = {</span><span class="s4">'invalid'</span><span class="s1">: object()}</span>
        <span class="s1">klass = self._getTargetClass()</span>
        <span class="s1">self.assertRaises(InvalidInterface</span><span class="s3">, </span><span class="s1">klass</span><span class="s3">, </span><span class="s4">'ITesting'</span><span class="s3">, </span><span class="s1">attrs=ATTRS)</span>

    <span class="s3">def </span><span class="s1">test_ctor_w_explicit___doc__(self):</span>
        <span class="s1">ATTRS = {</span><span class="s4">'__doc__'</span><span class="s1">: </span><span class="s4">'ATTR'</span><span class="s1">}</span>
        <span class="s1">klass = self._getTargetClass()</span>
        <span class="s1">inst = klass(</span><span class="s4">'ITesting'</span><span class="s3">, </span><span class="s1">attrs=ATTRS</span><span class="s3">, </span><span class="s1">__doc__=</span><span class="s4">'EXPLICIT'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(inst.__doc__</span><span class="s3">, </span><span class="s4">'EXPLICIT'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_interfaces(self):</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">self.assertEqual(list(iface.interfaces())</span><span class="s3">, </span><span class="s1">[iface])</span>

    <span class="s3">def </span><span class="s1">test_getBases(self):</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">sub = self._makeOne(</span><span class="s4">'ISub'</span><span class="s3">, </span><span class="s1">bases=(iface</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(sub.getBases()</span><span class="s3">, </span><span class="s1">(iface</span><span class="s3">,</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_isEqualOrExtendedBy_identity(self):</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">self.assertTrue(iface.isEqualOrExtendedBy(iface))</span>

    <span class="s3">def </span><span class="s1">test_isEqualOrExtendedBy_subiface(self):</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">sub = self._makeOne(</span><span class="s4">'ISub'</span><span class="s3">, </span><span class="s1">bases=(iface</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">self.assertTrue(iface.isEqualOrExtendedBy(sub))</span>
        <span class="s1">self.assertFalse(sub.isEqualOrExtendedBy(iface))</span>

    <span class="s3">def </span><span class="s1">test_isEqualOrExtendedBy_unrelated(self):</span>
        <span class="s1">one = self._makeOne(</span><span class="s4">'One'</span><span class="s1">)</span>
        <span class="s1">another = self._makeOne(</span><span class="s4">'Another'</span><span class="s1">)</span>
        <span class="s1">self.assertFalse(one.isEqualOrExtendedBy(another))</span>
        <span class="s1">self.assertFalse(another.isEqualOrExtendedBy(one))</span>

    <span class="s3">def </span><span class="s1">test_names_w_all_False_ignores_bases(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">BASE_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                     <span class="s1">}</span>
        <span class="s1">DERIVED_ATTRS = {</span><span class="s4">'baz'</span><span class="s1">: Attribute(</span><span class="s4">'Baz'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">}</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s3">, </span><span class="s1">attrs=BASE_ATTRS)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">bases=(base</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">attrs=DERIVED_ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(derived.names(all=</span><span class="s3">False</span><span class="s1">))</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'baz'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_names_w_all_True_no_bases(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                 <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                <span class="s1">}</span>
        <span class="s1">one = self._makeOne(attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(one.names(all=</span><span class="s3">True</span><span class="s1">))</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_names_w_all_True_w_bases_simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">BASE_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                     <span class="s1">}</span>
        <span class="s1">DERIVED_ATTRS = {</span><span class="s4">'baz'</span><span class="s1">: Attribute(</span><span class="s4">'Baz'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">}</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s3">, </span><span class="s1">attrs=BASE_ATTRS)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">bases=(base</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">attrs=DERIVED_ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(derived.names(all=</span><span class="s3">True</span><span class="s1">))</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s4">'baz'</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_names_w_all_True_bases_w_same_names(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s3">def </span><span class="s1">_foo():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">BASE_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                     <span class="s1">}</span>
        <span class="s1">DERIVED_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: fromFunction(_foo)</span><span class="s3">,</span>
                         <span class="s4">'baz'</span><span class="s1">: Attribute(</span><span class="s4">'Baz'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">}</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s3">, </span><span class="s1">attrs=BASE_ATTRS)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">bases=(base</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">attrs=DERIVED_ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(derived.names(all=</span><span class="s3">True</span><span class="s1">))</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s4">'baz'</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test___iter__(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s3">def </span><span class="s1">_foo():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">BASE_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                     <span class="s1">}</span>
        <span class="s1">DERIVED_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: fromFunction(_foo)</span><span class="s3">,</span>
                         <span class="s4">'baz'</span><span class="s1">: Attribute(</span><span class="s4">'Baz'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">}</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s3">, </span><span class="s1">attrs=BASE_ATTRS)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">bases=(base</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">attrs=DERIVED_ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(derived)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s4">'baz'</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_namesAndDescriptions_w_all_False_ignores_bases(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">BASE_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                     <span class="s1">}</span>
        <span class="s1">DERIVED_ATTRS = {</span><span class="s4">'baz'</span><span class="s1">: Attribute(</span><span class="s4">'Baz'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">}</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s3">, </span><span class="s1">attrs=BASE_ATTRS)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">bases=(base</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">attrs=DERIVED_ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(derived.namesAndDescriptions(all=</span><span class="s3">False</span><span class="s1">))</span><span class="s3">,</span>
                         <span class="s1">[(</span><span class="s4">'baz'</span><span class="s3">, </span><span class="s1">DERIVED_ATTRS[</span><span class="s4">'baz'</span><span class="s1">])</span><span class="s3">,</span>
                         <span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_namesAndDescriptions_w_all_True_no_bases(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                 <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                <span class="s1">}</span>
        <span class="s1">one = self._makeOne(attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(one.namesAndDescriptions(all=</span><span class="s3">False</span><span class="s1">))</span><span class="s3">,</span>
                         <span class="s1">[(</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s1">ATTRS[</span><span class="s4">'bar'</span><span class="s1">])</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s4">'foo'</span><span class="s3">, </span><span class="s1">ATTRS[</span><span class="s4">'foo'</span><span class="s1">])</span><span class="s3">,</span>
                         <span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_namesAndDescriptions_w_all_True_simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">BASE_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                     <span class="s1">}</span>
        <span class="s1">DERIVED_ATTRS = {</span><span class="s4">'baz'</span><span class="s1">: Attribute(</span><span class="s4">'Baz'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">}</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s3">, </span><span class="s1">attrs=BASE_ATTRS)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">bases=(base</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">attrs=DERIVED_ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(derived.namesAndDescriptions(all=</span><span class="s3">True</span><span class="s1">))</span><span class="s3">,</span>
                         <span class="s1">[(</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s1">BASE_ATTRS[</span><span class="s4">'bar'</span><span class="s1">])</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s4">'baz'</span><span class="s3">, </span><span class="s1">DERIVED_ATTRS[</span><span class="s4">'baz'</span><span class="s1">])</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s4">'foo'</span><span class="s3">, </span><span class="s1">BASE_ATTRS[</span><span class="s4">'foo'</span><span class="s1">])</span><span class="s3">,</span>
                         <span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_namesAndDescriptions_w_all_True_bases_w_same_names(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s3">def </span><span class="s1">_foo():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">BASE_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                     <span class="s1">}</span>
        <span class="s1">DERIVED_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: fromFunction(_foo)</span><span class="s3">,</span>
                         <span class="s4">'baz'</span><span class="s1">: Attribute(</span><span class="s4">'Baz'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">}</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s3">, </span><span class="s1">attrs=BASE_ATTRS)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">bases=(base</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">attrs=DERIVED_ATTRS)</span>
        <span class="s1">self.assertEqual(sorted(derived.namesAndDescriptions(all=</span><span class="s3">True</span><span class="s1">))</span><span class="s3">,</span>
                         <span class="s1">[(</span><span class="s4">'bar'</span><span class="s3">, </span><span class="s1">BASE_ATTRS[</span><span class="s4">'bar'</span><span class="s1">])</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s4">'baz'</span><span class="s3">, </span><span class="s1">DERIVED_ATTRS[</span><span class="s4">'baz'</span><span class="s1">])</span><span class="s3">,</span>
                          <span class="s1">(</span><span class="s4">'foo'</span><span class="s3">, </span><span class="s1">DERIVED_ATTRS[</span><span class="s4">'foo'</span><span class="s1">])</span><span class="s3">,</span>
                         <span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_getDescriptionFor_miss(self):</span>
        <span class="s1">one = self._makeOne()</span>
        <span class="s1">self.assertRaises(KeyError</span><span class="s3">, </span><span class="s1">one.getDescriptionFor</span><span class="s3">, </span><span class="s4">'nonesuch'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getDescriptionFor_hit(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                 <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                <span class="s1">}</span>
        <span class="s1">one = self._makeOne(attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(one.getDescriptionFor(</span><span class="s4">'foo'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">ATTRS[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(one.getDescriptionFor(</span><span class="s4">'bar'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">ATTRS[</span><span class="s4">'bar'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test___getitem___miss(self):</span>
        <span class="s1">one = self._makeOne()</span>
        <span class="s3">def </span><span class="s1">_test():</span>
            <span class="s3">return </span><span class="s1">one[</span><span class="s4">'nonesuch'</span><span class="s1">]</span>
        <span class="s1">self.assertRaises(KeyError</span><span class="s3">, </span><span class="s1">_test)</span>

    <span class="s3">def </span><span class="s1">test___getitem___hit(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                 <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                <span class="s1">}</span>
        <span class="s1">one = self._makeOne(attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(one[</span><span class="s4">'foo'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">ATTRS[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(one[</span><span class="s4">'bar'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">ATTRS[</span><span class="s4">'bar'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test___contains___miss(self):</span>
        <span class="s1">one = self._makeOne()</span>
        <span class="s1">self.assertFalse(</span><span class="s4">'nonesuch' </span><span class="s3">in </span><span class="s1">one)</span>

    <span class="s3">def </span><span class="s1">test___contains___hit(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                 <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                <span class="s1">}</span>
        <span class="s1">one = self._makeOne(attrs=ATTRS)</span>
        <span class="s1">self.assertTrue(</span><span class="s4">'foo' </span><span class="s3">in </span><span class="s1">one)</span>
        <span class="s1">self.assertTrue(</span><span class="s4">'bar' </span><span class="s3">in </span><span class="s1">one)</span>

    <span class="s3">def </span><span class="s1">test_direct_miss(self):</span>
        <span class="s1">one = self._makeOne()</span>
        <span class="s1">self.assertEqual(one.direct(</span><span class="s4">'nonesuch'</span><span class="s1">)</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_direct_hit_local_miss_bases(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">def </span><span class="s1">_bar():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s3">def </span><span class="s1">_foo():</span>
            <span class="s2">&quot;&quot;&quot;DOCSTRING&quot;&quot;&quot;</span>
        <span class="s1">BASE_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: Attribute(</span><span class="s4">'Foo'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                      <span class="s4">'bar'</span><span class="s1">: fromFunction(_bar)</span><span class="s3">,</span>
                     <span class="s1">}</span>
        <span class="s1">DERIVED_ATTRS = {</span><span class="s4">'foo'</span><span class="s1">: fromFunction(_foo)</span><span class="s3">,</span>
                         <span class="s4">'baz'</span><span class="s1">: Attribute(</span><span class="s4">'Baz'</span><span class="s3">, </span><span class="s4">''</span><span class="s1">)</span><span class="s3">,</span>
                        <span class="s1">}</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s3">, </span><span class="s1">attrs=BASE_ATTRS)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">bases=(base</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">attrs=DERIVED_ATTRS)</span>
        <span class="s1">self.assertEqual(derived.direct(</span><span class="s4">'foo'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">DERIVED_ATTRS[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(derived.direct(</span><span class="s4">'baz'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">DERIVED_ATTRS[</span><span class="s4">'baz'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(derived.direct(</span><span class="s4">'bar'</span><span class="s1">)</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_queryDescriptionFor_miss(self):</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">self.assertEqual(iface.queryDescriptionFor(</span><span class="s4">'nonesuch'</span><span class="s1">)</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_queryDescriptionFor_hit(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s1">ATTRS = {</span><span class="s4">'attr'</span><span class="s1">: Attribute(</span><span class="s4">'Title'</span><span class="s3">, </span><span class="s4">'Description'</span><span class="s1">)}</span>
        <span class="s1">iface = self._makeOne(attrs=ATTRS)</span>
        <span class="s1">self.assertEqual(iface.queryDescriptionFor(</span><span class="s4">'attr'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">ATTRS[</span><span class="s4">'attr'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_validateInvariants_pass(self):</span>
        <span class="s1">_called_with = []</span>
        <span class="s3">def </span><span class="s1">_passable(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">return True</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">obj = object()</span>
        <span class="s1">iface.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">[_passable])</span>
        <span class="s1">self.assertEqual(iface.validateInvariants(obj)</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(_called_with</span><span class="s3">, </span><span class="s1">[((obj</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">{})])</span>

    <span class="s3">def </span><span class="s1">test_validateInvariants_fail_wo_errors_passed(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">Invalid</span>
        <span class="s1">_passable_called_with = []</span>
        <span class="s3">def </span><span class="s1">_passable(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_passable_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">return True</span>
        <span class="s1">_fail_called_with = []</span>
        <span class="s3">def </span><span class="s1">_fail(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_fail_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">raise </span><span class="s1">Invalid</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">obj = object()</span>
        <span class="s1">iface.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">[_passable</span><span class="s3">, </span><span class="s1">_fail])</span>
        <span class="s1">self.assertRaises(Invalid</span><span class="s3">, </span><span class="s1">iface.validateInvariants</span><span class="s3">, </span><span class="s1">obj)</span>
        <span class="s1">self.assertEqual(_passable_called_with</span><span class="s3">, </span><span class="s1">[((obj</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">{})])</span>
        <span class="s1">self.assertEqual(_fail_called_with</span><span class="s3">, </span><span class="s1">[((obj</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">{})])</span>

    <span class="s3">def </span><span class="s1">test_validateInvariants_fail_w_errors_passed(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">Invalid</span>
        <span class="s1">_errors = []</span>
        <span class="s1">_fail_called_with = []</span>
        <span class="s3">def </span><span class="s1">_fail(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_fail_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">raise </span><span class="s1">Invalid</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">obj = object()</span>
        <span class="s1">iface.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">[_fail])</span>
        <span class="s1">self.assertRaises(Invalid</span><span class="s3">, </span><span class="s1">iface.validateInvariants</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">, </span><span class="s1">_errors)</span>
        <span class="s1">self.assertEqual(_fail_called_with</span><span class="s3">, </span><span class="s1">[((obj</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">{})])</span>
        <span class="s1">self.assertEqual(len(_errors)</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(_errors[</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Invalid))</span>

    <span class="s3">def </span><span class="s1">test_validateInvariants_fail_in_base_wo_errors_passed(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">Invalid</span>
        <span class="s1">_passable_called_with = []</span>
        <span class="s3">def </span><span class="s1">_passable(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_passable_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">return True</span>
        <span class="s1">_fail_called_with = []</span>
        <span class="s3">def </span><span class="s1">_fail(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_fail_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">raise </span><span class="s1">Invalid</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s1">)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">(base</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">obj = object()</span>
        <span class="s1">base.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">[_fail])</span>
        <span class="s1">derived.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">[_passable])</span>
        <span class="s1">self.assertRaises(Invalid</span><span class="s3">, </span><span class="s1">derived.validateInvariants</span><span class="s3">, </span><span class="s1">obj)</span>
        <span class="s1">self.assertEqual(_passable_called_with</span><span class="s3">, </span><span class="s1">[((obj</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">{})])</span>
        <span class="s1">self.assertEqual(_fail_called_with</span><span class="s3">, </span><span class="s1">[((obj</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">{})])</span>

    <span class="s3">def </span><span class="s1">test_validateInvariants_fail_in_base_w_errors_passed(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">Invalid</span>
        <span class="s1">_errors = []</span>
        <span class="s1">_passable_called_with = []</span>
        <span class="s3">def </span><span class="s1">_passable(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_passable_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">return True</span>
        <span class="s1">_fail_called_with = []</span>
        <span class="s3">def </span><span class="s1">_fail(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_fail_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">raise </span><span class="s1">Invalid</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s1">)</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">(base</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">obj = object()</span>
        <span class="s1">base.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">[_fail])</span>
        <span class="s1">derived.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">[_passable])</span>
        <span class="s1">self.assertRaises(Invalid</span><span class="s3">, </span><span class="s1">derived.validateInvariants</span><span class="s3">, </span><span class="s1">obj</span><span class="s3">, </span><span class="s1">_errors)</span>
        <span class="s1">self.assertEqual(_passable_called_with</span><span class="s3">, </span><span class="s1">[((obj</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">{})])</span>
        <span class="s1">self.assertEqual(_fail_called_with</span><span class="s3">, </span><span class="s1">[((obj</span><span class="s3">,</span><span class="s1">)</span><span class="s3">, </span><span class="s1">{})])</span>
        <span class="s1">self.assertEqual(len(_errors)</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(_errors[</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Invalid))</span>

    <span class="s3">def </span><span class="s1">test_validateInvariants_inherited_not_called_multiple_times(self):</span>
        <span class="s1">_passable_called_with = []</span>

        <span class="s3">def </span><span class="s1">_passable(*args</span><span class="s3">, </span><span class="s1">**kw):</span>
            <span class="s1">_passable_called_with.append((args</span><span class="s3">, </span><span class="s1">kw))</span>
            <span class="s3">return True</span>

        <span class="s1">obj = object()</span>
        <span class="s1">base = self._makeOne(</span><span class="s4">'IBase'</span><span class="s1">)</span>
        <span class="s1">base.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">[_passable])</span>
        <span class="s1">derived = self._makeOne(</span><span class="s4">'IDerived'</span><span class="s3">, </span><span class="s1">(base</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">derived.validateInvariants(obj)</span>
        <span class="s1">self.assertEqual(</span><span class="s5">1</span><span class="s3">, </span><span class="s1">len(_passable_called_with))</span>

    <span class="s3">def </span><span class="s1">test___reduce__(self):</span>
        <span class="s1">iface = self._makeOne(</span><span class="s4">'PickleMe'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(iface.__reduce__()</span><span class="s3">, </span><span class="s4">'PickleMe'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___hash___normal(self):</span>
        <span class="s1">iface = self._makeOne(</span><span class="s4">'HashMe'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(hash(iface)</span><span class="s3">,</span>
                         <span class="s1">hash(((</span><span class="s4">'HashMe'</span><span class="s3">,</span>
                                <span class="s4">'zope.interface.tests.test_interface'</span><span class="s1">))))</span>

    <span class="s3">def </span><span class="s1">test___hash___missing_required_attrs(self):</span>
        <span class="s3">class </span><span class="s1">Derived(self._getTargetClass()):</span>
            <span class="s3">def </span><span class="s1">__init__(self): </span><span class="s0"># pylint:disable=super-init-not-called</span>
                <span class="s3">pass </span><span class="s0"># Don't call base class.</span>
        <span class="s1">derived = Derived()</span>
        <span class="s3">with </span><span class="s1">self.assertRaises(AttributeError):</span>
            <span class="s1">hash(derived)</span>

    <span class="s3">def </span><span class="s1">test_comparison_with_None(self):</span>
        <span class="s0"># pylint:disable=singleton-comparison,misplaced-comparison-constant</span>
        <span class="s1">iface = self._makeOne()</span>
        <span class="s1">self.assertTrue(iface &lt; </span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(iface &lt;= </span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">self.assertFalse(iface == </span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(iface != </span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">self.assertFalse(iface &gt;= </span><span class="s3">None</span><span class="s1">)</span>
        <span class="s1">self.assertFalse(iface &gt; </span><span class="s3">None</span><span class="s1">)</span>

        <span class="s1">self.assertFalse(</span><span class="s3">None </span><span class="s1">&lt; iface)</span>
        <span class="s1">self.assertFalse(</span><span class="s3">None </span><span class="s1">&lt;= iface)</span>
        <span class="s1">self.assertFalse(</span><span class="s3">None </span><span class="s1">== iface)</span>
        <span class="s1">self.assertTrue(</span><span class="s3">None </span><span class="s1">!= iface)</span>
        <span class="s1">self.assertTrue(</span><span class="s3">None </span><span class="s1">&gt;= iface)</span>
        <span class="s1">self.assertTrue(</span><span class="s3">None </span><span class="s1">&gt; iface)</span>

    <span class="s3">def </span><span class="s1">test_comparison_with_same_instance(self):</span>
        <span class="s0"># pylint:disable=comparison-with-itself</span>
        <span class="s1">iface = self._makeOne()</span>

        <span class="s1">self.assertFalse(iface &lt; iface)</span>
        <span class="s1">self.assertTrue(iface &lt;= iface)</span>
        <span class="s1">self.assertTrue(iface == iface)</span>
        <span class="s1">self.assertFalse(iface != iface)</span>
        <span class="s1">self.assertTrue(iface &gt;= iface)</span>
        <span class="s1">self.assertFalse(iface &gt; iface)</span>

    <span class="s3">def </span><span class="s1">test_comparison_with_same_named_instance_in_other_module(self):</span>

        <span class="s1">one = self._makeOne(</span><span class="s4">'IName'</span><span class="s3">, </span><span class="s1">__module__=</span><span class="s4">'zope.interface.tests.one'</span><span class="s1">)</span>
        <span class="s1">other = self._makeOne(</span><span class="s4">'IName'</span><span class="s3">, </span><span class="s1">__module__=</span><span class="s4">'zope.interface.tests.other'</span><span class="s1">)</span>

        <span class="s1">self.assertTrue(one &lt; other)</span>
        <span class="s1">self.assertFalse(other &lt; one)</span>
        <span class="s1">self.assertTrue(one &lt;= other)</span>
        <span class="s1">self.assertFalse(other &lt;= one)</span>
        <span class="s1">self.assertFalse(one == other)</span>
        <span class="s1">self.assertFalse(other == one)</span>
        <span class="s1">self.assertTrue(one != other)</span>
        <span class="s1">self.assertTrue(other != one)</span>
        <span class="s1">self.assertFalse(one &gt;= other)</span>
        <span class="s1">self.assertTrue(other &gt;= one)</span>
        <span class="s1">self.assertFalse(one &gt; other)</span>
        <span class="s1">self.assertTrue(other &gt; one)</span>

    <span class="s3">def </span><span class="s1">test_assignment_to__class__(self):</span>
        <span class="s0"># https://github.com/zopefoundation/zope.interface/issues/6</span>
        <span class="s3">class </span><span class="s1">MyException(Exception):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">MyInterfaceClass(self._getTargetClass()):</span>
            <span class="s3">def </span><span class="s1">__call__(self</span><span class="s3">, </span><span class="s1">target):</span>
                <span class="s3">raise </span><span class="s1">MyException(target)</span>

        <span class="s1">IFoo = self._makeOne(</span><span class="s4">'IName'</span><span class="s1">)</span>
        <span class="s1">self.assertIsInstance(IFoo</span><span class="s3">, </span><span class="s1">self._getTargetClass())</span>
        <span class="s1">self.assertIs(type(IFoo)</span><span class="s3">, </span><span class="s1">self._getTargetClass())</span>

        <span class="s3">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">IFoo(</span><span class="s5">1</span><span class="s1">)</span>

        <span class="s1">IFoo.__class__ = MyInterfaceClass</span>
        <span class="s1">self.assertIsInstance(IFoo</span><span class="s3">, </span><span class="s1">MyInterfaceClass)</span>
        <span class="s1">self.assertIs(type(IFoo)</span><span class="s3">, </span><span class="s1">MyInterfaceClass)</span>

        <span class="s3">with </span><span class="s1">self.assertRaises(MyException):</span>
            <span class="s1">IFoo(</span><span class="s5">1</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_assignment_to__class__2(self):</span>
        <span class="s0"># https://github.com/zopefoundation/zope.interface/issues/6</span>
        <span class="s0"># This is essentially a transcription of the</span>
        <span class="s0"># test presented in the bug report.</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">class </span><span class="s1">MyInterfaceClass(self._getTargetClass()):</span>
            <span class="s3">def </span><span class="s1">__call__(self</span><span class="s3">, </span><span class="s1">*args):</span>
                <span class="s3">return </span><span class="s1">args</span>

        <span class="s1">IFoo = MyInterfaceClass(</span><span class="s4">'IFoo'</span><span class="s3">, </span><span class="s1">(Interface</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">self.assertEqual(IFoo(</span><span class="s5">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s5">1</span><span class="s3">,</span><span class="s1">))</span>

        <span class="s3">class </span><span class="s1">IBar(IFoo):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertEqual(IBar(</span><span class="s5">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s5">1</span><span class="s3">,</span><span class="s1">))</span>

        <span class="s3">class </span><span class="s1">ISpam(Interface):</span>
            <span class="s3">pass</span>

        <span class="s3">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">ISpam()</span>

        <span class="s1">ISpam.__class__ = MyInterfaceClass</span>
        <span class="s1">self.assertEqual(ISpam(</span><span class="s5">1</span><span class="s1">)</span><span class="s3">, </span><span class="s1">(</span><span class="s5">1</span><span class="s3">,</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test__module__is_readonly(self):</span>
        <span class="s1">inst = self._makeOne()</span>
        <span class="s3">with </span><span class="s1">self.assertRaises((AttributeError</span><span class="s3">, </span><span class="s1">TypeError)):</span>
            <span class="s0"># CPython 2.7 raises TypeError. Everything else</span>
            <span class="s0"># raises AttributeError.</span>
            <span class="s1">inst.__module__ = </span><span class="s4">'different.module'</span>


<span class="s3">class </span><span class="s1">InterfaceTests(unittest.TestCase):</span>

    <span class="s3">def </span><span class="s1">test_attributes_link_to_interface(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>

        <span class="s3">class </span><span class="s1">I1(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">&quot;My attr&quot;</span><span class="s1">)</span>

        <span class="s1">self.assertTrue(I1[</span><span class="s4">'attr'</span><span class="s1">].interface </span><span class="s3">is </span><span class="s1">I1)</span>

    <span class="s3">def </span><span class="s1">test_methods_link_to_interface(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">I1(Interface):</span>

            <span class="s3">def </span><span class="s1">method(foo</span><span class="s3">, </span><span class="s1">bar</span><span class="s3">, </span><span class="s1">bingo):</span>
                <span class="s2">&quot;A method&quot;</span>

        <span class="s1">self.assertTrue(I1[</span><span class="s4">'method'</span><span class="s1">].interface </span><span class="s3">is </span><span class="s1">I1)</span>

    <span class="s3">def </span><span class="s1">test_classImplements_simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementedBy</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">providedBy</span>

        <span class="s3">class </span><span class="s1">ICurrent(Interface):</span>
            <span class="s3">def </span><span class="s1">method1(a</span><span class="s3">, </span><span class="s1">b):</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>
            <span class="s3">def </span><span class="s1">method2(a</span><span class="s3">, </span><span class="s1">b):</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>

        <span class="s3">class </span><span class="s1">IOther(Interface):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">Current(object):</span>
            <span class="s1">__implemented__ = ICurrent</span>
            <span class="s3">def </span><span class="s1">method1(self</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b):</span>
                <span class="s3">raise </span><span class="s1">NotImplementedError()</span>
            <span class="s3">def </span><span class="s1">method2(self</span><span class="s3">, </span><span class="s1">a</span><span class="s3">, </span><span class="s1">b):</span>
                <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s1">current = Current()</span>

        <span class="s1">self.assertTrue(ICurrent.implementedBy(Current))</span>
        <span class="s1">self.assertFalse(IOther.implementedBy(Current))</span>
        <span class="s1">self.assertEqual(ICurrent</span><span class="s3">, </span><span class="s1">ICurrent)</span>
        <span class="s1">self.assertTrue(ICurrent </span><span class="s3">in </span><span class="s1">implementedBy(Current))</span>
        <span class="s1">self.assertFalse(IOther </span><span class="s3">in </span><span class="s1">implementedBy(Current))</span>
        <span class="s1">self.assertTrue(ICurrent </span><span class="s3">in </span><span class="s1">providedBy(current))</span>
        <span class="s1">self.assertFalse(IOther </span><span class="s3">in </span><span class="s1">providedBy(current))</span>

    <span class="s3">def </span><span class="s1">test_classImplements_base_not_derived(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementedBy</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">providedBy</span>
        <span class="s3">class </span><span class="s1">IBase(Interface):</span>
            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>
        <span class="s3">class </span><span class="s1">IDerived(IBase):</span>
            <span class="s3">pass</span>
        <span class="s3">class </span><span class="s1">Current():</span>
            <span class="s1">__implemented__ = IBase</span>
            <span class="s3">def </span><span class="s1">method(self):</span>
                <span class="s3">raise </span><span class="s1">NotImplementedError()</span>
        <span class="s1">current = Current()</span>

        <span class="s1">self.assertTrue(IBase.implementedBy(Current))</span>
        <span class="s1">self.assertFalse(IDerived.implementedBy(Current))</span>
        <span class="s1">self.assertTrue(IBase </span><span class="s3">in </span><span class="s1">implementedBy(Current))</span>
        <span class="s1">self.assertFalse(IDerived </span><span class="s3">in </span><span class="s1">implementedBy(Current))</span>
        <span class="s1">self.assertTrue(IBase </span><span class="s3">in </span><span class="s1">providedBy(current))</span>
        <span class="s1">self.assertFalse(IDerived </span><span class="s3">in </span><span class="s1">providedBy(current))</span>

    <span class="s3">def </span><span class="s1">test_classImplements_base_and_derived(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementedBy</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">providedBy</span>

        <span class="s3">class </span><span class="s1">IBase(Interface):</span>
            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>

        <span class="s3">class </span><span class="s1">IDerived(IBase):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">Current(object):</span>
            <span class="s1">__implemented__ = IDerived</span>
            <span class="s3">def </span><span class="s1">method(self):</span>
                <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s1">current = Current()</span>

        <span class="s1">self.assertTrue(IBase.implementedBy(Current))</span>
        <span class="s1">self.assertTrue(IDerived.implementedBy(Current))</span>
        <span class="s1">self.assertFalse(IBase </span><span class="s3">in </span><span class="s1">implementedBy(Current))</span>
        <span class="s1">self.assertTrue(IBase </span><span class="s3">in </span><span class="s1">implementedBy(Current).flattened())</span>
        <span class="s1">self.assertTrue(IDerived </span><span class="s3">in </span><span class="s1">implementedBy(Current))</span>
        <span class="s1">self.assertFalse(IBase </span><span class="s3">in </span><span class="s1">providedBy(current))</span>
        <span class="s1">self.assertTrue(IBase </span><span class="s3">in </span><span class="s1">providedBy(current).flattened())</span>
        <span class="s1">self.assertTrue(IDerived </span><span class="s3">in </span><span class="s1">providedBy(current))</span>

    <span class="s3">def </span><span class="s1">test_classImplements_multiple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementedBy</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">providedBy</span>

        <span class="s3">class </span><span class="s1">ILeft(Interface):</span>
            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>

        <span class="s3">class </span><span class="s1">IRight(ILeft):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">Left(object):</span>
            <span class="s1">__implemented__ = ILeft</span>

            <span class="s3">def </span><span class="s1">method(self):</span>
                <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s3">class </span><span class="s1">Right(object):</span>
            <span class="s1">__implemented__ = IRight</span>

        <span class="s3">class </span><span class="s1">Ambi(Left</span><span class="s3">, </span><span class="s1">Right):</span>
            <span class="s3">pass</span>

        <span class="s1">ambi = Ambi()</span>

        <span class="s1">self.assertTrue(ILeft.implementedBy(Ambi))</span>
        <span class="s1">self.assertTrue(IRight.implementedBy(Ambi))</span>
        <span class="s1">self.assertTrue(ILeft </span><span class="s3">in </span><span class="s1">implementedBy(Ambi))</span>
        <span class="s1">self.assertTrue(IRight </span><span class="s3">in </span><span class="s1">implementedBy(Ambi))</span>
        <span class="s1">self.assertTrue(ILeft </span><span class="s3">in </span><span class="s1">providedBy(ambi))</span>
        <span class="s1">self.assertTrue(IRight </span><span class="s3">in </span><span class="s1">providedBy(ambi))</span>

    <span class="s3">def </span><span class="s1">test_classImplements_multiple_w_explict_implements(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementedBy</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">providedBy</span>

        <span class="s3">class </span><span class="s1">ILeft(Interface):</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>

        <span class="s3">class </span><span class="s1">IRight(ILeft):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">IOther(Interface):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">Left():</span>
            <span class="s1">__implemented__ = ILeft</span>

            <span class="s3">def </span><span class="s1">method(self):</span>
                <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s3">class </span><span class="s1">Right(object):</span>
            <span class="s1">__implemented__ = IRight</span>

        <span class="s3">class </span><span class="s1">Other(object):</span>
            <span class="s1">__implemented__ = IOther</span>

        <span class="s3">class </span><span class="s1">Mixed(Left</span><span class="s3">, </span><span class="s1">Right):</span>
            <span class="s1">__implemented__ = Left.__implemented__</span><span class="s3">, </span><span class="s1">Other.__implemented__</span>

        <span class="s1">mixed = Mixed()</span>

        <span class="s1">self.assertTrue(ILeft.implementedBy(Mixed))</span>
        <span class="s1">self.assertFalse(IRight.implementedBy(Mixed))</span>
        <span class="s1">self.assertTrue(IOther.implementedBy(Mixed))</span>
        <span class="s1">self.assertTrue(ILeft </span><span class="s3">in </span><span class="s1">implementedBy(Mixed))</span>
        <span class="s1">self.assertFalse(IRight </span><span class="s3">in </span><span class="s1">implementedBy(Mixed))</span>
        <span class="s1">self.assertTrue(IOther </span><span class="s3">in </span><span class="s1">implementedBy(Mixed))</span>
        <span class="s1">self.assertTrue(ILeft </span><span class="s3">in </span><span class="s1">providedBy(mixed))</span>
        <span class="s1">self.assertFalse(IRight </span><span class="s3">in </span><span class="s1">providedBy(mixed))</span>
        <span class="s1">self.assertTrue(IOther </span><span class="s3">in </span><span class="s1">providedBy(mixed))</span>

    <span class="s3">def </span><span class="s1">testInterfaceExtendsInterface(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s1">new = Interface.__class__</span>
        <span class="s1">FunInterface = new(</span><span class="s4">'FunInterface'</span><span class="s1">)</span>
        <span class="s1">BarInterface = new(</span><span class="s4">'BarInterface'</span><span class="s3">, </span><span class="s1">(FunInterface</span><span class="s3">,</span><span class="s1">))</span>
        <span class="s1">BobInterface = new(</span><span class="s4">'BobInterface'</span><span class="s1">)</span>
        <span class="s1">BazInterface = new(</span><span class="s4">'BazInterface'</span><span class="s3">, </span><span class="s1">(BobInterface</span><span class="s3">, </span><span class="s1">BarInterface</span><span class="s3">,</span><span class="s1">))</span>

        <span class="s1">self.assertTrue(BazInterface.extends(BobInterface))</span>
        <span class="s1">self.assertTrue(BazInterface.extends(BarInterface))</span>
        <span class="s1">self.assertTrue(BazInterface.extends(FunInterface))</span>
        <span class="s1">self.assertFalse(BobInterface.extends(FunInterface))</span>
        <span class="s1">self.assertFalse(BobInterface.extends(BarInterface))</span>
        <span class="s1">self.assertTrue(BarInterface.extends(FunInterface))</span>
        <span class="s1">self.assertFalse(BarInterface.extends(BazInterface))</span>

    <span class="s3">def </span><span class="s1">test_verifyClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface.verify </span><span class="s3">import </span><span class="s1">verifyClass</span>


        <span class="s3">class </span><span class="s1">ICheckMe(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;A method&quot;</span>

        <span class="s3">class </span><span class="s1">CheckMe(object):</span>
            <span class="s1">__implemented__ = ICheckMe</span>
            <span class="s1">attr = </span><span class="s4">'value'</span>

            <span class="s3">def </span><span class="s1">method(self):</span>
                <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s1">self.assertTrue(verifyClass(ICheckMe</span><span class="s3">, </span><span class="s1">CheckMe))</span>

    <span class="s3">def </span><span class="s1">test_verifyObject(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface.verify </span><span class="s3">import </span><span class="s1">verifyObject</span>


        <span class="s3">class </span><span class="s1">ICheckMe(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;A method&quot;</span>

        <span class="s3">class </span><span class="s1">CheckMe(object):</span>
            <span class="s1">__implemented__ = ICheckMe</span>
            <span class="s1">attr = </span><span class="s4">'value'</span>

            <span class="s3">def </span><span class="s1">method(self):</span>
                <span class="s3">raise </span><span class="s1">NotImplementedError()</span>

        <span class="s1">check_me = CheckMe()</span>

        <span class="s1">self.assertTrue(verifyObject(ICheckMe</span><span class="s3">, </span><span class="s1">check_me))</span>

    <span class="s3">def </span><span class="s1">test_interface_object_provides_Interface(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">AnInterface(Interface):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertTrue(Interface.providedBy(AnInterface))</span>

    <span class="s3">def </span><span class="s1">test_names_simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">ISimple(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>

        <span class="s1">self.assertEqual(sorted(ISimple.names())</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'attr'</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_names_derived(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">IBase(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>

        <span class="s3">class </span><span class="s1">IDerived(IBase):</span>
            <span class="s1">attr2 = Attribute(</span><span class="s4">u'My attr2'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>

            <span class="s3">def </span><span class="s1">method2():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>

        <span class="s1">self.assertEqual(sorted(IDerived.names())</span><span class="s3">,</span>
                         <span class="s1">[</span><span class="s4">'attr2'</span><span class="s3">, </span><span class="s4">'method'</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(sorted(IDerived.names(all=</span><span class="s3">True</span><span class="s1">))</span><span class="s3">,</span>
                         <span class="s1">[</span><span class="s4">'attr'</span><span class="s3">, </span><span class="s4">'attr2'</span><span class="s3">, </span><span class="s4">'method'</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_namesAndDescriptions_simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Method</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">ISimple(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s1">name_values = sorted(ISimple.namesAndDescriptions())</span>

        <span class="s1">self.assertEqual(len(name_values)</span><span class="s3">, </span><span class="s5">2</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My attr'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My method'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_namesAndDescriptions_derived(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Method</span>


        <span class="s3">class </span><span class="s1">IBase(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s3">class </span><span class="s1">IDerived(IBase):</span>
            <span class="s1">attr2 = Attribute(</span><span class="s4">u'My attr2'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method, overridden&quot;</span>

            <span class="s3">def </span><span class="s1">method2():</span>
                <span class="s2">&quot;My method2&quot;</span>

        <span class="s1">name_values = sorted(IDerived.namesAndDescriptions())</span>

        <span class="s1">self.assertEqual(len(name_values)</span><span class="s3">, </span><span class="s5">3</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My method, overridden'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">2</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">2</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">2</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">2</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My method2'</span><span class="s1">)</span>

        <span class="s1">name_values = sorted(IDerived.namesAndDescriptions(all=</span><span class="s3">True</span><span class="s1">))</span>

        <span class="s1">self.assertEqual(len(name_values)</span><span class="s3">, </span><span class="s5">4</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">0</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My attr'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">1</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">2</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">2</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">2</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">2</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My method, overridden'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">3</span><span class="s1">][</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(name_values[</span><span class="s5">3</span><span class="s1">][</span><span class="s5">1</span><span class="s1">]</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">3</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(name_values[</span><span class="s5">3</span><span class="s1">][</span><span class="s5">1</span><span class="s1">].__doc__</span><span class="s3">, </span><span class="s4">'My method2'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getDescriptionFor_nonesuch_no_default(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">IEmpty(Interface):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertRaises(KeyError</span><span class="s3">, </span><span class="s1">IEmpty.getDescriptionFor</span><span class="s3">, </span><span class="s4">'nonesuch'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getDescriptionFor_simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Method</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">ISimple(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s1">a_desc = ISimple.getDescriptionFor(</span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(a_desc</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(a_desc.__name__</span><span class="s3">, </span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(a_desc.__doc__</span><span class="s3">, </span><span class="s4">'My attr'</span><span class="s1">)</span>

        <span class="s1">m_desc = ISimple.getDescriptionFor(</span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(m_desc</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(m_desc.__name__</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m_desc.__doc__</span><span class="s3">, </span><span class="s4">'My method'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getDescriptionFor_derived(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Method</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">IBase(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s3">class </span><span class="s1">IDerived(IBase):</span>
            <span class="s1">attr2 = Attribute(</span><span class="s4">u'My attr2'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method, overridden&quot;</span>

            <span class="s3">def </span><span class="s1">method2():</span>
                <span class="s2">&quot;My method2&quot;</span>

        <span class="s1">a_desc = IDerived.getDescriptionFor(</span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(a_desc</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(a_desc.__name__</span><span class="s3">, </span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(a_desc.__doc__</span><span class="s3">, </span><span class="s4">'My attr'</span><span class="s1">)</span>

        <span class="s1">m_desc = IDerived.getDescriptionFor(</span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(m_desc</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(m_desc.__name__</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m_desc.__doc__</span><span class="s3">, </span><span class="s4">'My method, overridden'</span><span class="s1">)</span>

        <span class="s1">a2_desc = IDerived.getDescriptionFor(</span><span class="s4">'attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(a2_desc</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(a2_desc.__name__</span><span class="s3">, </span><span class="s4">'attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(a2_desc.__doc__</span><span class="s3">, </span><span class="s4">'My attr2'</span><span class="s1">)</span>

        <span class="s1">m2_desc = IDerived.getDescriptionFor(</span><span class="s4">'method2'</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(isinstance(m2_desc</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(m2_desc.__name__</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m2_desc.__doc__</span><span class="s3">, </span><span class="s4">'My method2'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___getitem__nonesuch(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">IEmpty(Interface):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertRaises(KeyError</span><span class="s3">, </span><span class="s1">IEmpty.__getitem__</span><span class="s3">, </span><span class="s4">'nonesuch'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___getitem__simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Method</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">ISimple(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s1">a_desc = ISimple[</span><span class="s4">'attr'</span><span class="s1">]</span>
        <span class="s1">self.assertTrue(isinstance(a_desc</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(a_desc.__name__</span><span class="s3">, </span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(a_desc.__doc__</span><span class="s3">, </span><span class="s4">'My attr'</span><span class="s1">)</span>

        <span class="s1">m_desc = ISimple[</span><span class="s4">'method'</span><span class="s1">]</span>
        <span class="s1">self.assertTrue(isinstance(m_desc</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(m_desc.__name__</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m_desc.__doc__</span><span class="s3">, </span><span class="s4">'My method'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___getitem___derived(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Method</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">IBase(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s3">class </span><span class="s1">IDerived(IBase):</span>
            <span class="s1">attr2 = Attribute(</span><span class="s4">u'My attr2'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method, overridden&quot;</span>

            <span class="s3">def </span><span class="s1">method2():</span>
                <span class="s2">&quot;My method2&quot;</span>

        <span class="s1">a_desc = IDerived[</span><span class="s4">'attr'</span><span class="s1">]</span>
        <span class="s1">self.assertTrue(isinstance(a_desc</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(a_desc.__name__</span><span class="s3">, </span><span class="s4">'attr'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(a_desc.__doc__</span><span class="s3">, </span><span class="s4">'My attr'</span><span class="s1">)</span>

        <span class="s1">m_desc = IDerived[</span><span class="s4">'method'</span><span class="s1">]</span>
        <span class="s1">self.assertTrue(isinstance(m_desc</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(m_desc.__name__</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m_desc.__doc__</span><span class="s3">, </span><span class="s4">'My method, overridden'</span><span class="s1">)</span>

        <span class="s1">a2_desc = IDerived[</span><span class="s4">'attr2'</span><span class="s1">]</span>
        <span class="s1">self.assertTrue(isinstance(a2_desc</span><span class="s3">, </span><span class="s1">Attribute))</span>
        <span class="s1">self.assertEqual(a2_desc.__name__</span><span class="s3">, </span><span class="s4">'attr2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(a2_desc.__doc__</span><span class="s3">, </span><span class="s4">'My attr2'</span><span class="s1">)</span>

        <span class="s1">m2_desc = IDerived[</span><span class="s4">'method2'</span><span class="s1">]</span>
        <span class="s1">self.assertTrue(isinstance(m2_desc</span><span class="s3">, </span><span class="s1">Method))</span>
        <span class="s1">self.assertEqual(m2_desc.__name__</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(m2_desc.__doc__</span><span class="s3">, </span><span class="s4">'My method2'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___contains__nonesuch(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">IEmpty(Interface):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertFalse(</span><span class="s4">'nonesuch' </span><span class="s3">in </span><span class="s1">IEmpty)</span>

    <span class="s3">def </span><span class="s1">test___contains__simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">ISimple(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s1">self.assertTrue(</span><span class="s4">'attr' </span><span class="s3">in </span><span class="s1">ISimple)</span>
        <span class="s1">self.assertTrue(</span><span class="s4">'method' </span><span class="s3">in </span><span class="s1">ISimple)</span>

    <span class="s3">def </span><span class="s1">test___contains__derived(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">IBase(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s3">class </span><span class="s1">IDerived(IBase):</span>
            <span class="s1">attr2 = Attribute(</span><span class="s4">u'My attr2'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method, overridden&quot;</span>

            <span class="s3">def </span><span class="s1">method2():</span>
                <span class="s2">&quot;My method2&quot;</span>

        <span class="s1">self.assertTrue(</span><span class="s4">'attr' </span><span class="s3">in </span><span class="s1">IDerived)</span>
        <span class="s1">self.assertTrue(</span><span class="s4">'method' </span><span class="s3">in </span><span class="s1">IDerived)</span>
        <span class="s1">self.assertTrue(</span><span class="s4">'attr2' </span><span class="s3">in </span><span class="s1">IDerived)</span>
        <span class="s1">self.assertTrue(</span><span class="s4">'method2' </span><span class="s3">in </span><span class="s1">IDerived)</span>

    <span class="s3">def </span><span class="s1">test___iter__empty(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">IEmpty(Interface):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertEqual(list(IEmpty)</span><span class="s3">, </span><span class="s1">[])</span>

    <span class="s3">def </span><span class="s1">test___iter__simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">ISimple(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s1">self.assertEqual(sorted(list(ISimple))</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'attr'</span><span class="s3">, </span><span class="s4">'method'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test___iter__derived(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>


        <span class="s3">class </span><span class="s1">IBase(Interface):</span>
            <span class="s1">attr = Attribute(</span><span class="s4">u'My attr'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method&quot;</span>

        <span class="s3">class </span><span class="s1">IDerived(IBase):</span>
            <span class="s1">attr2 = Attribute(</span><span class="s4">u'My attr2'</span><span class="s1">)</span>

            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;My method, overridden&quot;</span>

            <span class="s3">def </span><span class="s1">method2():</span>
                <span class="s2">&quot;My method2&quot;</span>

        <span class="s1">self.assertEqual(sorted(list(IDerived))</span><span class="s3">,</span>
                         <span class="s1">[</span><span class="s4">'attr'</span><span class="s3">, </span><span class="s4">'attr2'</span><span class="s3">, </span><span class="s4">'method'</span><span class="s3">, </span><span class="s4">'method2'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">test_function_attributes_become_tagged_values(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">ITagMe(Interface):</span>
            <span class="s3">def </span><span class="s1">method():</span>
                <span class="s2">&quot;&quot;&quot;docstring&quot;&quot;&quot;</span>
            <span class="s1">method.optional = </span><span class="s5">1</span>

        <span class="s1">method = ITagMe[</span><span class="s4">'method'</span><span class="s1">]</span>
        <span class="s1">self.assertEqual(method.getTaggedValue(</span><span class="s4">'optional'</span><span class="s1">)</span><span class="s3">, </span><span class="s5">1</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___doc___non_element(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">IHaveADocString(Interface):</span>
            <span class="s2">&quot;xxx&quot;</span>

        <span class="s1">self.assertEqual(IHaveADocString.__doc__</span><span class="s3">, </span><span class="s4">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(IHaveADocString)</span><span class="s3">, </span><span class="s1">[])</span>

    <span class="s3">def </span><span class="s1">test___doc___as_element(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">IHaveADocString(Interface):</span>
            <span class="s2">&quot;xxx&quot;</span>
            <span class="s1">__doc__ = Attribute(</span><span class="s4">'the doc'</span><span class="s1">)</span>

        <span class="s1">self.assertEqual(IHaveADocString.__doc__</span><span class="s3">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(IHaveADocString)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'__doc__'</span><span class="s1">])</span>

    <span class="s3">def </span><span class="s1">_errorsEqual(self</span><span class="s3">, </span><span class="s1">has_invariant</span><span class="s3">, </span><span class="s1">error_len</span><span class="s3">, </span><span class="s1">error_msgs</span><span class="s3">, </span><span class="s1">iface):</span>
        <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">Invalid</span>
        <span class="s1">self.assertRaises(Invalid</span><span class="s3">, </span><span class="s1">iface.validateInvariants</span><span class="s3">, </span><span class="s1">has_invariant)</span>
        <span class="s1">e = []</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">iface.validateInvariants(has_invariant</span><span class="s3">, </span><span class="s1">e)</span>
            <span class="s1">self.fail(</span><span class="s4">&quot;validateInvariants should always raise&quot;</span><span class="s1">)</span>
        <span class="s3">except </span><span class="s1">Invalid </span><span class="s3">as </span><span class="s1">error:</span>
            <span class="s1">self.assertEqual(error.args[</span><span class="s5">0</span><span class="s1">]</span><span class="s3">, </span><span class="s1">e)</span>

        <span class="s1">self.assertEqual(len(e)</span><span class="s3">, </span><span class="s1">error_len)</span>
        <span class="s1">msgs = [error.args[</span><span class="s5">0</span><span class="s1">] </span><span class="s3">for </span><span class="s1">error </span><span class="s3">in </span><span class="s1">e]</span>
        <span class="s1">msgs.sort()</span>
        <span class="s3">for </span><span class="s1">msg </span><span class="s3">in </span><span class="s1">msgs:</span>
            <span class="s1">self.assertEqual(msg</span><span class="s3">, </span><span class="s1">error_msgs.pop(</span><span class="s5">0</span><span class="s1">))</span>

    <span class="s3">def </span><span class="s1">test_invariant_simple(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">directlyProvides</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">invariant</span>

        <span class="s3">class </span><span class="s1">IInvariant(Interface):</span>
            <span class="s1">foo = Attribute(</span><span class="s4">'foo'</span><span class="s1">)</span>
            <span class="s1">bar = Attribute(</span><span class="s4">'bar; must eval to Boolean True if foo does'</span><span class="s1">)</span>
            <span class="s1">invariant(_ifFooThenBar)</span>

        <span class="s3">class </span><span class="s1">HasInvariant(object):</span>
            <span class="s3">pass</span>

        <span class="s0"># set up</span>
        <span class="s1">has_invariant = HasInvariant()</span>
        <span class="s1">directlyProvides(has_invariant</span><span class="s3">, </span><span class="s1">IInvariant)</span>

        <span class="s0"># the tests</span>
        <span class="s1">self.assertEqual(IInvariant.getTaggedValue(</span><span class="s4">'invariants'</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">[_ifFooThenBar])</span>
        <span class="s1">self.assertEqual(IInvariant.validateInvariants(has_invariant)</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">has_invariant.bar = </span><span class="s5">27</span>
        <span class="s1">self.assertEqual(IInvariant.validateInvariants(has_invariant)</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">42</span>
        <span class="s1">self.assertEqual(IInvariant.validateInvariants(has_invariant)</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s3">del </span><span class="s1">has_invariant.bar</span>
        <span class="s1">self._errorsEqual(has_invariant</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'If Foo, then Bar!'</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">IInvariant)</span>

    <span class="s3">def </span><span class="s1">test_invariant_nested(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">directlyProvides</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">invariant</span>

        <span class="s3">class </span><span class="s1">IInvariant(Interface):</span>
            <span class="s1">foo = Attribute(</span><span class="s4">'foo'</span><span class="s1">)</span>
            <span class="s1">bar = Attribute(</span><span class="s4">'bar; must eval to Boolean True if foo does'</span><span class="s1">)</span>
            <span class="s1">invariant(_ifFooThenBar)</span>

        <span class="s3">class </span><span class="s1">ISubInvariant(IInvariant):</span>
            <span class="s1">invariant(_barGreaterThanFoo)</span>

        <span class="s3">class </span><span class="s1">HasInvariant(object):</span>
            <span class="s3">pass</span>

        <span class="s0"># nested interfaces with invariants:</span>
        <span class="s1">self.assertEqual(ISubInvariant.getTaggedValue(</span><span class="s4">'invariants'</span><span class="s1">)</span><span class="s3">,</span>
                         <span class="s1">[_barGreaterThanFoo])</span>
        <span class="s1">has_invariant = HasInvariant()</span>
        <span class="s1">directlyProvides(has_invariant</span><span class="s3">, </span><span class="s1">ISubInvariant)</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">42</span>
        <span class="s0"># even though the interface has changed, we should still only have one</span>
        <span class="s0"># error.</span>
        <span class="s1">self._errorsEqual(has_invariant</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'If Foo, then Bar!'</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">ISubInvariant)</span>
        <span class="s0"># however, if we set foo to 0 (Boolean False) and bar to a negative</span>
        <span class="s0"># number then we'll get the new error</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">2</span>
        <span class="s1">has_invariant.bar = </span><span class="s5">1</span>
        <span class="s1">self._errorsEqual(has_invariant</span><span class="s3">, </span><span class="s5">1</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">'Please, Boo MUST be greater than Foo!'</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">ISubInvariant)</span>
        <span class="s0"># and if we set foo to a positive number and boo to 0, we'll</span>
        <span class="s0"># get both errors!</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">1</span>
        <span class="s1">has_invariant.bar = </span><span class="s5">0</span>
        <span class="s1">self._errorsEqual(has_invariant</span><span class="s3">, </span><span class="s5">2</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">'If Foo, then Bar!'</span><span class="s3">,</span>
                           <span class="s4">'Please, Boo MUST be greater than Foo!'</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">ISubInvariant)</span>
        <span class="s0"># for a happy ending, we'll make the invariants happy</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">1</span>
        <span class="s1">has_invariant.bar = </span><span class="s5">2</span>
        <span class="s1">self.assertEqual(IInvariant.validateInvariants(has_invariant)</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_invariant_mutandis(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">directlyProvides</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">invariant</span>

        <span class="s3">class </span><span class="s1">IInvariant(Interface):</span>
            <span class="s1">foo = Attribute(</span><span class="s4">'foo'</span><span class="s1">)</span>
            <span class="s1">bar = Attribute(</span><span class="s4">'bar; must eval to Boolean True if foo does'</span><span class="s1">)</span>
            <span class="s1">invariant(_ifFooThenBar)</span>

        <span class="s3">class </span><span class="s1">HasInvariant(object):</span>
            <span class="s3">pass</span>

        <span class="s0"># now we'll do two invariants on the same interface,</span>
        <span class="s0"># just to make sure that a small</span>
        <span class="s0"># multi-invariant interface is at least minimally tested.</span>
        <span class="s1">has_invariant = HasInvariant()</span>
        <span class="s1">directlyProvides(has_invariant</span><span class="s3">, </span><span class="s1">IInvariant)</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">42</span>

        <span class="s0"># if you really need to mutate, then this would be the way to do it.</span>
        <span class="s0"># Probably a bad idea, though. :-)</span>
        <span class="s1">old_invariants = IInvariant.getTaggedValue(</span><span class="s4">'invariants'</span><span class="s1">)</span>
        <span class="s1">invariants = old_invariants[:]</span>
        <span class="s1">invariants.append(_barGreaterThanFoo)</span>
        <span class="s1">IInvariant.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">invariants)</span>

        <span class="s0"># even though the interface has changed, we should still only have one</span>
        <span class="s0"># error.</span>
        <span class="s1">self._errorsEqual(has_invariant</span><span class="s3">, </span><span class="s5">1</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'If Foo, then Bar!'</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">IInvariant)</span>
        <span class="s0"># however, if we set foo to 0 (Boolean False) and bar to a negative</span>
        <span class="s0"># number then we'll get the new error</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">2</span>
        <span class="s1">has_invariant.bar = </span><span class="s5">1</span>
        <span class="s1">self._errorsEqual(has_invariant</span><span class="s3">, </span><span class="s5">1</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">'Please, Boo MUST be greater than Foo!'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">IInvariant)</span>
        <span class="s0"># and if we set foo to a positive number and boo to 0, we'll</span>
        <span class="s0"># get both errors!</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">1</span>
        <span class="s1">has_invariant.bar = </span><span class="s5">0</span>
        <span class="s1">self._errorsEqual(has_invariant</span><span class="s3">, </span><span class="s5">2</span><span class="s3">,</span>
                          <span class="s1">[</span><span class="s4">'If Foo, then Bar!'</span><span class="s3">,</span>
                           <span class="s4">'Please, Boo MUST be greater than Foo!'</span><span class="s1">]</span><span class="s3">,</span>
                          <span class="s1">IInvariant)</span>
        <span class="s0"># for another happy ending, we'll make the invariants happy again</span>
        <span class="s1">has_invariant.foo = </span><span class="s5">1</span>
        <span class="s1">has_invariant.bar = </span><span class="s5">2</span>
        <span class="s1">self.assertEqual(IInvariant.validateInvariants(has_invariant)</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s0"># clean up</span>
        <span class="s1">IInvariant.setTaggedValue(</span><span class="s4">'invariants'</span><span class="s3">, </span><span class="s1">old_invariants)</span>

    <span class="s3">def </span><span class="s1">test___doc___element(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">class </span><span class="s1">IDocstring(Interface):</span>
            <span class="s2">&quot;xxx&quot;</span>

        <span class="s1">self.assertEqual(IDocstring.__doc__</span><span class="s3">, </span><span class="s4">&quot;xxx&quot;</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(IDocstring)</span><span class="s3">, </span><span class="s1">[])</span>

        <span class="s3">class </span><span class="s1">IDocstringAndAttribute(Interface):</span>
            <span class="s2">&quot;xxx&quot;</span>

            <span class="s1">__doc__ = Attribute(</span><span class="s4">'the doc'</span><span class="s1">)</span>

        <span class="s1">self.assertEqual(IDocstringAndAttribute.__doc__</span><span class="s3">, </span><span class="s4">&quot;&quot;</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(IDocstringAndAttribute)</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'__doc__'</span><span class="s1">])</span>

    <span class="s1">@_skip_under_py3k</span>
    <span class="s3">def </span><span class="s1">testIssue228(self):</span>
        <span class="s0"># Test for http://collector.zope.org/Zope3-dev/228</span>
        <span class="s0"># Old style classes don't have a '__class__' attribute</span>
        <span class="s0"># No old style classes in Python 3, so the test becomes moot.</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s2">&quot;xxx&quot;</span>

        <span class="s3">class </span><span class="s1">OldStyle:</span>
            <span class="s1">__providedBy__ = </span><span class="s3">None</span>

        <span class="s1">self.assertRaises(AttributeError</span><span class="s3">, </span><span class="s1">I.providedBy</span><span class="s3">, </span><span class="s1">OldStyle)</span>

    <span class="s3">def </span><span class="s1">test_invariant_as_decorator(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementer</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">invariant</span>
        <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">Invalid</span>

        <span class="s3">class </span><span class="s1">IRange(Interface):</span>
            <span class="s1">min = Attribute(</span><span class="s4">&quot;Lower bound&quot;</span><span class="s1">)</span>
            <span class="s1">max = Attribute(</span><span class="s4">&quot;Upper bound&quot;</span><span class="s1">)</span>

            <span class="s1">@invariant</span>
            <span class="s3">def </span><span class="s1">range_invariant(ob):</span>
                <span class="s3">if </span><span class="s1">ob.max &lt; ob.min:</span>
                    <span class="s3">raise </span><span class="s1">Invalid(</span><span class="s4">'max &lt; min'</span><span class="s1">)</span>

        <span class="s1">@implementer(IRange)</span>
        <span class="s3">class </span><span class="s1">Range(object):</span>

            <span class="s3">def </span><span class="s1">__init__(self</span><span class="s3">, </span><span class="s1">min</span><span class="s3">, </span><span class="s1">max):</span>
                <span class="s1">self.min</span><span class="s3">, </span><span class="s1">self.max = min</span><span class="s3">, </span><span class="s1">max</span>

        <span class="s1">IRange.validateInvariants(Range(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">2</span><span class="s1">))</span>
        <span class="s1">IRange.validateInvariants(Range(</span><span class="s5">1</span><span class="s3">, </span><span class="s5">1</span><span class="s1">))</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">IRange.validateInvariants(Range(</span><span class="s5">2</span><span class="s3">, </span><span class="s5">1</span><span class="s1">))</span>
        <span class="s3">except </span><span class="s1">Invalid </span><span class="s3">as </span><span class="s1">e:</span>
            <span class="s1">self.assertEqual(str(e)</span><span class="s3">, </span><span class="s4">'max &lt; min'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_taggedValue(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">taggedValue</span>

        <span class="s3">class </span><span class="s1">ITagged(Interface):</span>
            <span class="s1">foo = Attribute(</span><span class="s4">'foo'</span><span class="s1">)</span>
            <span class="s1">bar = Attribute(</span><span class="s4">'bar; must eval to Boolean True if foo does'</span><span class="s1">)</span>
            <span class="s1">taggedValue(</span><span class="s4">'qux'</span><span class="s3">, </span><span class="s4">'Spam'</span><span class="s1">)</span>

        <span class="s3">class </span><span class="s1">IDerived(ITagged):</span>
            <span class="s1">taggedValue(</span><span class="s4">'qux'</span><span class="s3">, </span><span class="s4">'Spam Spam'</span><span class="s1">)</span>
            <span class="s1">taggedValue(</span><span class="s4">'foo'</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>

        <span class="s3">class </span><span class="s1">IDerived2(IDerived):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertEqual(ITagged.getTaggedValue(</span><span class="s4">'qux'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'Spam'</span><span class="s1">)</span>
        <span class="s1">self.assertRaises(KeyError</span><span class="s3">, </span><span class="s1">ITagged.getTaggedValue</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(ITagged.getTaggedValueTags())</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'qux'</span><span class="s1">])</span>

        <span class="s1">self.assertEqual(IDerived2.getTaggedValue(</span><span class="s4">'qux'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'Spam Spam'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(IDerived2.getTaggedValue(</span><span class="s4">'foo'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(set(IDerived2.getTaggedValueTags())</span><span class="s3">, </span><span class="s1">set([</span><span class="s4">'qux'</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">]))</span>

    <span class="s3">def </span><span class="s1">_make_taggedValue_tree(self</span><span class="s3">, </span><span class="s1">base):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">taggedValue</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s1">O = base</span>
        <span class="s3">class </span><span class="s1">F(O):</span>
            <span class="s1">taggedValue(</span><span class="s4">'tag'</span><span class="s3">, </span><span class="s4">'F'</span><span class="s1">)</span>
            <span class="s1">tag = Attribute(</span><span class="s4">'F'</span><span class="s1">)</span>
        <span class="s3">class </span><span class="s1">E(O):</span>
            <span class="s1">taggedValue(</span><span class="s4">'tag'</span><span class="s3">, </span><span class="s4">'E'</span><span class="s1">)</span>
            <span class="s1">tag = Attribute(</span><span class="s4">'E'</span><span class="s1">)</span>
        <span class="s3">class </span><span class="s1">D(O):</span>
            <span class="s1">taggedValue(</span><span class="s4">'tag'</span><span class="s3">, </span><span class="s4">'D'</span><span class="s1">)</span>
            <span class="s1">tag = Attribute(</span><span class="s4">'D'</span><span class="s1">)</span>
        <span class="s3">class </span><span class="s1">C(D</span><span class="s3">, </span><span class="s1">F):</span>
            <span class="s1">taggedValue(</span><span class="s4">'tag'</span><span class="s3">, </span><span class="s4">'C'</span><span class="s1">)</span>
            <span class="s1">tag = Attribute(</span><span class="s4">'C'</span><span class="s1">)</span>
        <span class="s3">class </span><span class="s1">B(D</span><span class="s3">, </span><span class="s1">E):</span>
            <span class="s3">pass</span>
        <span class="s3">class </span><span class="s1">A(B</span><span class="s3">, </span><span class="s1">C):</span>
            <span class="s3">pass</span>

        <span class="s3">return </span><span class="s1">A</span>

    <span class="s3">def </span><span class="s1">test_getTaggedValue_follows__iro__(self):</span>
        <span class="s0"># And not just looks at __bases__.</span>
        <span class="s0"># https://github.com/zopefoundation/zope.interface/issues/190</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s0"># First, confirm that looking at a true class</span>
        <span class="s0"># hierarchy follows the __mro__.</span>
        <span class="s1">class_A = self._make_taggedValue_tree(object)</span>
        <span class="s1">self.assertEqual(class_A.tag.__name__</span><span class="s3">, </span><span class="s4">'C'</span><span class="s1">)</span>

        <span class="s0"># Now check that Interface does, both for attributes...</span>
        <span class="s1">iface_A = self._make_taggedValue_tree(Interface)</span>
        <span class="s1">self.assertEqual(iface_A[</span><span class="s4">'tag'</span><span class="s1">].__name__</span><span class="s3">, </span><span class="s4">'C'</span><span class="s1">)</span>
        <span class="s0"># ... and for tagged values.</span>
        <span class="s1">self.assertEqual(iface_A.getTaggedValue(</span><span class="s4">'tag'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'C'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(iface_A.queryTaggedValue(</span><span class="s4">'tag'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'C'</span><span class="s1">)</span>
        <span class="s0"># Of course setting something lower overrides it.</span>
        <span class="s3">assert </span><span class="s1">iface_A.__bases__[</span><span class="s5">0</span><span class="s1">].__name__ == </span><span class="s4">'B'</span>
        <span class="s1">iface_A.__bases__[</span><span class="s5">0</span><span class="s1">].setTaggedValue(</span><span class="s4">'tag'</span><span class="s3">, </span><span class="s4">'B'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(iface_A.getTaggedValue(</span><span class="s4">'tag'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'B'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getDirectTaggedValue_ignores__iro__(self):</span>
        <span class="s0"># https://github.com/zopefoundation/zope.interface/issues/190</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s1">A = self._make_taggedValue_tree(Interface)</span>
        <span class="s1">self.assertIsNone(A.queryDirectTaggedValue(</span><span class="s4">'tag'</span><span class="s1">))</span>
        <span class="s1">self.assertEqual([]</span><span class="s3">, </span><span class="s1">list(A.getDirectTaggedValueTags()))</span>

        <span class="s3">with </span><span class="s1">self.assertRaises(KeyError):</span>
            <span class="s1">A.getDirectTaggedValue(</span><span class="s4">'tag'</span><span class="s1">)</span>

        <span class="s1">A.setTaggedValue(</span><span class="s4">'tag'</span><span class="s3">, </span><span class="s4">'A'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(A.queryDirectTaggedValue(</span><span class="s4">'tag'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'A'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(A.getDirectTaggedValue(</span><span class="s4">'tag'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'A'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual([</span><span class="s4">'tag'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">list(A.getDirectTaggedValueTags()))</span>

        <span class="s3">assert </span><span class="s1">A.__bases__[</span><span class="s5">1</span><span class="s1">].__name__ == </span><span class="s4">'C'</span>
        <span class="s1">C = A.__bases__[</span><span class="s5">1</span><span class="s1">]</span>
        <span class="s1">self.assertEqual(C.queryDirectTaggedValue(</span><span class="s4">'tag'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'C'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(C.getDirectTaggedValue(</span><span class="s4">'tag'</span><span class="s1">)</span><span class="s3">, </span><span class="s4">'C'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual([</span><span class="s4">'tag'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">list(C.getDirectTaggedValueTags()))</span>

    <span class="s3">def </span><span class="s1">test_description_cache_management(self):</span>
        <span class="s0"># See https://bugs.launchpad.net/zope.interface/+bug/185974</span>
        <span class="s0"># There was a bug where the cache used by Specification.get() was not</span>
        <span class="s0"># cleared when the bases were changed.</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Attribute</span>

        <span class="s3">class </span><span class="s1">I1(Interface):</span>
            <span class="s1">a = Attribute(</span><span class="s4">'a'</span><span class="s1">)</span>

        <span class="s3">class </span><span class="s1">I2(I1):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">I3(I2):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertTrue(I3.get(</span><span class="s4">'a'</span><span class="s1">) </span><span class="s3">is </span><span class="s1">I1.get(</span><span class="s4">'a'</span><span class="s1">))</span>

        <span class="s1">I2.__bases__ = (Interface</span><span class="s3">,</span><span class="s1">)</span>
        <span class="s1">self.assertTrue(I3.get(</span><span class="s4">'a'</span><span class="s1">) </span><span class="s3">is None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___call___defers_to___conform___(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementer</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s3">pass</span>

        <span class="s1">@implementer(I)</span>
        <span class="s3">class </span><span class="s1">C(object):</span>
            <span class="s3">def </span><span class="s1">__conform__(self</span><span class="s3">, </span><span class="s1">proto):</span>
                <span class="s3">return </span><span class="s5">0</span>

        <span class="s1">self.assertEqual(I(C())</span><span class="s3">, </span><span class="s5">0</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___call___object_implements(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementer</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s3">pass</span>

        <span class="s1">@implementer(I)</span>
        <span class="s3">class </span><span class="s1">C(object):</span>
            <span class="s3">pass</span>

        <span class="s1">c = C()</span>
        <span class="s1">self.assertTrue(I(c) </span><span class="s3">is </span><span class="s1">c)</span>

    <span class="s3">def </span><span class="s1">test___call___miss_wo_alternate(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">C(object):</span>
            <span class="s3">pass</span>

        <span class="s1">c = C()</span>
        <span class="s1">self.assertRaises(TypeError</span><span class="s3">, </span><span class="s1">I</span><span class="s3">, </span><span class="s1">c)</span>

    <span class="s3">def </span><span class="s1">test___call___miss_w_alternate(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">C(object):</span>
            <span class="s3">pass</span>

        <span class="s1">c = C()</span>
        <span class="s1">self.assertTrue(I(c</span><span class="s3">, </span><span class="s1">self) </span><span class="s3">is </span><span class="s1">self)</span>

    <span class="s3">def </span><span class="s1">test___call___w_adapter_hook(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">adapter_hooks</span>

        <span class="s3">def </span><span class="s1">_miss(iface</span><span class="s3">, </span><span class="s1">obj):</span>
            <span class="s3">pass</span>

        <span class="s3">def </span><span class="s1">_hit(iface</span><span class="s3">, </span><span class="s1">obj):</span>
            <span class="s3">return </span><span class="s1">self</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s3">pass</span>

        <span class="s3">class </span><span class="s1">C(object):</span>
            <span class="s3">pass</span>

        <span class="s1">c = C()</span>

        <span class="s1">old_adapter_hooks = adapter_hooks[:]</span>
        <span class="s1">adapter_hooks[:] = [_miss</span><span class="s3">, </span><span class="s1">_hit]</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">self.assertTrue(I(c) </span><span class="s3">is </span><span class="s1">self)</span>
        <span class="s3">finally</span><span class="s1">:</span>
            <span class="s1">adapter_hooks[:] = old_adapter_hooks</span>

    <span class="s3">def </span><span class="s1">test___call___w_overridden_adapt(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interfacemethod</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementer</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>

            <span class="s1">@interfacemethod</span>
            <span class="s3">def </span><span class="s1">__adapt__(self</span><span class="s3">, </span><span class="s1">obj):</span>
                <span class="s3">return </span><span class="s5">42</span>

        <span class="s1">@implementer(I)</span>
        <span class="s3">class </span><span class="s1">O(object):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertEqual(</span><span class="s5">42</span><span class="s3">, </span><span class="s1">I(object()))</span>
        <span class="s0"># __adapt__ can ignore the fact that the object provides</span>
        <span class="s0"># the interface if it chooses.</span>
        <span class="s1">self.assertEqual(</span><span class="s5">42</span><span class="s3">, </span><span class="s1">I(O()))</span>

    <span class="s3">def </span><span class="s1">test___call___w_overridden_adapt_and_conform(self):</span>
        <span class="s0"># Conform is first, taking precedence over __adapt__,</span>
        <span class="s0"># *if* it returns non-None</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interfacemethod</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementer</span>

        <span class="s3">class </span><span class="s1">IAdapt(Interface):</span>
            <span class="s1">@interfacemethod</span>
            <span class="s3">def </span><span class="s1">__adapt__(self</span><span class="s3">, </span><span class="s1">obj):</span>
                <span class="s3">return </span><span class="s5">42</span>

        <span class="s3">class </span><span class="s1">ISimple(Interface):</span>
            <span class="s2">&quot;&quot;&quot;Nothing special.&quot;&quot;&quot;</span>

        <span class="s1">@implementer(IAdapt)</span>
        <span class="s3">class </span><span class="s1">Conform24(object):</span>
            <span class="s3">def </span><span class="s1">__conform__(self</span><span class="s3">, </span><span class="s1">iface):</span>
                <span class="s3">return </span><span class="s5">24</span>

        <span class="s1">@implementer(IAdapt)</span>
        <span class="s3">class </span><span class="s1">ConformNone(object):</span>
            <span class="s3">def </span><span class="s1">__conform__(self</span><span class="s3">, </span><span class="s1">iface):</span>
                <span class="s3">return None</span>

        <span class="s1">self.assertEqual(</span><span class="s5">42</span><span class="s3">, </span><span class="s1">IAdapt(object()))</span>

        <span class="s1">self.assertEqual(</span><span class="s5">24</span><span class="s3">, </span><span class="s1">ISimple(Conform24()))</span>
        <span class="s1">self.assertEqual(</span><span class="s5">24</span><span class="s3">, </span><span class="s1">IAdapt(Conform24()))</span>

        <span class="s3">with </span><span class="s1">self.assertRaises(TypeError):</span>
            <span class="s1">ISimple(ConformNone())</span>

        <span class="s1">self.assertEqual(</span><span class="s5">42</span><span class="s3">, </span><span class="s1">IAdapt(ConformNone()))</span>


    <span class="s3">def </span><span class="s1">test___call___w_overridden_adapt_call_super(self):</span>
        <span class="s3">import </span><span class="s1">sys</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interfacemethod</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">implementer</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>

            <span class="s1">@interfacemethod</span>
            <span class="s3">def </span><span class="s1">__adapt__(self</span><span class="s3">, </span><span class="s1">obj):</span>
                <span class="s3">if not </span><span class="s1">self.providedBy(obj):</span>
                    <span class="s3">return </span><span class="s5">42</span>
                <span class="s3">if </span><span class="s1">sys.version_info[:</span><span class="s5">2</span><span class="s1">] &gt; (</span><span class="s5">3</span><span class="s3">, </span><span class="s5">5</span><span class="s1">):</span>
                    <span class="s0"># Python 3.5 raises 'RuntimeError: super() __class__ is not a type'</span>
                    <span class="s3">return </span><span class="s1">super().__adapt__(obj)</span>

                <span class="s3">return </span><span class="s1">super(type(I)</span><span class="s3">, </span><span class="s1">self).__adapt__(obj)</span>

        <span class="s1">@implementer(I)</span>
        <span class="s3">class </span><span class="s1">O(object):</span>
            <span class="s3">pass</span>

        <span class="s1">self.assertEqual(</span><span class="s5">42</span><span class="s3">, </span><span class="s1">I(object()))</span>
        <span class="s1">o = O()</span>
        <span class="s1">self.assertIs(o</span><span class="s3">, </span><span class="s1">I(o))</span>

    <span class="s3">def </span><span class="s1">test___adapt___as_method_and_implementation(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interfacemethod</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>
            <span class="s1">@interfacemethod</span>
            <span class="s3">def </span><span class="s1">__adapt__(self</span><span class="s3">, </span><span class="s1">obj):</span>
                <span class="s3">return </span><span class="s5">42</span>

            <span class="s3">def </span><span class="s1">__adapt__(to_adapt):</span>
                <span class="s2">&quot;This is a protocol&quot;</span>

        <span class="s1">self.assertEqual(</span><span class="s5">42</span><span class="s3">, </span><span class="s1">I(object()))</span>
        <span class="s1">self.assertEqual(I[</span><span class="s4">'__adapt__'</span><span class="s1">].getSignatureString()</span><span class="s3">, </span><span class="s4">'(to_adapt)'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test___adapt__inheritance_and_type(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interfacemethod</span>

        <span class="s3">class </span><span class="s1">IRoot(Interface):</span>
            <span class="s2">&quot;&quot;&quot;Root&quot;&quot;&quot;</span>

        <span class="s3">class </span><span class="s1">IWithAdapt(IRoot):</span>
            <span class="s1">@interfacemethod</span>
            <span class="s3">def </span><span class="s1">__adapt__(self</span><span class="s3">, </span><span class="s1">obj):</span>
                <span class="s3">return </span><span class="s5">42</span>

        <span class="s3">class </span><span class="s1">IOther(IRoot):</span>
            <span class="s2">&quot;&quot;&quot;Second branch&quot;&quot;&quot;</span>

        <span class="s3">class </span><span class="s1">IUnrelated(Interface):</span>
            <span class="s2">&quot;&quot;&quot;Unrelated&quot;&quot;&quot;</span>

        <span class="s3">class </span><span class="s1">IDerivedAdapt(IUnrelated</span><span class="s3">, </span><span class="s1">IWithAdapt</span><span class="s3">, </span><span class="s1">IOther):</span>
            <span class="s2">&quot;&quot;&quot;Inherits an adapt&quot;&quot;&quot;</span>
            <span class="s0"># Order of &quot;inheritance&quot; matters here.</span>

        <span class="s3">class </span><span class="s1">IDerived2Adapt(IDerivedAdapt):</span>
            <span class="s2">&quot;&quot;&quot;Overrides an inherited custom adapt.&quot;&quot;&quot;</span>
            <span class="s1">@interfacemethod</span>
            <span class="s3">def </span><span class="s1">__adapt__(self</span><span class="s3">, </span><span class="s1">obj):</span>
                <span class="s3">return </span><span class="s5">24</span>

        <span class="s1">self.assertEqual(</span><span class="s5">42</span><span class="s3">, </span><span class="s1">IDerivedAdapt(object()))</span>
        <span class="s3">for </span><span class="s1">iface </span><span class="s3">in </span><span class="s1">IRoot</span><span class="s3">, </span><span class="s1">IWithAdapt</span><span class="s3">, </span><span class="s1">IOther</span><span class="s3">, </span><span class="s1">IUnrelated</span><span class="s3">, </span><span class="s1">IDerivedAdapt:</span>
            <span class="s1">self.assertEqual(__name__</span><span class="s3">, </span><span class="s1">iface.__module__)</span>

        <span class="s3">for </span><span class="s1">iface </span><span class="s3">in </span><span class="s1">IRoot</span><span class="s3">, </span><span class="s1">IOther</span><span class="s3">, </span><span class="s1">IUnrelated:</span>
            <span class="s1">self.assertEqual(type(IRoot)</span><span class="s3">, </span><span class="s1">type(Interface))</span>

        <span class="s0"># But things that implemented __adapt__ got a new type</span>
        <span class="s1">self.assertNotEqual(type(Interface)</span><span class="s3">, </span><span class="s1">type(IWithAdapt))</span>
        <span class="s1">self.assertEqual(type(IWithAdapt)</span><span class="s3">, </span><span class="s1">type(IDerivedAdapt))</span>
        <span class="s1">self.assertIsInstance(IWithAdapt</span><span class="s3">, </span><span class="s1">type(Interface))</span>

        <span class="s1">self.assertEqual(</span><span class="s5">24</span><span class="s3">, </span><span class="s1">IDerived2Adapt(object()))</span>
        <span class="s1">self.assertNotEqual(type(IDerived2Adapt)</span><span class="s3">, </span><span class="s1">type(IDerivedAdapt))</span>
        <span class="s1">self.assertIsInstance(IDerived2Adapt</span><span class="s3">, </span><span class="s1">type(IDerivedAdapt))</span>

    <span class="s3">def </span><span class="s1">test_interfacemethod_is_general(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">Interface</span>
        <span class="s3">from </span><span class="s1">zope.interface </span><span class="s3">import </span><span class="s1">interfacemethod</span>

        <span class="s3">class </span><span class="s1">I(Interface):</span>

            <span class="s1">@interfacemethod</span>
            <span class="s3">def </span><span class="s1">__call__(self</span><span class="s3">, </span><span class="s1">obj):</span>
                <span class="s2">&quot;&quot;&quot;Replace an existing method&quot;&quot;&quot;</span>
                <span class="s3">return </span><span class="s5">42</span>

            <span class="s1">@interfacemethod</span>
            <span class="s3">def </span><span class="s1">this_is_new(self):</span>
                <span class="s3">return </span><span class="s5">42</span>

        <span class="s1">self.assertEqual(I(self)</span><span class="s3">, </span><span class="s5">42</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(I.this_is_new()</span><span class="s3">, </span><span class="s5">42</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">AttributeTests(ElementTests):</span>

    <span class="s1">DEFAULT_NAME = </span><span class="s4">'TestAttribute'</span>

    <span class="s3">def </span><span class="s1">_getTargetClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Attribute</span>
        <span class="s3">return </span><span class="s1">Attribute</span>

    <span class="s3">def </span><span class="s1">test__repr__w_interface(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.interface = type(self)</span>
        <span class="s1">r = repr(method)</span>
        <span class="s1">self.assertTrue(r.startswith(</span><span class="s4">'&lt;zope.interface.interface.Attribute object at'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">r)</span>
        <span class="s1">self.assertTrue(r.endswith(</span><span class="s4">' ' </span><span class="s1">+ __name__ + </span><span class="s4">'.AttributeTests.TestAttribute&gt;'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">r)</span>

    <span class="s3">def </span><span class="s1">test__repr__wo_interface(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">r = repr(method)</span>
        <span class="s1">self.assertTrue(r.startswith(</span><span class="s4">'&lt;zope.interface.interface.Attribute object at'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">r)</span>
        <span class="s1">self.assertTrue(r.endswith(</span><span class="s4">' TestAttribute&gt;'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">r)</span>

    <span class="s3">def </span><span class="s1">test__str__w_interface(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.interface = type(self)</span>
        <span class="s1">r = str(method)</span>
        <span class="s1">self.assertEqual(r</span><span class="s3">, </span><span class="s1">__name__ + </span><span class="s4">'.AttributeTests.TestAttribute'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test__str__wo_interface(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">r = str(method)</span>
        <span class="s1">self.assertEqual(r</span><span class="s3">, </span><span class="s4">'TestAttribute'</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">MethodTests(AttributeTests):</span>

    <span class="s1">DEFAULT_NAME = </span><span class="s4">'TestMethod'</span>

    <span class="s3">def </span><span class="s1">_getTargetClass(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">Method</span>
        <span class="s3">return </span><span class="s1">Method</span>

    <span class="s3">def </span><span class="s1">test_optional_as_property(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">self.assertEqual(method.optional</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">method.optional = {</span><span class="s4">'foo'</span><span class="s1">: </span><span class="s4">'bar'</span><span class="s1">}</span>
        <span class="s1">self.assertEqual(method.optional</span><span class="s3">, </span><span class="s1">{</span><span class="s4">'foo'</span><span class="s1">: </span><span class="s4">'bar'</span><span class="s1">})</span>
        <span class="s3">del </span><span class="s1">method.optional</span>
        <span class="s1">self.assertEqual(method.optional</span><span class="s3">, </span><span class="s1">{})</span>

    <span class="s3">def </span><span class="s1">test___call___raises_BrokenImplementation(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">BrokenImplementation</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s3">try</span><span class="s1">:</span>
            <span class="s1">method()</span>
        <span class="s3">except </span><span class="s1">BrokenImplementation </span><span class="s3">as </span><span class="s1">e:</span>
            <span class="s1">self.assertEqual(e.interface</span><span class="s3">, None</span><span class="s1">)</span>
            <span class="s1">self.assertEqual(e.name</span><span class="s3">, </span><span class="s1">self.DEFAULT_NAME)</span>
        <span class="s3">else</span><span class="s1">:</span>
            <span class="s1">self.fail(</span><span class="s4">'__call__ should raise BrokenImplementation'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getSignatureInfo_bare(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getSignatureString_bare(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">self.assertEqual(method.getSignatureString()</span><span class="s3">, </span><span class="s4">'()'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getSignatureString_w_only_required(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.positional = method.required = [</span><span class="s4">'foo'</span><span class="s1">]</span>
        <span class="s1">self.assertEqual(method.getSignatureString()</span><span class="s3">, </span><span class="s4">'(foo)'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getSignatureString_w_optional(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.positional = method.required = [</span><span class="s4">'foo'</span><span class="s1">]</span>
        <span class="s1">method.optional = {</span><span class="s4">'foo'</span><span class="s1">: </span><span class="s4">'bar'</span><span class="s1">}</span>
        <span class="s1">self.assertEqual(method.getSignatureString()</span><span class="s3">, </span><span class="s4">&quot;(foo='bar')&quot;</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getSignatureString_w_varargs(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.varargs = </span><span class="s4">'args'</span>
        <span class="s1">self.assertEqual(method.getSignatureString()</span><span class="s3">, </span><span class="s4">&quot;(*args)&quot;</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_getSignatureString_w_kwargs(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.kwargs = </span><span class="s4">'kw'</span>
        <span class="s1">self.assertEqual(method.getSignatureString()</span><span class="s3">, </span><span class="s4">&quot;(**kw)&quot;</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test__repr__w_interface(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.kwargs = </span><span class="s4">'kw'</span>
        <span class="s1">method.interface = type(self)</span>
        <span class="s1">r = repr(method)</span>
        <span class="s1">self.assertTrue(r.startswith(</span><span class="s4">'&lt;zope.interface.interface.Method object at'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">r)</span>
        <span class="s1">self.assertTrue(r.endswith(</span><span class="s4">' ' </span><span class="s1">+ __name__ + </span><span class="s4">'.MethodTests.TestMethod(**kw)&gt;'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">r)</span>

    <span class="s3">def </span><span class="s1">test__repr__wo_interface(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.kwargs = </span><span class="s4">'kw'</span>
        <span class="s1">r = repr(method)</span>
        <span class="s1">self.assertTrue(r.startswith(</span><span class="s4">'&lt;zope.interface.interface.Method object at'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">r)</span>
        <span class="s1">self.assertTrue(r.endswith(</span><span class="s4">' TestMethod(**kw)&gt;'</span><span class="s1">)</span><span class="s3">, </span><span class="s1">r)</span>

    <span class="s3">def </span><span class="s1">test__str__w_interface(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.kwargs = </span><span class="s4">'kw'</span>
        <span class="s1">method.interface = type(self)</span>
        <span class="s1">r = str(method)</span>
        <span class="s1">self.assertEqual(r</span><span class="s3">, </span><span class="s1">__name__ + </span><span class="s4">'.MethodTests.TestMethod(**kw)'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test__str__wo_interface(self):</span>
        <span class="s1">method = self._makeOne()</span>
        <span class="s1">method.kwargs = </span><span class="s4">'kw'</span>
        <span class="s1">r = str(method)</span>
        <span class="s1">self.assertEqual(r</span><span class="s3">, </span><span class="s4">'TestMethod(**kw)'</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">Test_fromFunction(unittest.TestCase):</span>

    <span class="s3">def </span><span class="s1">_callFUT(self</span><span class="s3">, </span><span class="s1">*args</span><span class="s3">, </span><span class="s1">**kw):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromFunction</span>
        <span class="s3">return </span><span class="s1">fromFunction(*args</span><span class="s3">, </span><span class="s1">**kw)</span>

    <span class="s3">def </span><span class="s1">test_bare(self):</span>
        <span class="s3">def </span><span class="s1">_func():</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func)</span>
        <span class="s1">self.assertEqual(method.getName()</span><span class="s3">, </span><span class="s4">'_func'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(method.getDoc()</span><span class="s3">, </span><span class="s4">'DOCSTRING'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(method.interface</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(method.getTaggedValueTags())</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_w_interface(self):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">InterfaceClass</span>
        <span class="s3">class </span><span class="s1">IFoo(InterfaceClass):</span>
            <span class="s3">pass</span>
        <span class="s3">def </span><span class="s1">_func():</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func</span><span class="s3">, </span><span class="s1">interface=IFoo)</span>
        <span class="s1">self.assertEqual(method.interface</span><span class="s3">, </span><span class="s1">IFoo)</span>

    <span class="s3">def </span><span class="s1">test_w_name(self):</span>
        <span class="s3">def </span><span class="s1">_func():</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func</span><span class="s3">, </span><span class="s1">name=</span><span class="s4">'anotherName'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(method.getName()</span><span class="s3">, </span><span class="s4">'anotherName'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_w_only_required(self):</span>
        <span class="s3">def </span><span class="s1">_func(foo):</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func)</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_w_optional(self):</span>
        <span class="s3">def </span><span class="s1">_func(foo=</span><span class="s4">'bar'</span><span class="s1">):</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func)</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{</span><span class="s4">'foo'</span><span class="s1">: </span><span class="s4">'bar'</span><span class="s1">})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_w_optional_self(self):</span>
        <span class="s0"># This is a weird case, trying to cover the following code in</span>
        <span class="s0"># FUT::</span>
        <span class="s0">#</span>
        <span class="s0"># nr = na-len(defaults)</span>
        <span class="s0"># if nr &lt; 0:</span>
        <span class="s0">#     defaults=defaults[-nr:]</span>
        <span class="s0">#     nr = 0</span>
        <span class="s3">def </span><span class="s1">_func(self=</span><span class="s4">'bar'</span><span class="s1">):</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func</span><span class="s3">, </span><span class="s1">imlevel=</span><span class="s5">1</span><span class="s1">)</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_w_varargs(self):</span>
        <span class="s3">def </span><span class="s1">_func(*args):</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func)</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'args'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_w_kwargs(self):</span>
        <span class="s3">def </span><span class="s1">_func(**kw):</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func)</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'kw'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_full_spectrum(self):</span>
        <span class="s3">def </span><span class="s1">_func(foo</span><span class="s3">, </span><span class="s1">bar=</span><span class="s4">'baz'</span><span class="s3">, </span><span class="s1">*args</span><span class="s3">, </span><span class="s1">**kw): </span><span class="s0"># pylint:disable=keyword-arg-before-vararg</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(_func)</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'foo'</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{</span><span class="s4">'bar'</span><span class="s1">: </span><span class="s4">'baz'</span><span class="s1">})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'args'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'kw'</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">Test_fromMethod(unittest.TestCase):</span>

    <span class="s3">def </span><span class="s1">_callFUT(self</span><span class="s3">, </span><span class="s1">*args</span><span class="s3">, </span><span class="s1">**kw):</span>
        <span class="s3">from </span><span class="s1">zope.interface.interface </span><span class="s3">import </span><span class="s1">fromMethod</span>
        <span class="s3">return </span><span class="s1">fromMethod(*args</span><span class="s3">, </span><span class="s1">**kw)</span>

    <span class="s3">def </span><span class="s1">test_no_args(self):</span>
        <span class="s3">class </span><span class="s1">Foo(object):</span>
            <span class="s3">def </span><span class="s1">bar(self):</span>
                <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(Foo.bar)</span>
        <span class="s1">self.assertEqual(method.getName()</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(method.getDoc()</span><span class="s3">, </span><span class="s4">'DOCSTRING'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(method.interface</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(method.getTaggedValueTags())</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_full_spectrum(self):</span>
        <span class="s3">class </span><span class="s1">Foo(object):</span>
            <span class="s3">def </span><span class="s1">bar(self</span><span class="s3">, </span><span class="s1">foo</span><span class="s3">, </span><span class="s1">bar=</span><span class="s4">'baz'</span><span class="s3">, </span><span class="s1">*args</span><span class="s3">, </span><span class="s1">**kw): </span><span class="s0"># pylint:disable=keyword-arg-before-vararg</span>
                <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(Foo.bar)</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'foo'</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[</span><span class="s4">'foo'</span><span class="s1">])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{</span><span class="s4">'bar'</span><span class="s1">: </span><span class="s4">'baz'</span><span class="s1">})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'args'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, </span><span class="s4">'kw'</span><span class="s1">)</span>

    <span class="s3">def </span><span class="s1">test_w_non_method(self):</span>
        <span class="s3">def </span><span class="s1">foo():</span>
            <span class="s2">&quot;DOCSTRING&quot;</span>
        <span class="s1">method = self._callFUT(foo)</span>
        <span class="s1">self.assertEqual(method.getName()</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(method.getDoc()</span><span class="s3">, </span><span class="s4">'DOCSTRING'</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(method.interface</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(list(method.getTaggedValueTags())</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">info = method.getSignatureInfo()</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'positional'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(list(info[</span><span class="s4">'required'</span><span class="s1">])</span><span class="s3">, </span><span class="s1">[])</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'optional'</span><span class="s1">]</span><span class="s3">, </span><span class="s1">{})</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'varargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>
        <span class="s1">self.assertEqual(info[</span><span class="s4">'kwargs'</span><span class="s1">]</span><span class="s3">, None</span><span class="s1">)</span>

<span class="s3">class </span><span class="s1">DummyDependent(object):</span>

    <span class="s3">def </span><span class="s1">__init__(self):</span>
        <span class="s1">self._changed = []</span>

    <span class="s3">def </span><span class="s1">changed(self</span><span class="s3">, </span><span class="s1">originally_changed):</span>
        <span class="s1">self._changed.append(originally_changed)</span>


<span class="s3">def </span><span class="s1">_barGreaterThanFoo(obj):</span>
    <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">Invalid</span>
    <span class="s1">foo = getattr(obj</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s3">, None</span><span class="s1">)</span>
    <span class="s1">bar = getattr(obj</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s3">, None</span><span class="s1">)</span>
    <span class="s3">if </span><span class="s1">foo </span><span class="s3">is not None and </span><span class="s1">isinstance(foo</span><span class="s3">, </span><span class="s1">type(bar)):</span>
        <span class="s0"># type checking should be handled elsewhere (like, say,</span>
        <span class="s0"># schema); these invariants should be intra-interface</span>
        <span class="s0"># constraints.  This is a hacky way to do it, maybe, but you</span>
        <span class="s0"># get the idea</span>
        <span class="s3">if not </span><span class="s1">bar &gt; foo:</span>
            <span class="s3">raise </span><span class="s1">Invalid(</span><span class="s4">'Please, Boo MUST be greater than Foo!'</span><span class="s1">)</span>

<span class="s3">def </span><span class="s1">_ifFooThenBar(obj):</span>
    <span class="s3">from </span><span class="s1">zope.interface.exceptions </span><span class="s3">import </span><span class="s1">Invalid</span>
    <span class="s3">if </span><span class="s1">getattr(obj</span><span class="s3">, </span><span class="s4">'foo'</span><span class="s3">, None</span><span class="s1">) </span><span class="s3">and not </span><span class="s1">getattr(obj</span><span class="s3">, </span><span class="s4">'bar'</span><span class="s3">, None</span><span class="s1">):</span>
        <span class="s3">raise </span><span class="s1">Invalid(</span><span class="s4">'If Foo, then Bar!'</span><span class="s1">)</span>


<span class="s3">class </span><span class="s1">_Monkey(object):</span>
    <span class="s0"># context-manager for replacing module names in the scope of a test.</span>
    <span class="s3">def </span><span class="s1">__init__(self</span><span class="s3">, </span><span class="s1">module</span><span class="s3">, </span><span class="s1">**kw):</span>
        <span class="s1">self.module = module</span>
        <span class="s1">self.to_restore = {key: getattr(module</span><span class="s3">, </span><span class="s1">key) </span><span class="s3">for </span><span class="s1">key </span><span class="s3">in </span><span class="s1">kw}</span>
        <span class="s3">for </span><span class="s1">key</span><span class="s3">, </span><span class="s1">value </span><span class="s3">in </span><span class="s1">kw.items():</span>
            <span class="s1">setattr(module</span><span class="s3">, </span><span class="s1">key</span><span class="s3">, </span><span class="s1">value)</span>

    <span class="s3">def </span><span class="s1">__enter__(self):</span>
        <span class="s3">return </span><span class="s1">self</span>

    <span class="s3">def </span><span class="s1">__exit__(self</span><span class="s3">, </span><span class="s1">exc_type</span><span class="s3">, </span><span class="s1">exc_val</span><span class="s3">, </span><span class="s1">exc_tb):</span>
        <span class="s3">for </span><span class="s1">key</span><span class="s3">, </span><span class="s1">value </span><span class="s3">in </span><span class="s1">self.to_restore.items():</span>
            <span class="s1">setattr(self.module</span><span class="s3">, </span><span class="s1">key</span><span class="s3">, </span><span class="s1">value)</span>
</pre>
</body>
</html>